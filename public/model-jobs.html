<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agents - FinSight Intelligence</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/@blueprintjs/core@4.20.2/lib/css/blueprint.css" rel="stylesheet">
  <link href="apple-hybrid-safe.css" rel="stylesheet">
  <link href="card-styling-fix.css" rel="stylesheet">
  <script src="agent-bridge.js" defer></script>
  <script src="card-expand-fixed.js" defer></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* Jobs/Ive Minimalist Design System */
    :root {
      --jobs-black: #000000;
      --jobs-white: #FFFFFF;
      --jobs-gray: #8E8E93;
      --jobs-light-gray: #F2F2F7;
      --jobs-blue: #007AFF;
      --jobs-green: #34C759;
      --jobs-red: #FF3B30;
      --jobs-orange: #FF9500;
      --jobs-purple: #AF52DE;
      --jobs-teal: #5AC8FA;
      --jobs-pink: #FF2D92;
      
      --jobs-font: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Helvetica Neue", sans-serif;
      --jobs-font-size-hero: 48px;
      --jobs-font-size-title: 34px;
      --jobs-font-size-headline: 28px;
      --jobs-font-size-body: 17px;
      --jobs-font-size-caption: 13px;
      
      --jobs-spacing-xs: 4px;
      --jobs-spacing-sm: 8px;
      --jobs-spacing-md: 16px;
      --jobs-spacing-lg: 24px;
      --jobs-spacing-xl: 32px;
      --jobs-spacing-xxl: 48px;
      
      --jobs-animation: cubic-bezier(0.25, 0.46, 0.45, 0.94);
      --jobs-duration: 300ms;
    }
    
    * {
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    body {
      margin: 0;
      font-family: var(--jobs-font);
      font-size: var(--jobs-font-size-body);
      color: var(--jobs-black);
      background: var(--jobs-white);
      line-height: 1.47;
      overflow-x: hidden;
    }
    
    body.dark-mode {
      background: var(--jobs-black);
      color: var(--jobs-white);
    }
    
    body.dark-mode .jobs-card {
      background: #1C1C1E;
      border-color: #38383A;
    }
    
    body.dark-mode .jobs-metric-label {
      color: #8E8E93;
    }
    
    body.dark-mode .jobs-nav {
      background: rgba(0, 0, 0, 0.8);
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }
    
    /* Agent Modal Styles */
    .agent-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      opacity: 0;
      visibility: hidden;
      transition: all var(--jobs-duration) var(--jobs-animation);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--jobs-spacing-lg);
    }

    .agent-modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .agent-modal {
      background: var(--jobs-white);
      border-radius: 20px;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      transform: scale(0.8) translateY(40px);
      transition: all var(--jobs-duration) var(--jobs-animation);
      position: relative;
    }

    .agent-modal-overlay.show .agent-modal {
      transform: scale(1) translateY(0);
    }

    body.dark-mode .agent-modal {
      background: #1C1C1E;
      color: var(--jobs-white);
    }

    .agent-modal-header {
      padding: var(--jobs-spacing-xl) var(--jobs-spacing-xl) var(--jobs-spacing-lg);
      border-bottom: 1px solid var(--jobs-light-gray);
      position: relative;
    }

    body.dark-mode .agent-modal-header {
      border-bottom-color: #38383A;
    }

    .agent-modal-close {
      position: absolute;
      top: var(--jobs-spacing-lg);
      right: var(--jobs-spacing-lg);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--jobs-light-gray);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: var(--jobs-gray);
      transition: all var(--jobs-duration) var(--jobs-animation);
    }

    .agent-modal-close:hover {
      background: var(--jobs-gray);
      color: var(--jobs-white);
      transform: scale(1.1);
    }

    body.dark-mode .agent-modal-close {
      background: #38383A;
      color: #8E8E93;
    }

    body.dark-mode .agent-modal-close:hover {
      background: #48484A;
      color: var(--jobs-white);
    }

    .agent-modal-agent-header {
      display: flex;
      align-items: center;
      gap: var(--jobs-spacing-md);
      margin-bottom: var(--jobs-spacing-lg);
    }

    .agent-modal-icon {
      width: 64px;
      height: 64px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 20px;
      color: white;
    }

    .agent-modal-icon.analytics { background: linear-gradient(135deg, var(--jobs-blue), #5AC8FA); }
    .agent-modal-icon.financial { background: linear-gradient(135deg, var(--jobs-green), #32D74B); }
    .agent-modal-icon.ml { background: linear-gradient(135deg, var(--jobs-purple), #BF5AF2); }
    .agent-modal-icon.nlp { background: linear-gradient(135deg, var(--jobs-orange), #FF9F0A); }
    .agent-modal-icon.data { background: linear-gradient(135deg, var(--jobs-teal), #64D2FF); }

    .agent-modal-identity h2 {
      font-size: var(--jobs-font-size-title);
      font-weight: 600;
      margin: 0 0 var(--jobs-spacing-xs) 0;
      line-height: 1.2;
    }

    .agent-modal-agent-id {
      font-size: var(--jobs-font-size-body);
      color: var(--jobs-gray);
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
    }

    .agent-modal-content {
      padding: 0 var(--jobs-spacing-xl) var(--jobs-spacing-xl);
    }

    .agent-modal-section {
      margin-bottom: var(--jobs-spacing-xl);
    }

    .agent-modal-section-title {
      font-size: var(--jobs-font-size-headline);
      font-weight: 600;
      margin-bottom: var(--jobs-spacing-md);
      color: var(--jobs-black);
    }

    body.dark-mode .agent-modal-section-title {
      color: var(--jobs-white);
    }

    .agent-modal-description {
      font-size: var(--jobs-font-size-body);
      line-height: 1.5;
      color: var(--jobs-gray);
      margin-bottom: var(--jobs-spacing-lg);
    }

    .agent-modal-capability-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: var(--jobs-spacing-sm);
      margin-bottom: var(--jobs-spacing-lg);
    }

    .agent-modal-capability-tag {
      background: var(--jobs-light-gray);
      color: var(--jobs-black);
      padding: var(--jobs-spacing-sm) var(--jobs-spacing-md);
      border-radius: 8px;
      font-size: var(--jobs-font-size-caption);
      font-weight: 500;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    body.dark-mode .agent-modal-capability-tag {
      background: #2C2C2E;
      color: var(--jobs-white);
    }

    .agent-modal-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: var(--jobs-spacing-md);
    }

    .agent-modal-metric {
      text-align: center;
      padding: var(--jobs-spacing-md);
      background: var(--jobs-light-gray);
      border-radius: 12px;
    }

    body.dark-mode .agent-modal-metric {
      background: #2C2C2E;
    }

    .agent-modal-metric-value {
      font-size: var(--jobs-font-size-headline);
      font-weight: 600;
      color: var(--jobs-blue);
      margin-bottom: var(--jobs-spacing-xs);
    }

    .agent-modal-metric-label {
      font-size: var(--jobs-font-size-caption);
      color: var(--jobs-gray);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .agent-modal-actions {
      display: flex;
      gap: var(--jobs-spacing-md);
      padding-top: var(--jobs-spacing-lg);
      border-top: 1px solid var(--jobs-light-gray);
    }

    body.dark-mode .agent-modal-actions {
      border-top-color: #38383A;
    }

    .agent-modal-button {
      flex: 1;
      padding: var(--jobs-spacing-md) var(--jobs-spacing-lg);
      border-radius: 12px;
      border: none;
      font-size: var(--jobs-font-size-body);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--jobs-duration) var(--jobs-animation);
    }

    .agent-modal-button.primary {
      background: var(--jobs-blue);
      color: white;
    }

    .agent-modal-button.primary:hover {
      background: #0056CC;
      transform: scale(1.02);
    }

    .agent-modal-button.secondary {
      background: var(--jobs-light-gray);
      color: var(--jobs-black);
    }

    .agent-modal-button.secondary:hover {
      background: var(--jobs-gray);
      color: white;
    }

    body.dark-mode .agent-modal-button.secondary {
      background: #2C2C2E;
      color: var(--jobs-white);
    }

    body.dark-mode .agent-modal-button.secondary:hover {
      background: #3A3A3C;
    }

    /* Agent Detail Screen Styles */
    .agent-detail-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--jobs-white);
      z-index: 10000;
      transform: translateX(100%);
      transition: transform var(--jobs-duration) var(--jobs-animation);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .agent-detail-screen.show {
      transform: translateX(0);
    }

    body.dark-mode .agent-detail-screen {
      background: var(--jobs-black);
      color: var(--jobs-white);
    }

    .agent-detail-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--jobs-light-gray);
      padding: var(--jobs-spacing-lg) var(--jobs-spacing-xl);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    body.dark-mode .agent-detail-header {
      background: rgba(0, 0, 0, 0.95);
      border-bottom-color: #38383A;
    }

    .agent-detail-back {
      display: flex;
      align-items: center;
      gap: var(--jobs-spacing-sm);
      color: var(--jobs-blue);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--jobs-duration) var(--jobs-animation);
      padding: var(--jobs-spacing-sm) var(--jobs-spacing-md);
      border-radius: 8px;
      border: none;
      background: none;
      font-size: var(--jobs-font-size-body);
    }

    .agent-detail-back:hover {
      background: var(--jobs-light-gray);
      transform: translateX(-2px);
    }

    body.dark-mode .agent-detail-back:hover {
      background: #2C2C2E;
    }

    .agent-detail-title {
      font-size: var(--jobs-font-size-headline);
      font-weight: 600;
      margin: 0;
    }

    .agent-detail-content {
      padding: 0 var(--jobs-spacing-xl) var(--jobs-spacing-xxl);
      max-width: 1200px;
      margin: 0 auto;
    }

    .agent-detail-hero {
      padding: var(--jobs-spacing-xxl) 0;
      text-align: center;
      border-bottom: 1px solid var(--jobs-light-gray);
      margin-bottom: var(--jobs-spacing-xxl);
    }

    body.dark-mode .agent-detail-hero {
      border-bottom-color: #38383A;
    }

    .agent-detail-icon {
      width: 120px;
      height: 120px;
      border-radius: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 48px;
      color: white;
      margin: 0 auto var(--jobs-spacing-lg);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .agent-detail-icon.analytics { background: linear-gradient(135deg, var(--jobs-blue), #5AC8FA); }
    .agent-detail-icon.financial { background: linear-gradient(135deg, var(--jobs-green), #32D74B); }
    .agent-detail-icon.ml { background: linear-gradient(135deg, var(--jobs-purple), #BF5AF2); }
    .agent-detail-icon.nlp { background: linear-gradient(135deg, var(--jobs-orange), #FF9F0A); }
    .agent-detail-icon.data { background: linear-gradient(135deg, var(--jobs-teal), #64D2FF); }

    .agent-detail-name {
      font-size: var(--jobs-font-size-hero);
      font-weight: 700;
      margin: 0 0 var(--jobs-spacing-sm) 0;
      line-height: 1.1;
    }

    .agent-detail-tagline {
      font-size: var(--jobs-font-size-title);
      color: var(--jobs-gray);
      margin: 0 0 var(--jobs-spacing-lg) 0;
      font-weight: 400;
    }

    .agent-detail-technical-id {
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
      font-size: var(--jobs-font-size-caption);
      color: var(--jobs-gray);
      background: var(--jobs-light-gray);
      padding: var(--jobs-spacing-xs) var(--jobs-spacing-sm);
      border-radius: 6px;
      display: inline-block;
    }

    body.dark-mode .agent-detail-technical-id {
      background: #2C2C2E;
    }

    .agent-detail-section {
      margin-bottom: var(--jobs-spacing-xxl);
    }

    .agent-detail-section-title {
      font-size: var(--jobs-font-size-title);
      font-weight: 600;
      margin: 0 0 var(--jobs-spacing-lg) 0;
      color: var(--jobs-black);
    }

    body.dark-mode .agent-detail-section-title {
      color: var(--jobs-white);
    }

    .agent-detail-cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--jobs-spacing-lg);
      margin-bottom: var(--jobs-spacing-xl);
    }

    .agent-detail-card {
      background: var(--jobs-white);
      border: 1px solid var(--jobs-light-gray);
      border-radius: 16px;
      padding: var(--jobs-spacing-xl);
      transition: all var(--jobs-duration) var(--jobs-animation);
      position: relative;
      overflow: hidden;
    }

    .agent-detail-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--jobs-blue), var(--jobs-green));
      border-radius: 16px 16px 0 0;
    }

    .agent-detail-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .agent-detail-card {
      background: #1C1C1E;
      border-color: #38383A;
    }

    .agent-detail-card-title {
      font-size: var(--jobs-font-size-headline);
      font-weight: 600;
      margin: 0 0 var(--jobs-spacing-md) 0;
      color: var(--jobs-black);
    }

    body.dark-mode .agent-detail-card-title {
      color: var(--jobs-white);
    }

    .agent-detail-card-content {
      color: var(--jobs-gray);
      line-height: 1.6;
    }

    .latex-formula {
      background: #F8F9FA;
      border: 1px solid #E9ECEF;
      border-radius: 8px;
      padding: var(--jobs-spacing-md);
      margin: var(--jobs-spacing-md) 0;
      font-family: 'Times New Roman', serif;
      text-align: center;
      overflow-x: auto;
    }

    body.dark-mode .latex-formula {
      background: #2C2C2E;
      border-color: #38383A;
      color: var(--jobs-white);
    }

    .process-flow {
      display: flex;
      align-items: center;
      gap: var(--jobs-spacing-md);
      margin: var(--jobs-spacing-lg) 0;
      flex-wrap: wrap;
    }

    .process-step {
      flex: 1;
      min-width: 120px;
      text-align: center;
      padding: var(--jobs-spacing-md);
      background: var(--jobs-light-gray);
      border-radius: 12px;
      position: relative;
    }

    body.dark-mode .process-step {
      background: #2C2C2E;
    }

    .process-step::after {
      content: '→';
      position: absolute;
      right: -20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--jobs-gray);
      font-size: 18px;
    }

    .process-step:last-child::after {
      display: none;
    }

    .process-step-number {
      width: 24px;
      height: 24px;
      background: var(--jobs-blue);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      margin: 0 auto var(--jobs-spacing-xs);
    }

    .process-step-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: var(--jobs-spacing-xs);
    }

    .process-step-desc {
      font-size: 12px;
      color: var(--jobs-gray);
    }

    .agent-detail-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--jobs-spacing-md);
      margin: var(--jobs-spacing-lg) 0;
    }

    .agent-detail-metric {
      text-align: center;
      padding: var(--jobs-spacing-lg);
      background: var(--jobs-light-gray);
      border-radius: 12px;
    }

    body.dark-mode .agent-detail-metric {
      background: #2C2C2E;
    }

    .agent-detail-metric-value {
      font-size: var(--jobs-font-size-title);
      font-weight: 600;
      color: var(--jobs-blue);
      margin-bottom: var(--jobs-spacing-xs);
    }

    .agent-detail-metric-label {
      font-size: var(--jobs-font-size-caption);
      color: var(--jobs-gray);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .code-example {
      background: #F8F9FA;
      border: 1px solid #E9ECEF;
      border-radius: 8px;
      padding: var(--jobs-spacing-md);
      margin: var(--jobs-spacing-md) 0;
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
      font-size: 14px;
      overflow-x: auto;
    }

    body.dark-mode .code-example {
      background: #2C2C2E;
      border-color: #38383A;
      color: var(--jobs-white);
    }

    .integration-diagram {
      background: var(--jobs-light-gray);
      border-radius: 8px;
      padding: var(--jobs-spacing-lg);
      margin: var(--jobs-spacing-lg) 0;
      position: relative;
    }

    body.dark-mode .integration-diagram {
      background: #1C1C1E;
    }

    /* Agent Details Sidebar Styles */
    .jobs-agent-details-sidebar {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100vh;
      background: var(--jobs-white);
      border-left: 1px solid var(--jobs-light-gray);
      z-index: 10000;
      transition: right 0.3s ease;
      overflow-y: auto;
    }

    body.dark-mode .jobs-agent-details-sidebar {
      background: #1C1C1E;
      border-left-color: #38383A;
    }

    .jobs-agent-details-sidebar.open {
      right: 0;
    }

    .jobs-agent-details-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--jobs-spacing-lg);
      border-bottom: 1px solid var(--jobs-light-gray);
    }

    body.dark-mode .jobs-agent-details-header {
      border-bottom-color: #38383A;
    }

    .jobs-agent-details-content {
      padding: var(--jobs-spacing-lg);
    }

    .jobs-close-button {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--jobs-gray);
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }

    .jobs-close-button:hover {
      background: var(--jobs-light-gray);
      color: var(--jobs-black);
    }

    body.dark-mode .jobs-close-button:hover {
      background: #38383A;
      color: var(--jobs-white);
    }

    /* Network Visualization Styles */
    .jobs-network-container {
      background: var(--jobs-white);
      border: 1px solid var(--jobs-light-gray);
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }

    body.dark-mode .jobs-network-container {
      background: #1C1C1E;
      border-color: #38383A;
    }

    .jobs-network-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--jobs-spacing-md);
    }

    .jobs-network-controls {
      display: flex;
      gap: var(--jobs-spacing-sm);
    }

    /* Network SVG Styles */
    .network-node {
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .network-node:hover {
      stroke-width: 3px;
      r: 18;
    }

    .network-node.selected {
      stroke: var(--jobs-blue);
      stroke-width: 4px;
    }

    .network-link {
      stroke: #ccc;
      stroke-opacity: 0.6;
      stroke-width: 2px;
    }

    .network-node-label {
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 10px;
      font-weight: 600;
      text-anchor: middle;
      fill: var(--jobs-white);
      pointer-events: none;
    }

    .diagram-node {
      display: inline-block;
      padding: var(--jobs-spacing-sm) var(--jobs-spacing-md);
      background: var(--jobs-white);
      border: 2px solid var(--jobs-blue);
      border-radius: 8px;
      margin: var(--jobs-spacing-sm);
      font-weight: 500;
      font-size: 14px;
    }

    body.dark-mode .diagram-node {
      background: #1C1C1E;
      color: var(--jobs-white);
    }

    .agent-detail-actions {
      position: sticky;
      bottom: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 1px solid var(--jobs-light-gray);
      padding: var(--jobs-spacing-lg) var(--jobs-spacing-xl);
      display: flex;
      gap: var(--jobs-spacing-md);
      justify-content: center;
    }

    body.dark-mode .agent-detail-actions {
      background: rgba(0, 0, 0, 0.95);
      border-top-color: #38383A;
    }

    .agent-detail-action-button {
      flex: 1;
      max-width: 200px;
      padding: var(--jobs-spacing-md) var(--jobs-spacing-lg);
      border-radius: 12px;
      border: none;
      font-size: var(--jobs-font-size-body);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--jobs-duration) var(--jobs-animation);
    }

    .agent-detail-action-button.primary {
      background: var(--jobs-blue);
      color: white;
    }

    .agent-detail-action-button.primary:hover {
      background: #0056CC;
      transform: scale(1.02);
    }

    .agent-detail-action-button.secondary {
      background: var(--jobs-light-gray);
      color: var(--jobs-black);
    }

    .agent-detail-action-button.secondary:hover {
      background: var(--jobs-gray);
      color: white;
    }

    body.dark-mode .agent-detail-action-button.secondary {
      background: #2C2C2E;
      color: var(--jobs-white);
    }

    body.dark-mode .agent-detail-action-button.secondary:hover {
      background: #3A3A3C;
    }

    /* Dark mode tabbar styles - removed */
    
    body.dark-mode .jobs-model-card {
      background: #1C1C1E;
      border-color: #38383A;
    }
    
    body.dark-mode .jobs-overview-card {
      background: #1C1C1E;
      border-color: #38383A;
    }
    
    body.dark-mode .jobs-category-header {
      background: rgba(28, 28, 30, 0.95);
      border-bottom-color: #38383A;
    }
    
    body.dark-mode .jobs-section-nav {
      background: rgba(0, 0, 0, 0.9);
    }
    
    /* Navigation with Hamburger */
    .jobs-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 48px;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 0.5px solid rgba(0, 0, 0, 0.1);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--jobs-spacing-lg);
    }
    
    .jobs-hamburger {
      background: none;
      border: none;
      padding: var(--jobs-spacing-xs);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 3px;
      transition: all var(--jobs-duration) var(--jobs-animation);
    }
    
    .jobs-hamburger-line {
      width: 18px;
      height: 2px;
      background: var(--jobs-black);
      transition: all var(--jobs-duration) var(--jobs-animation);
    }
    
    body.dark-mode .jobs-hamburger-line {
      background: var(--jobs-white);
    }
    
    .jobs-hamburger.active .jobs-hamburger-line:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }
    
    .jobs-hamburger.active .jobs-hamburger-line:nth-child(2) {
      opacity: 0;
    }
    
    .jobs-hamburger.active .jobs-hamburger-line:nth-child(3) {
      transform: rotate(-45deg) translate(5px, -5px);
    }
    
    /* Side Menu */
    .jobs-sidebar {
      position: fixed;
      top: 48px;
      left: -280px;
      width: 280px;
      height: calc(100vh - 48px);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-right: 1px solid rgba(0, 0, 0, 0.1);
      z-index: 999;
      transition: left var(--jobs-duration) var(--jobs-animation);
      overflow-y: auto;
      padding: var(--jobs-spacing-lg);
    }
    
    .jobs-sidebar.open {
      left: 0;
    }
    
    body.dark-mode .jobs-sidebar {
      background: rgba(28, 28, 30, 0.95);
      border-right-color: #38383A;
    }
    
    .jobs-sidebar-section {
      margin-bottom: var(--jobs-spacing-xl);
    }
    
    .jobs-sidebar-title {
      font-size: var(--jobs-font-size-caption);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--jobs-gray);
      margin-bottom: var(--jobs-spacing-md);
    }
    
    .jobs-sidebar-item {
      display: flex;
      align-items: center;
      gap: var(--jobs-spacing-sm);
      padding: var(--jobs-spacing-sm) var(--jobs-spacing-md);
      border-radius: 8px;
      cursor: pointer;
      transition: all var(--jobs-duration) var(--jobs-animation);
      margin-bottom: var(--jobs-spacing-xs);
      text-decoration: none;
      color: var(--jobs-black);
    }
    
    body.dark-mode .jobs-sidebar-item {
      color: var(--jobs-white);
    }
    
    .jobs-sidebar-item:hover {
      background: rgba(0, 122, 255, 0.1);
    }
    
    .jobs-sidebar-item.active {
      background: var(--jobs-blue);
      color: var(--jobs-white);
    }
    
    .jobs-sidebar-icon {
      font-size: 16px;
    }
    
    .jobs-sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.3);
      opacity: 0;
      visibility: hidden;
      transition: all var(--jobs-duration) var(--jobs-animation);
      z-index: 998;
    }
    
    .jobs-sidebar-overlay.open {
      opacity: 1;
      visibility: visible;
    }
    
    .jobs-nav-title {
      font-size: var(--jobs-font-size-body);
      font-weight: 600;
      letter-spacing: -0.01em;
    }
    
    .jobs-nav-actions {
      display: flex;
      gap: var(--jobs-spacing-md);
      align-items: center;
    }
    
    .jobs-nav-button {
      background: none;
      border: none;
      padding: var(--jobs-spacing-xs) var(--jobs-spacing-sm);
      font-size: var(--jobs-font-size-caption);
      color: var(--jobs-blue);
      cursor: pointer;
      border-radius: 6px;
      transition: all var(--jobs-duration) var(--jobs-animation);
    }
    
    .jobs-nav-button:hover {
      background: rgba(0, 122, 255, 0.1);
    }
    
    /* Section Navigation */
    .jobs-section-nav {
      position: fixed;
      top: 48px;
      left: 0;
      right: 0;
      height: 44px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 0.5px solid rgba(0, 0, 0, 0.1);
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow-x: auto;
    }
    
    .jobs-section-tabs {
      display: flex;
      gap: var(--jobs-spacing-xl);
      padding: 0 var(--jobs-spacing-lg);
    }
    
    .jobs-section-tab {
      padding: var(--jobs-spacing-sm) 0;
      font-size: var(--jobs-font-size-body);
      font-weight: 500;
      color: var(--jobs-gray);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all var(--jobs-duration) var(--jobs-animation);
      white-space: nowrap;
    }
    
    .jobs-section-tab.active {
      color: var(--jobs-blue);
      border-bottom-color: var(--jobs-blue);
    }
    
    /* Section display */
    .jobs-section {
      display: none;
    }
    
    .jobs-section.active {
      display: block;
    }
    
    /* Main Container - adjusted for section nav */
    .jobs-container {
      padding-top: 92px;
      padding-bottom: var(--jobs-spacing-lg);
    }
    
    /* Header */
    .jobs-header {
      text-align: center;
      padding: var(--jobs-spacing-xl) var(--jobs-spacing-lg);
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .jobs-header-title {
      font-size: var(--jobs-font-size-title);
      font-weight: 600;
      letter-spacing: -0.02em;
      margin: 0 0 var(--jobs-spacing-sm) 0;
    }
    
    .jobs-header-subtitle {
      font-size: var(--jobs-font-size-body);
      color: var(--jobs-gray);
      margin: 0;
    }
    
    /* Model Overview */
    .jobs-overview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--jobs-spacing-lg);
      padding: 0 var(--jobs-spacing-lg);
      max-width: 1200px;
      margin: 0 auto var(--jobs-spacing-xxl);
    }
    
    .jobs-overview-card {
      background: var(--jobs-white);
      border: 1px solid var(--jobs-light-gray);
      border-radius: 12px;
      padding: var(--jobs-spacing-lg);
      text-align: center;
      transition: all var(--jobs-duration) var(--jobs-animation);
      position: relative;
      overflow: hidden;
    }
    
    .jobs-overview-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--jobs-blue), var(--jobs-green));
      border-radius: 12px 12px 0 0;
      z-index: 1;
    }
    
    .jobs-overview-card:nth-child(2)::before {
      background: linear-gradient(90deg, var(--jobs-green), #00C7BE);
    }
    
    .jobs-overview-card:nth-child(3)::before {
      background: linear-gradient(90deg, #AF52DE, var(--jobs-blue));
    }
    
    .jobs-overview-card:nth-child(4)::before {
      background: linear-gradient(90deg, var(--jobs-orange), var(--jobs-red));
    }
    
    .jobs-overview-card:nth-child(5)::before {
      background: linear-gradient(90deg, #5AC8FA, #32D74B);
    }
    
    .jobs-overview-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }
    
    .jobs-overview-value {
      font-size: var(--jobs-font-size-headline);
      font-weight: 600;
      margin-bottom: var(--jobs-spacing-xs);
    }
    
    .jobs-overview-label {
      font-size: var(--jobs-font-size-caption);
      color: var(--jobs-gray);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .jobs-overview-value.online {
      color: var(--jobs-green);
    }
    
    .jobs-overview-value.training {
      color: var(--jobs-orange);
    }
    
    .jobs-overview-value.warning {
      color: var(--jobs-red);
    }
    
    /* Category Headers */
    .jobs-category-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      padding: var(--jobs-spacing-md) var(--jobs-spacing-lg);
      margin: var(--jobs-spacing-xxl) 0 var(--jobs-spacing-lg) 0;
      position: sticky;
      top: 92px;
      z-index: 100;
    }
    
    .jobs-category-title {
      font-size: var(--jobs-font-size-headline);
      font-weight: 600;
      margin: 0;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* Model Cards */
    .jobs-models-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      gap: 16px;
      padding: 0 20px;
      max-width: 1200px;
      margin: 0 auto 24px;
    }
    
    .jobs-model-card {
      background: var(--jobs-white);
      border: 0.5px solid rgba(0, 0, 0, 0.06);
      border-radius: 10px;
      padding: 16px;
      transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      margin-bottom: 12px;
    }
    
    /* A2A Agent Metadata */
    .a2a-agent-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .a2a-agent-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--jobs-blue), var(--jobs-purple));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--jobs-white);
      font-size: 14px;
      font-weight: 600;
      letter-spacing: -0.2px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
    }
    
    .a2a-agent-icon.analytics {
      background: linear-gradient(135deg, var(--jobs-blue), var(--jobs-teal));
    }
    
    .a2a-agent-icon.financial {
      background: linear-gradient(135deg, var(--jobs-green), #00C7BE);
    }
    
    .a2a-agent-icon.ml {
      background: linear-gradient(135deg, var(--jobs-purple), var(--jobs-pink));
    }
    
    .a2a-agent-icon.nlp {
      background: linear-gradient(135deg, var(--jobs-orange), var(--jobs-red));
    }
    
    .a2a-agent-icon.data {
      background: linear-gradient(135deg, var(--jobs-teal), var(--jobs-green));
    }
    
    .a2a-agent-icon.trust {
      background: linear-gradient(135deg, var(--jobs-purple), #BF5AF2);
    }
    
    .a2a-agent-identity {
      flex: 1;
    }
    
    .a2a-agent-name {
      font-size: 15px;
      font-weight: 600;
      margin: 0;
      line-height: 1.3;
      color: var(--jobs-black);
    }
    
    .a2a-agent-id {
      font-size: 10px;
      color: var(--jobs-gray);
      font-family: -apple-system, BlinkMacSystemFont, 'SF Mono', Monaco, monospace;
      margin-top: 1px;
      opacity: 0.7;
    }

    .a2a-technical-name {
      font-size: 10px;
      color: var(--jobs-gray);
      opacity: 0.7;
      font-style: italic;
      line-height: 1.3;
      margin-top: 1px;
    }
    
    .a2a-agent-status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--jobs-green);
      animation: pulse 2s infinite;
    }
    
    .a2a-agent-status-indicator.inactive {
      background: var(--jobs-gray);
      animation: none;
    }
    
    .a2a-capabilities {
      background: rgba(142, 142, 147, 0.06);
      border-radius: 6px;
      padding: 8px 10px;
      margin: 10px 0;
    }
    
    body.dark-mode .a2a-capabilities {
      background: #2C2C2E;
    }
    
    .a2a-capability-label {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--jobs-gray);
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    .a2a-capability-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }
    
    .a2a-capability-tag {
      background: var(--jobs-white);
      border: 0.5px solid rgba(0, 0, 0, 0.08);
      border-radius: 3px;
      padding: 1px 6px;
      font-size: 10px;
      white-space: nowrap;
      font-weight: 500;
    }
    
    body.dark-mode .a2a-capability-tag {
      background: #1C1C1E;
      border-color: #38383A;
    }
    
    .a2a-agent-description {
      font-size: 13px;
      color: var(--jobs-gray);
      margin-bottom: 10px;
      line-height: 1.35;
      margin-top: 4px;
    }
    
    .a2a-protocol-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 0.5px solid rgba(0, 0, 0, 0.08);
    }
    
    body.dark-mode .a2a-protocol-info {
      border-top-color: #38383A;
    }
    
    .a2a-protocol-version {
      font-size: 10px;
      color: var(--jobs-gray);
      font-weight: 500;
    }
    
    .a2a-agent-status {
      display: flex;
      align-items: center;
      gap: 3px;
      font-size: 10px;
      font-weight: 500;
    }
    
    .a2a-status-dot {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: var(--jobs-green);
    }
    
    .a2a-status-dot.inactive {
      background: var(--jobs-gray);
    }
    
    .jobs-model-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border-color: rgba(0, 0, 0, 0.1);
    }
    
    .jobs-model-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--jobs-blue), #AF52DE);
      border-radius: 12px 12px 0 0;
      z-index: 1;
    }
    
    .jobs-model-card.supervised::before {
      background: linear-gradient(90deg, var(--jobs-blue), var(--jobs-teal));
    }
    
    .jobs-model-card.unsupervised::before {
      background: linear-gradient(90deg, var(--jobs-purple), var(--jobs-pink));
    }
    
    .jobs-model-card.reinforcement::before {
      background: linear-gradient(90deg, var(--jobs-green), var(--jobs-teal));
    }
    
    .jobs-model-card.deep-learning::before {
      background: linear-gradient(90deg, var(--jobs-orange), var(--jobs-pink));
    }
    
    .jobs-model-card.nlp::before {
      background: linear-gradient(90deg, var(--jobs-red), var(--jobs-orange));
    }
    
    .jobs-model-card.ai-integration::before {
      background: linear-gradient(90deg, var(--jobs-purple), var(--jobs-blue));
    }
    
    .jobs-model-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--jobs-spacing-md);
    }
    
    .jobs-model-title {
      font-size: var(--jobs-font-size-body);
      font-weight: 600;
      margin: 0;
    }
    
    .jobs-model-status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--jobs-gray);
      position: relative;
    }
    
    .jobs-model-status.online {
      background: var(--jobs-green);
      animation: pulse 2s infinite;
    }
    
    .jobs-model-status.training {
      background: var(--jobs-orange);
      animation: pulse 1s infinite;
    }
    
    .jobs-model-status.offline {
      background: var(--jobs-red);
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    
    .jobs-model-type {
      font-size: var(--jobs-font-size-caption);
      color: var(--jobs-gray);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--jobs-spacing-sm);
    }
    
    .jobs-model-description {
      font-size: var(--jobs-font-size-caption);
      color: var(--jobs-gray);
      margin-bottom: var(--jobs-spacing-md);
      line-height: 1.4;
    }
    
    .jobs-model-metrics {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--jobs-spacing-md);
    }
    
    .jobs-metric {
      text-align: center;
      flex: 1;
    }
    
    .jobs-metric-value {
      font-size: var(--jobs-font-size-body);
      font-weight: 600;
      margin-bottom: var(--jobs-spacing-xs);
    }
    
    .jobs-metric-label {
      font-size: 10px;
      color: var(--jobs-gray);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .jobs-model-actions {
      display: flex;
      gap: var(--jobs-spacing-sm);
    }
    
    .jobs-action-button {
      flex: 1;
      background: var(--jobs-light-gray);
      border: none;
      padding: var(--jobs-spacing-sm);
      border-radius: 6px;
      font-size: var(--jobs-font-size-caption);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--jobs-duration) var(--jobs-animation);
    }
    
    .jobs-action-button:hover {
      background: var(--jobs-blue);
      color: var(--jobs-white);
    }
    
    .jobs-action-button.primary {
      background: var(--jobs-blue);
      color: var(--jobs-white);
    }
    
    .jobs-action-button.primary:hover {
      background: var(--jobs-purple);
    }
    
    body.dark-mode .jobs-action-button {
      background: #2C2C2E;
      color: var(--jobs-white);
    }
    
    body.dark-mode .jobs-action-button:hover {
      background: var(--jobs-blue);
    }
    
    /* Bottom Tab Bar - Removed */
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .jobs-models-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        padding: 0 16px;
      }
      
      .jobs-overview-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .jobs-model-metrics {
        flex-direction: column;
        gap: var(--jobs-spacing-sm);
      }
      
      .jobs-metric {
        text-align: left;
      }
    }
  
  /* A2A Network Visualization Styles */
  .jobs-network-container {
    background: var(--jobs-bg-color);
    border: 1px solid var(--jobs-border-color);
    border-radius: 12px;
    padding: var(--jobs-spacing-md);
    margin-top: var(--jobs-spacing-md);
  }
  
  .jobs-network-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--jobs-spacing-md);
    padding-bottom: var(--jobs-spacing-sm);
    border-bottom: 1px solid var(--jobs-border-color);
  }
  
  .jobs-network-header h3 {
    font-size: var(--jobs-font-size-title);
    font-weight: 600;
    color: var(--jobs-text-color);
    margin: 0;
  }
  
  .jobs-network-controls {
    display: flex;
    gap: var(--jobs-spacing-sm);
  }
  
  .jobs-network-visualization {
    background: var(--jobs-bg-color);
    border: 1px solid var(--jobs-border-color);
    border-radius: 8px;
    overflow: hidden;
    position: relative;
  }
  
  #network-svg {
    display: block;
    background: var(--jobs-bg-color);
  }
  
  .jobs-agent-details-sidebar {
    position: fixed;
    top: 0;
    right: -400px;
    width: 400px;
    height: 100vh;
    background: var(--jobs-bg-color);
    border-left: 1px solid var(--jobs-border-color);
    z-index: 1000;
    transition: right var(--jobs-duration) var(--jobs-animation);
    overflow-y: auto;
  }
  
  .jobs-agent-details-sidebar.open {
    right: 0;
  }
  
  .jobs-agent-details-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--jobs-spacing-md);
    border-bottom: 1px solid var(--jobs-border-color);
    background: var(--jobs-bg-color);
    position: sticky;
    top: 0;
  }
  
  .jobs-agent-details-header h3 {
    font-size: var(--jobs-font-size-title);
    font-weight: 600;
    color: var(--jobs-text-color);
    margin: 0;
  }
  
  .jobs-close-button {
    background: none;
    border: none;
    font-size: 24px;
    color: var(--jobs-gray);
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all var(--jobs-duration) var(--jobs-animation);
  }
  
  .jobs-close-button:hover {
    background: var(--jobs-light-gray);
    color: var(--jobs-text-color);
  }
  
  .jobs-agent-details-content {
    padding: var(--jobs-spacing-md);
  }
  
  /* Network node styles */
  .network-node {
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .network-node:hover {
    stroke-width: 3px;
  }
  
  .network-node.selected {
    stroke: var(--jobs-blue);
    stroke-width: 3px;
  }
  
  .network-link {
    stroke: var(--jobs-gray);
    stroke-opacity: 0.3;
    stroke-width: 1px;
  }
  
  .network-link.highlighted {
    stroke: var(--jobs-blue);
    stroke-opacity: 0.8;
    stroke-width: 2px;
  }
  
  /* Real connection styles */
  .network-link.real-connection {
    stroke-opacity: 0.8;
  }
  
  .network-link.synthetic-connection {
    stroke-opacity: 0.3;
  }
  
  .network-link.message-link {
    stroke: #007AFF;
  }
  
  .network-link.consensus-link {
    stroke: #34C759;
  }
  
  .network-link.hybrid-link {
    stroke: #FF9500;
  }
  
  .network-node-label {
    font-size: 10px;
    font-weight: 600;
    text-anchor: middle;
    fill: white;
    pointer-events: none;
  }
  
  body.dark-mode .jobs-network-container {
    background: #1C1C1E;
    border-color: #2C2C2E;
  }
  
  body.dark-mode .jobs-network-visualization {
    background: #1C1C1E;
    border-color: #2C2C2E;
  }
  
  body.dark-mode #network-svg {
    background: #1C1C1E;
  }
  
  body.dark-mode .jobs-agent-details-sidebar {
    background: #1C1C1E;
    border-color: #2C2C2E;
  }
  
  body.dark-mode .jobs-agent-details-header {
    background: #1C1C1E;
    border-color: #2C2C2E;
  }
  
  /* Blockchain Metadata Styles */
  .a2a-blockchain-metadata {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: var(--jobs-spacing-sm);
    margin: var(--jobs-spacing-sm) 0;
    font-size: 12px;
  }
  
  body.dark-mode .a2a-blockchain-metadata {
    background: linear-gradient(135deg, #2c2c2e, #1c1c1e);
    border-color: #38383a;
  }
  
  .blockchain-status-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--jobs-spacing-xs);
    font-weight: 500;
  }
  
  .blockchain-icon {
    font-size: 14px;
    margin-right: var(--jobs-spacing-xs);
  }
  
  .blockchain-consensus {
    color: var(--jobs-blue);
    font-weight: 600;
    font-size: 11px;
  }
  
  .verification-badge {
    padding: 2px 6px;
    border-radius: 12px;
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .verification-badge.verified {
    background: var(--jobs-green);
    color: white;
  }
  
  .verification-badge.pending {
    background: var(--jobs-orange);
    color: white;
  }
  
  .blockchain-metrics {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: var(--jobs-spacing-xs);
  }
  
  .blockchain-metric {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  
  .metric-label {
    font-size: 9px;
    color: var(--jobs-gray);
    margin-bottom: 2px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }
  
  .metric-value {
    font-weight: 600;
    font-size: 11px;
  }
  
  .trust-score {
    color: var(--jobs-green);
  }
  
  .participation-score {
    color: var(--jobs-blue);
  }
  
  .uptime-score {
    color: var(--jobs-purple);
  }
  
  .a2a-capability-tag.blockchain-enabled {
    background: linear-gradient(135deg, var(--jobs-blue), var(--jobs-purple));
    color: white;
    font-weight: 600;
    border: none;
  }
  
  /* Modal Blockchain Styles */
  .modal-blockchain-section {
    margin-top: var(--jobs-spacing-md);
    padding: var(--jobs-spacing-md);
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border: 1px solid #dee2e6;
    border-radius: 8px;
  }
  
  body.dark-mode .modal-blockchain-section {
    background: linear-gradient(135deg, #2c2c2e, #1c1c1e);
    border-color: #38383a;
  }
  
  .blockchain-section-title {
    font-size: 14px;
    font-weight: 600;
    margin: 0 0 var(--jobs-spacing-sm) 0;
    color: var(--jobs-text-color);
  }
  
  .blockchain-modal-metrics {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--jobs-spacing-sm);
  }
  
  .blockchain-modal-metric {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: var(--jobs-spacing-xs);
    background: rgba(255, 255, 255, 0.5);
    border-radius: 6px;
  }
  
  body.dark-mode .blockchain-modal-metric {
    background: rgba(0, 0, 0, 0.3);
  }
  
  .agent-modal-capability-tag.blockchain-enabled {
    background: linear-gradient(135deg, var(--jobs-blue), var(--jobs-purple));
    color: white;
    font-weight: 600;
    border: none;
  }
  
  .verification-verified {
    color: var(--jobs-green);
    font-weight: 700;
  }
  
  .verification-pending {
    color: var(--jobs-orange);
    font-weight: 700;
  }
  
  .did-value {
    font-family: monospace;
    font-size: 10px;
    color: var(--jobs-gray);
    word-break: break-all;
  }
  
  </style>
</head>
<body class="dark-mode">
  <!-- Navigation with Hamburger -->
  <nav class="jobs-nav">
    <div style="display: flex; align-items: center; gap: var(--jobs-spacing-md);">
      <button class="jobs-hamburger" onclick="toggleSidebar()" id="hamburger-btn">
        <div class="jobs-hamburger-line"></div>
        <div class="jobs-hamburger-line"></div>
        <div class="jobs-hamburger-line"></div>
      </button>
      <div class="jobs-nav-title">FinSight Intelligence</div>
    </div>
    <div class="jobs-nav-actions">
      <button class="jobs-nav-button" onclick="toggleDarkMode()">◐</button>
    </div>
  </nav>
  
  <!-- Sidebar Overlay -->
  <div class="jobs-sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>
  
  <!-- Sidebar -->
  <div class="jobs-sidebar" id="sidebar">
    <div class="jobs-sidebar-section">
      <div class="jobs-sidebar-title">FinSight Intelligence</div>
      <a href="/index.html" class="jobs-sidebar-item">
        <div class="jobs-sidebar-icon">◉</div>
        <span>Today</span>
      </a>
      <a href="/analyze-jobs.html" class="jobs-sidebar-item">
        <div class="jobs-sidebar-icon">◎</div>
        <span>Analyze</span>
      </a>
      <a href="/model-jobs.html" class="jobs-sidebar-item active">
        <div class="jobs-sidebar-icon">◆</div>
        <span>Agents</span>
      </a>
      <a href="/teach-jobs.html" class="jobs-sidebar-item">
        <div class="jobs-sidebar-icon">◇</div>
        <span>Teach</span>
      </a>
      <a href="/ai-jobs.html" class="jobs-sidebar-item">
        <div class="jobs-sidebar-icon">◈</div>
        <span>AI</span>
      </a>
      <a href="/control-jobs.html" class="jobs-sidebar-item" id="control-menu" style="display: none;">
        <div class="jobs-sidebar-icon">⚙️</div>
        <span>Control</span>
      </a>
    </div>
  </div>
  
  <!-- Section Navigation -->
  <div class="jobs-section-nav">
    <div class="jobs-section-tabs">
      <div class="jobs-section-tab active" onclick="showSection('overview')">Overview</div>
      <div class="jobs-section-tab" onclick="showSection('analytics')">Analytics</div>
      <div class="jobs-section-tab" onclick="showSection('financial')">Financial</div>
      <div class="jobs-section-tab" onclick="showSection('ml')">ML</div>
      <div class="jobs-section-tab" onclick="showSection('data')">Data</div>
      <div class="jobs-section-tab" onclick="showSection('trust')">Trust</div>
    </div>
  </div>
  
  <!-- Main Container -->
  <div class="jobs-container">
    <!-- Overview Section -->
    <div id="overview" class="jobs-section active">
      <div class="jobs-header">
        <h1 class="jobs-header-title">A2A Agent Network</h1>
        <p class="jobs-header-subtitle">Autonomous agents for real-time financial analytics and AI-powered intelligence</p>
      </div>
    
      <!-- Agent Overview Grid -->
      <div class="jobs-models-grid" id="overview-agents-grid">
        <!-- Agent cards will be populated here from database -->
      </div>
      
      <!-- Network Statistics -->
      <div class="jobs-section-spacing">
        <h2 class="jobs-section-title">Network Statistics</h2>
        <div class="jobs-overview-grid">
          <div class="jobs-overview-card">
            <div class="jobs-overview-value" id="network-total-agents">32</div>
            <div class="jobs-overview-label">Total Agents</div>
          </div>
          
          <div class="jobs-overview-card">
            <div class="jobs-overview-value active" id="network-active-agents">32</div>
            <div class="jobs-overview-label">Active Agents</div>
          </div>
          
          <div class="jobs-overview-card">
            <div class="jobs-overview-value" id="network-connections">45</div>
            <div class="jobs-overview-label">Connections (Simulated)</div>
          </div>
          
          <div class="jobs-overview-card">
            <div class="jobs-overview-value training" id="network-consensus-rounds">3</div>
            <div class="jobs-overview-label">Consensus Rounds</div>
          </div>
        </div>
      </div>
        
      <!-- Network Visualization -->
      <div class="jobs-section-spacing">
        <div class="jobs-network-header">
          <h2 class="jobs-section-title">Agent Network Graph</h2>
          <div class="jobs-network-controls">
            <button class="jobs-action-button" onclick="resetNetworkView()">Reset View</button>
            <button class="jobs-action-button" onclick="refreshNetworkData()">Refresh</button>
            <button id="connection-status-btn" class="jobs-action-button secondary" onclick="showConnectionInfo()" title="Click for connection details">⚠️ Simulated</button>
          </div>
        </div>
        
        <div class="jobs-network-container">
          <svg id="network-svg" width="100%" height="600"></svg>
        </div>
      </div>
        
        <!-- Agent Details Sidebar -->
        <div id="agent-details-sidebar" class="jobs-agent-details-sidebar">
          <div class="jobs-agent-details-header">
            <h3 id="agent-details-title">Agent Details</h3>
            <button class="jobs-close-button" onclick="closeAgentDetails()">×</button>
          </div>
          <div id="agent-details-content" class="jobs-agent-details-content">
            <p>Select an agent node to view details</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Core Analytics Section -->
    <div id="analytics" class="jobs-section">
      <div class="jobs-category-header">
        <h2 class="jobs-category-title">Core Analytics (Functions 1-9)</h2>
      </div>
      
      <div class="jobs-models-grid">
        <!-- PLACEHOLDER CARDS - These will be replaced by real agents from database on page load -->
        <!-- Function 1 - Pearson Correlation Agent -->
        <div class="jobs-model-card supervised" data-function="calculate_pearson_correlation">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon analytics">PCA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Portfolio Correlation</h3>
              <div class="a2a-agent-id">finsight.analytics.pearson_correlation</div>
              <div class="a2a-technical-name">Pearson Correlation Agent</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">json-array-input</span>
              <span class="a2a-capability-tag">numeric-output</span>
              <span class="a2a-capability-tag">statistical-analysis</span>
              <span class="a2a-capability-tag">correlation-testing</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Discover hidden relationships between your investments with intelligent correlation analysis.
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.analytics.pearson_correlation')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.analytics.pearson_correlation')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 2 - VaR Agent -->
        <div class="jobs-model-card supervised" data-function="calculate_var">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon analytics">VAR</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Risk Calculator</h3>
              <div class="a2a-agent-id">finsight.analytics.value_at_risk</div>
              <div class="a2a-technical-name">Value at Risk Agent</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">portfolio-input</span>
              <span class="a2a-capability-tag">risk-output</span>
              <span class="a2a-capability-tag">parametric-method</span>
              <span class="a2a-capability-tag">monte-carlo</span>
              <span class="a2a-capability-tag">historical-simulation</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Calculate Value at Risk using multiple methods: parametric, historical, Monte Carlo
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.analytics.value_at_risk')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.analytics.value_at_risk')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 3 - Thompson Sampling Agent -->
        <div class="jobs-model-card reinforcement" data-function="update_thompson_sampling">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon ml">TSA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Thompson Sampling Agent</h3>
              <div class="a2a-agent-id">finsight.ml.thompson_sampling</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">decision-input</span>
              <span class="a2a-capability-tag">action-output</span>
              <span class="a2a-capability-tag">reinforcement-learning</span>
              <span class="a2a-capability-tag">exploration-exploitation</span>
              <span class="a2a-capability-tag">bayesian-inference</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Reinforcement learning algorithm for optimal decision making with exploration-exploitation balance
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.ml.thompson_sampling')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.ml.thompson_sampling')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 4 - Sentiment Analysis Agent -->
        <div class="jobs-model-card nlp" data-function="calculate_sentiment_score">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon nlp">SEN</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Sentiment Analysis Agent</h3>
              <div class="a2a-agent-id">finsight.nlp.sentiment_analysis</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">text-input</span>
              <span class="a2a-capability-tag">sentiment-output</span>
              <span class="a2a-capability-tag">nlp-processing</span>
              <span class="a2a-capability-tag">news-analysis</span>
              <span class="a2a-capability-tag">confidence-scoring</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Analyze sentiment from financial news and social media with confidence scores
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.nlp.sentiment_analysis')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.nlp.sentiment_analysis')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 5 - Portfolio Risk Agent -->
        <div class="jobs-model-card supervised" data-function="calculate_portfolio_risk">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon analytics">PRA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Portfolio Risk Agent</h3>
              <div class="a2a-agent-id">finsight.analytics.portfolio_risk</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">portfolio-input</span>
              <span class="a2a-capability-tag">metrics-output</span>
              <span class="a2a-capability-tag">risk-assessment</span>
              <span class="a2a-capability-tag">volatility-analysis</span>
              <span class="a2a-capability-tag">sharpe-calculation</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Comprehensive portfolio risk analysis including volatility, beta, Sharpe ratio
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.analytics.portfolio_risk')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.analytics.portfolio_risk')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 6 - Trend Detection Agent -->
        <div class="jobs-model-card supervised" data-function="detect_trend">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon analytics">TDA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Trend Detection Agent</h3>
              <div class="a2a-agent-id">finsight.analytics.trend_detection</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">time-series-input</span>
              <span class="a2a-capability-tag">trend-output</span>
              <span class="a2a-capability-tag">moving-averages</span>
              <span class="a2a-capability-tag">linear-regression</span>
              <span class="a2a-capability-tag">change-detection</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Time series trend analysis using moving averages, linear regression, and change detection
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.analytics.trend_detection')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.analytics.trend_detection')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 7 - Anomaly Detection Agent -->
        <div class="jobs-model-card supervised" data-function="detect_anomaly">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon ml">ADA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Anomaly Detection Agent</h3>
              <div class="a2a-agent-id">finsight.ml.anomaly_detection</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">data-input</span>
              <span class="a2a-capability-tag">anomaly-output</span>
              <span class="a2a-capability-tag">z-score-method</span>
              <span class="a2a-capability-tag">isolation-forest</span>
              <span class="a2a-capability-tag">outlier-detection</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Multi-algorithm anomaly detection: Z-score, IQR, Isolation Forest, LOF
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.ml.anomaly_detection')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.ml.anomaly_detection')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 8 - LinUCB Bandit Agent -->
        <div class="jobs-model-card reinforcement" data-function="update_linucb_arm">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon ml">LBA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">LinUCB Bandit Agent</h3>
              <div class="a2a-agent-id">finsight.ml.linucb_bandit</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">context-input</span>
              <span class="a2a-capability-tag">action-output</span>
              <span class="a2a-capability-tag">online-learning</span>
              <span class="a2a-capability-tag">contextual-bandit</span>
              <span class="a2a-capability-tag">decision-optimization</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Contextual bandit algorithm for online learning and decision optimization
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.ml.linucb_bandit')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.ml.linucb_bandit')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 9 - Neural Bandit Agent -->
        <div class="jobs-model-card reinforcement" data-function="record_neural_bandit_decision">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon ml">NBA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Neural Bandit Agent</h3>
              <div class="a2a-agent-id">finsight.ml.neural_bandit</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">neural-input</span>
              <span class="a2a-capability-tag">decision-output</span>
              <span class="a2a-capability-tag">deep-learning</span>
              <span class="a2a-capability-tag">complex-decisions</span>
              <span class="a2a-capability-tag">adaptive-learning</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Deep learning enhanced bandit algorithm for complex decision making
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.ml.neural_bandit')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.ml.neural_bandit')">Agent Card</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Financial Models Section -->
    <div id="financial" class="jobs-section">
      <div class="jobs-category-header">
        <h2 class="jobs-category-title">Financial Models (Functions 21-26)</h2>
      </div>
      
      <div class="jobs-models-grid">
        <!-- Function 21 - Portfolio Risk Metrics Agent -->
        <div class="jobs-model-card supervised" data-function="get_portfolio_risk_metrics">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon financial">PRM</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Portfolio Risk Metrics Agent</h3>
              <div class="a2a-agent-id">finsight.financial.portfolio_risk_metrics</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">portfolio-input</span>
              <span class="a2a-capability-tag">risk-metrics-output</span>
              <span class="a2a-capability-tag">var-calculation</span>
              <span class="a2a-capability-tag">sharpe-ratio</span>
              <span class="a2a-capability-tag">beta-analysis</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Calculate VaR, Sharpe ratio, Beta, and other portfolio risk metrics
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.financial.portfolio_risk_metrics')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.financial.portfolio_risk_metrics')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 22 - Basel III Ratios Agent -->
        <div class="jobs-model-card supervised" data-function="calculate_basel_ratios">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon financial">BSL</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Basel III Ratios Agent</h3>
              <div class="a2a-agent-id">finsight.financial.basel_ratios</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">bank-data-input</span>
              <span class="a2a-capability-tag">regulatory-output</span>
              <span class="a2a-capability-tag">capital-adequacy</span>
              <span class="a2a-capability-tag">liquidity-coverage</span>
              <span class="a2a-capability-tag">leverage-ratio</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Calculate Basel III capital adequacy, liquidity coverage, and leverage ratios
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.financial.basel_ratios')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.financial.basel_ratios')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 23 - Options Greeks Agent -->
        <div class="jobs-model-card supervised" data-function="calculate_options_greeks">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon financial">OPG</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Options Greeks Agent</h3>
              <div class="a2a-agent-id">finsight.financial.options_greeks</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">options-input</span>
              <span class="a2a-capability-tag">greeks-output</span>
              <span class="a2a-capability-tag">black-scholes</span>
              <span class="a2a-capability-tag">derivatives-pricing</span>
              <span class="a2a-capability-tag">risk-sensitivities</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Calculate Black-Scholes Greeks: Delta, Gamma, Theta, Vega, Rho
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.financial.options_greeks')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.financial.options_greeks')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 24 - Yield Curve Analysis Agent -->
        <div class="jobs-model-card supervised" data-function="analyze_yield_curve">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon financial">YCA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Yield Curve Analysis Agent</h3>
              <div class="a2a-agent-id">finsight.financial.yield_curve</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">yield-data-input</span>
              <span class="a2a-capability-tag">curve-analysis-output</span>
              <span class="a2a-capability-tag">fixed-income</span>
              <span class="a2a-capability-tag">spread-analysis</span>
              <span class="a2a-capability-tag">term-structure</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Analyze yield curve shape, spread analysis, and term structure
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.financial.yield_curve')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.financial.yield_curve')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 25 - Credit Risk Scoring Agent -->
        <div class="jobs-model-card supervised" data-function="calculate_credit_risk_score">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon financial">CRS</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Credit Risk Scoring Agent</h3>
              <div class="a2a-agent-id">finsight.financial.credit_risk</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">credit-data-input</span>
              <span class="a2a-capability-tag">risk-score-output</span>
              <span class="a2a-capability-tag">multi-factor-analysis</span>
              <span class="a2a-capability-tag">financial-ratios</span>
              <span class="a2a-capability-tag">behavioral-scoring</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Multi-factor credit risk assessment with financial ratios and behavioral scoring
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.financial.credit_risk')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.financial.credit_risk')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 26 - Stress Test Scenarios Agent -->
        <div class="jobs-model-card supervised" data-function="run_stress_test">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon financial">STS</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Stress Test Scenarios Agent</h3>
              <div class="a2a-agent-id">finsight.financial.stress_test</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">scenario-input</span>
              <span class="a2a-capability-tag">impact-output</span>
              <span class="a2a-capability-tag">market-shocks</span>
              <span class="a2a-capability-tag">portfolio-stress</span>
              <span class="a2a-capability-tag">risk-scenarios</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Run comprehensive stress test scenarios with market shocks and portfolio impact
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.financial.stress_test')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.financial.stress_test')">Agent Card</button>
          </div>
        </div>
        
        <!-- A2A Visual Builder -->
        <div class="jobs-model-card trust" data-function="visual_trust_builder">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon trust">VTB</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">A2A Visual Trust Builder</h3>
              <div class="a2a-agent-id">finsight.a2a.visual_builder</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Trust Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">visual-design</span>
              <span class="a2a-capability-tag">trust-contracts</span>
              <span class="a2a-capability-tag">agent-orchestration</span>
              <span class="a2a-capability-tag">smart-contracts</span>
              <span class="a2a-capability-tag">real-network</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Drag-and-drop visual builder for A2A trust processes with real network integration
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v2.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); showA2AWizard()">Open A2A Wizard</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showVisualBuilderInfo()">Learn More</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Machine Learning Section -->
    <div id="ml" class="jobs-section">
      <div class="jobs-category-header">
        <h2 class="jobs-category-title">Machine Learning (Functions 10-20)</h2>
      </div>
      
      <div class="jobs-models-grid">
        <!-- Function 10 - Collaborative Learning Agent -->
        <div class="jobs-model-card reinforcement" data-function="update_collaborative_learning">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon ml">CLA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Collaborative Learning Agent</h3>
              <div class="a2a-agent-id">finsight.ml.collaborative_learning</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">user-item-input</span>
              <span class="a2a-capability-tag">recommendation-output</span>
              <span class="a2a-capability-tag">matrix-factorization</span>
              <span class="a2a-capability-tag">collaborative-filtering</span>
              <span class="a2a-capability-tag">deep-learning</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Matrix factorization and deep collaborative filtering for recommendations
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.ml.collaborative_learning')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.ml.collaborative_learning')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 11 - Adaptive Caching Agent -->
        <div class="jobs-model-card unsupervised" data-function="get_cache_recommendations">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon ml">ACA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Adaptive Caching Agent</h3>
              <div class="a2a-agent-id">finsight.ml.adaptive_cache</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">usage-pattern-input</span>
              <span class="a2a-capability-tag">cache-strategy-output</span>
              <span class="a2a-capability-tag">ml-optimization</span>
              <span class="a2a-capability-tag">frequency-analysis</span>
              <span class="a2a-capability-tag">recency-weighting</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            ML-based cache optimization using frequency-recency analysis
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.ml.adaptive_cache')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.ml.adaptive_cache')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 12 - Model Performance Agent -->
        <div class="jobs-model-card supervised" data-function="calculate_model_performance">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon ml">MPA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Model Performance Agent</h3>
              <div class="a2a-agent-id">finsight.ml.model_performance</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">predictions-input</span>
              <span class="a2a-capability-tag">metrics-output</span>
              <span class="a2a-capability-tag">model-monitoring</span>
              <span class="a2a-capability-tag">regression-metrics</span>
              <span class="a2a-capability-tag">classification-metrics</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Comprehensive model monitoring with regression, classification, and ranking metrics
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.ml.model_performance')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.ml.model_performance')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 13 - Feature Importance Agent -->
        <div class="jobs-model-card unsupervised" data-function="calculate_feature_importance">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon ml">FIA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Feature Importance Agent</h3>
              <div class="a2a-agent-id">finsight.ml.feature_importance</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">dataset-input</span>
              <span class="a2a-capability-tag">importance-output</span>
              <span class="a2a-capability-tag">feature-analysis</span>
              <span class="a2a-capability-tag">mutual-information</span>
              <span class="a2a-capability-tag">permutation-testing</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Feature analysis using correlation, mutual information, and permutation importance
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.ml.feature_importance')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.ml.feature_importance')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 14 - Synthetic Data Agent -->
        <div class="jobs-model-card unsupervised" data-function="generate_synthetic_data">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon ml">SDA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Synthetic Data Agent</h3>
              <div class="a2a-agent-id">finsight.ml.synthetic_data</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">distribution-input</span>
              <span class="a2a-capability-tag">synthetic-output</span>
              <span class="a2a-capability-tag">monte-carlo</span>
              <span class="a2a-capability-tag">copula-modeling</span>
              <span class="a2a-capability-tag">data-generation</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Generate synthetic data using Monte Carlo simulation and copulas
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.ml.synthetic_data')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.ml.synthetic_data')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 15 - Knowledge Graph Agent -->
        <div class="jobs-model-card nlp" data-function="generate_knowledge_graph">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon nlp">KGA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Knowledge Graph Agent</h3>
              <div class="a2a-agent-id">finsight.nlp.knowledge_graph</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">text-input</span>
              <span class="a2a-capability-tag">graph-output</span>
              <span class="a2a-capability-tag">entity-extraction</span>
              <span class="a2a-capability-tag">relationship-inference</span>
              <span class="a2a-capability-tag">graph-analytics</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Entity extraction, relationship inference, and graph analytics
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.nlp.knowledge_graph')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.nlp.knowledge_graph')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 16 - Entity Materialization Agent -->
        <div class="jobs-model-card nlp" data-function="materialize_entities">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon nlp">EMA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Entity Materialization Agent</h3>
              <div class="a2a-agent-id">finsight.nlp.entity_materialization</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">financial-text-input</span>
              <span class="a2a-capability-tag">entity-output</span>
              <span class="a2a-capability-tag">ner-extraction</span>
              <span class="a2a-capability-tag">confidence-scoring</span>
              <span class="a2a-capability-tag">entity-linking</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Extract and materialize entities from financial text with confidence scoring
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.nlp.entity_materialization')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.nlp.entity_materialization')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 17 - Temporal Correlations Agent -->
        <div class="jobs-model-card supervised" data-function="generate_temporal_correlations">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon ml">TCA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Temporal Correlations Agent</h3>
              <div class="a2a-agent-id">finsight.analytics.temporal_correlations</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">time-series-input</span>
              <span class="a2a-capability-tag">correlation-output</span>
              <span class="a2a-capability-tag">lagged-analysis</span>
              <span class="a2a-capability-tag">temporal-patterns</span>
              <span class="a2a-capability-tag">causality-testing</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Analyze time-based correlations and lagged relationships
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.analytics.temporal_correlations')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.analytics.temporal_correlations')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 18 - Swift Query Agent -->
        <div class="jobs-model-card ai-integration" data-function="answer_swift_query">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon ml">SQA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Swift Query Agent</h3>
              <div class="a2a-agent-id">finsight.ml.swift_query</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">swift-code-input</span>
              <span class="a2a-capability-tag">query-output</span>
              <span class="a2a-capability-tag">ios-integration</span>
              <span class="a2a-capability-tag">mobile-analytics</span>
              <span class="a2a-capability-tag">native-processing</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            iOS integration for Swift-based financial queries and analytics
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.ml.swift_query')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.ml.swift_query')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 19 - Entity Evolution Agent -->
        <div class="jobs-model-card nlp" data-function="entity_evolution_analysis">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon nlp">EEA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Entity Evolution Agent</h3>
              <div class="a2a-agent-id">finsight.nlp.entity_evolution</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">entity-history-input</span>
              <span class="a2a-capability-tag">evolution-output</span>
              <span class="a2a-capability-tag">change-tracking</span>
              <span class="a2a-capability-tag">temporal-analysis</span>
              <span class="a2a-capability-tag">trend-detection</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Track entity changes and evolution over time
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.nlp.entity_evolution')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.nlp.entity_evolution')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 20 - Metric Correlations Agent -->
        <div class="jobs-model-card supervised" data-function="metric_correlation_analysis">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon analytics">MCA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Metric Correlations Agent</h3>
              <div class="a2a-agent-id">finsight.analytics.metric_correlations</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">multi-metric-input</span>
              <span class="a2a-capability-tag">correlation-matrix-output</span>
              <span class="a2a-capability-tag">financial-analysis</span>
              <span class="a2a-capability-tag">cross-correlation</span>
              <span class="a2a-capability-tag">statistical-testing</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Analyze correlations between multiple financial metrics
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.analytics.metric_correlations')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.analytics.metric_correlations')">Agent Card</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Data Processing Section -->
    <div id="data" class="jobs-section">
      <div class="jobs-category-header">
        <h2 class="jobs-category-title">Data Processing (Functions 27-35)</h2>
      </div>
      
      <div class="jobs-models-grid">
        <!-- Function 27 - News Processing Agent -->
        <div class="jobs-model-card nlp" data-function="process_news_content">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon data">NPA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">News Processing Agent</h3>
              <div class="a2a-agent-id">finsight.data.news_processing</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">news-feed-input</span>
              <span class="a2a-capability-tag">processed-output</span>
              <span class="a2a-capability-tag">entity-extraction</span>
              <span class="a2a-capability-tag">sentiment-analysis</span>
              <span class="a2a-capability-tag">content-enrichment</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Process financial news with entity extraction and sentiment analysis
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.data.news_processing')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.data.news_processing')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 28 - Loading Status Agent -->
        <div class="jobs-model-card supervised" data-function="update_news_loading_status">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon data">LSA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Loading Status Agent</h3>
              <div class="a2a-agent-id">finsight.data.loading_status</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">status-input</span>
              <span class="a2a-capability-tag">update-output</span>
              <span class="a2a-capability-tag">progress-tracking</span>
              <span class="a2a-capability-tag">batch-monitoring</span>
              <span class="a2a-capability-tag">real-time-updates</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Track and update news data loading status
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.data.loading_status')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.data.loading_status')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 29 - News Archival Agent -->
        <div class="jobs-model-card supervised" data-function="cleanup_old_news">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon data">NAA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">News Archival Agent</h3>
              <div class="a2a-agent-id">finsight.data.news_archival</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">news-data-input</span>
              <span class="a2a-capability-tag">archive-output</span>
              <span class="a2a-capability-tag">data-cleanup</span>
              <span class="a2a-capability-tag">storage-optimization</span>
              <span class="a2a-capability-tag">retention-policy</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Archive and cleanup old news data
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.data.news_archival')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.data.news_archival')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 30 - News Statistics Agent -->
        <div class="jobs-model-card supervised" data-function="update_news_statistics">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon data">NSA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">News Statistics Agent</h3>
              <div class="a2a-agent-id">finsight.data.news_statistics</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">news-metrics-input</span>
              <span class="a2a-capability-tag">statistics-output</span>
              <span class="a2a-capability-tag">analytics-processing</span>
              <span class="a2a-capability-tag">volume-tracking</span>
              <span class="a2a-capability-tag">performance-metrics</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Calculate and update news processing statistics
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.data.news_statistics')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.data.news_statistics')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 31 - Trending Analysis Agent -->
        <div class="jobs-model-card nlp" data-function="analyze_trending_topics">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon data">TAA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Trending Analysis Agent</h3>
              <div class="a2a-agent-id">finsight.data.trending_analysis</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">news-stream-input</span>
              <span class="a2a-capability-tag">trends-output</span>
              <span class="a2a-capability-tag">topic-modeling</span>
              <span class="a2a-capability-tag">trend-identification</span>
              <span class="a2a-capability-tag">social-signals</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Identify and analyze trending topics in financial news
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.data.trending_analysis')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.data.trending_analysis')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 32 - Data Validation Agent -->
        <div class="jobs-model-card supervised" data-function="validate_data_quality">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon data">DVA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Data Validation Agent</h3>
              <div class="a2a-agent-id">finsight.data.validation</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">raw-data-input</span>
              <span class="a2a-capability-tag">quality-report-output</span>
              <span class="a2a-capability-tag">completeness-check</span>
              <span class="a2a-capability-tag">accuracy-validation</span>
              <span class="a2a-capability-tag">anomaly-detection</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Validate data quality with completeness and accuracy checks
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.data.validation')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.data.validation')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 33 - Data Normalization Agent -->
        <div class="jobs-model-card supervised" data-function="normalize_data">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon data">DNA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Data Normalization Agent</h3>
              <div class="a2a-agent-id">finsight.data.normalization</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">multi-format-input</span>
              <span class="a2a-capability-tag">normalized-output</span>
              <span class="a2a-capability-tag">schema-mapping</span>
              <span class="a2a-capability-tag">format-conversion</span>
              <span class="a2a-capability-tag">data-standardization</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Normalize financial data across different sources and formats
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.data.normalization')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.data.normalization')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 34 - Batch Processing Agent -->
        <div class="jobs-model-card supervised" data-function="execute_batch_operation">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon data">BPA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Batch Processing Agent</h3>
              <div class="a2a-agent-id">finsight.data.batch_processing</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">bulk-data-input</span>
              <span class="a2a-capability-tag">batch-output</span>
              <span class="a2a-capability-tag">parallel-processing</span>
              <span class="a2a-capability-tag">large-datasets</span>
              <span class="a2a-capability-tag">efficient-execution</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Execute batch operations on large datasets efficiently
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.data.batch_processing')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.data.batch_processing')">Agent Card</button>
          </div>
        </div>
        
        <!-- Function 35 - Complex Aggregations Agent -->
        <div class="jobs-model-card supervised" data-function="perform_complex_aggregation">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon data">CAA</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">Complex Aggregations Agent</h3>
              <div class="a2a-agent-id">finsight.data.complex_aggregations</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Agent Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">multi-dimensional-input</span>
              <span class="a2a-capability-tag">aggregate-output</span>
              <span class="a2a-capability-tag">cube-processing</span>
              <span class="a2a-capability-tag">pivot-operations</span>
              <span class="a2a-capability-tag">hierarchical-rollup</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Perform complex data aggregations with multiple dimensions
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Active</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('finsight.data.complex_aggregations')">Connect Agent</button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('finsight.data.complex_aggregations')">Agent Card</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Trust Section -->
    <div id="trust" class="jobs-section">
      <div class="jobs-models-grid">
        <!-- A2A Visual Trust Builder -->
        <div class="jobs-model-card trust" data-function="visual_trust_builder">
          <div class="a2a-agent-header">
            <div class="a2a-agent-icon trust">🛡️</div>
            <div class="a2a-agent-identity">
              <h3 class="a2a-agent-name">A2A Visual Trust Builder</h3>
              <div class="a2a-agent-id">a2a.trust.visual_builder</div>
              <div class="a2a-technical-name">Visual Process Builder</div>
            </div>
            <div class="a2a-agent-status-indicator"></div>
          </div>
          
          <div class="a2a-capabilities">
            <div class="a2a-capability-label">Builder Capabilities</div>
            <div class="a2a-capability-list">
              <span class="a2a-capability-tag">drag-drop-interface</span>
              <span class="a2a-capability-tag">real-agent-integration</span>
              <span class="a2a-capability-tag">smart-contract-generation</span>
              <span class="a2a-capability-tag">trust-pattern-templates</span>
              <span class="a2a-capability-tag">live-network-deployment</span>
            </div>
          </div>
          
          <div class="a2a-agent-description">
            Visual interface for building A2A trust processes with real agents and smart contracts. Drag and drop components to create complex trust relationships, then deploy directly to the live A2A network.
          </div>
          
          <div class="a2a-protocol-info">
            <span class="a2a-protocol-version">A2A Protocol v1.0</span>
            <div class="a2a-agent-status">
              <span class="a2a-status-dot"></span>
              <span>Connected to Real Network</span>
            </div>
          </div>
          
          <div class="jobs-model-actions">
            <button class="jobs-action-button primary" onclick="event.stopPropagation(); showA2AWizard()">
              Open A2A Wizard
            </button>
            <button class="jobs-action-button" onclick="event.stopPropagation(); window.open('/a2a-network.html', '_blank')">
              View Network Status
            </button>
          </div>
        </div>
      </div>
    </div>

    
    <script>
    // Check user role
    const userRole = localStorage.getItem('userRole') || 'Finance';
    if (userRole === 'Technology') {
      document.getElementById('control-menu').style.display = 'flex';
    }
    
    // Sidebar functionality
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      const hamburger = document.getElementById('hamburger-btn');
      
      sidebar.classList.toggle('open');
      overlay.classList.toggle('open');
      hamburger.classList.toggle('active');
    }
    
    function closeSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      const hamburger = document.getElementById('hamburger-btn');
      
      sidebar.classList.remove('open');
      overlay.classList.remove('open');
      hamburger.classList.remove('active');
    }
    
    // Close sidebar when clicking on a link
    document.querySelectorAll('.jobs-sidebar-item').forEach(item => {
      item.addEventListener('click', closeSidebar);
    });
    
    // Dark mode toggle
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }
    
    // Load saved preferences
    if (localStorage.getItem('darkMode') === 'false') {
      document.body.classList.remove('dark-mode');
    }
    
    // Spotlight search
    function showSpotlight() {
      const query = prompt('Search ML models and functions...');
      if (query) {
        console.log('Searching for:', query);
        // In real implementation, would filter models based on query
        filterModels(query);
      }
    }
    
    // Filter models based on search
    function filterModels(query) {
      const cards = document.querySelectorAll('.jobs-model-card');
      const lowerQuery = query.toLowerCase();
      
      cards.forEach(card => {
        const title = card.querySelector('.jobs-model-title').textContent.toLowerCase();
        const description = card.querySelector('.jobs-model-description').textContent.toLowerCase();
        const type = card.querySelector('.jobs-model-type').textContent.toLowerCase();
        
        if (title.includes(lowerQuery) || description.includes(lowerQuery) || type.includes(lowerQuery)) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    }
    
    // Open model details
    async function openModelDetails(modelId) {
      try {
        const response = await fetch('/api/supabase-proxy', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'select',
            table: 'ml_models',
            conditions: { model_id: modelId }
          })
        });
        
        if (!response.ok) {
          throw new Error('Failed to load model details');
        }
        
        const data = await response.json();
        if (data.data && data.data.length > 0) {
          const model = data.data[0];
          alert(`Model Details: ${model.name || modelId}

Architecture: ${model.architecture || 'Not specified'}
Status: ${model.status || 'Unknown'}
Accuracy: ${model.accuracy || 'Not measured'}
Last Updated: ${model.updated_at || 'Unknown'}
Description: ${model.description || 'No description available'}`);
        } else {
          alert(`Model ${modelId} not found in database`);
        }
      } catch (error) {
        console.error('Error loading model details:', error);
        alert('Failed to load model details. Database connection may be unavailable.');
      }
    }
    
    // Run model
    function runModel(modelId) {
      console.log('Running model:', modelId);
      
      // Simulate model execution
      const button = event.target;
      const originalText = button.textContent;
      button.textContent = 'Running...';
      button.disabled = true;
      
      setTimeout(() => {
        button.textContent = originalText;
        button.disabled = false;
        
        // Show results based on model type
        const results = getModelResults(modelId);
        alert(`Model Execution Complete!\n\n${results}`);
      }, 2000);
    }
    
    // View model results
    function viewResults(modelId) {
      console.log('Viewing results for:', modelId);
      
      const results = getModelResults(modelId);
      alert(`Model Results: ${modelId}\n\n${results}`);
    }
    
    // Get model results
    function getModelResults(modelId) {
      const results = {
        'anomaly-detection': 'Detected 12 anomalies in portfolio data\n- 3 high-risk outliers\n- 9 moderate anomalies\n- Confidence: 97.3%',
        'credit-risk': 'Credit risk analysis complete\n- Portfolio risk score: 7.2/10\n- 15 high-risk positions identified\n- Recommended actions: Diversify tech holdings',
        'performance-monitoring': 'Model performance summary\n- 12/13 models performing within tolerance\n- 1 model requires retraining\n- Average accuracy: 94.7%',
        'feature-importance': 'Feature analysis complete\n- Top 3 features: Market cap, P/E ratio, Volatility\n- 89/247 features selected\n- Correlation threshold: 0.85',
        'synthetic-data': 'Generated 100,000 synthetic records\n- Quality score: 99.8%\n- Distribution match: 98.5%\n- Ready for model training',
        'adaptive-cache': 'Cache optimization complete\n- Hit rate improved to 87.4%\n- Memory usage: 2.3GB\n- Evicted 1,247 stale entries',
        'linucb-bandit': 'Bandit decision made\n- Selected arm: Portfolio rebalancing\n- Confidence: 94.2%\n- Expected reward: 0.87',
        'neural-bandit': 'Neural bandit training in progress\n- Epoch 87/100\n- Loss: 0.0234\n- ETA: 2.5 hours',
        'collaborative-learning': 'Recommendations generated\n- 25 investment opportunities\n- Avg confidence: 91.6%\n- Top recommendation: TSLA',
        'knowledge-graph': 'Knowledge graph updated\n- 24,712 entities processed\n- 89,341 relationships mapped\n- Query time: 0.32s',
        'entity-extraction': 'Entities extracted from 50 news articles\n- 247 companies identified\n- 89 financial metrics found\n- Confidence: 96.3%',
        'neural-networks': 'Neural network inference complete\n- 7 networks executed\n- Average accuracy: 94.8%\n- Predictions: 1,247',
        'grok-credit-analysis': 'Grok AI credit analysis complete\n- Risk score: 8.1/10\n- Industry comparison: Above average\n- Recommendations: 5 action items',
        'grok-entity-extraction': 'Grok entity extraction complete\n- Processed 100 documents\n- 2,847 entities extracted\n- Accuracy: 99.7%'
      };
      
      return results[modelId] || 'Model results will be displayed here.';
    }
    
    

    // Load agents from database
    async function loadAgentsFromDatabase() {
      try {
        // Call Supabase to get all A2A agents
        const response = await fetch('/api/supabase-proxy', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: 'get_all_a2a_agents'
          })
        });
        
        const data = await response.json();
        if (data.error) {
          console.error('Error loading agents:', data.error);
          return;
        }
        
        // Group agents by type
        const agentsByType = {
          analytics: [],
          financial: [],
          ml: [],
          nlp: [],
          data: []
        };
        
        data.data.forEach(agent => {
          if (agentsByType[agent.agent_type]) {
            agentsByType[agent.agent_type].push(agent);
          }
        });
        
        // Update UI with real agents
        updateAgentCards(agentsByType);
        
      } catch (error) {
        console.error('Failed to load agents:', error);
      }
    }
    
    // Update agent cards in UI
    function updateAgentCards(agentsByType) {
      // Update each section with real agents
      Object.entries(agentsByType).forEach(([type, agents]) => {
        const sectionId = getSectionIdForType(type);
        const section = document.getElementById(sectionId);
        if (!section) return;
        
        const grid = section.querySelector('.jobs-models-grid');
        if (!grid) return;
        
        // Clear existing cards
        grid.innerHTML = '';
        
        // Add cards for each agent
        agents.forEach(agent => {
          const card = createAgentCard(agent);
          grid.appendChild(card);
        });
      });
    }
    
    // Map agent type to section ID
    function getSectionIdForType(type) {
      const mapping = {
        'analytics': 'analytics',
        'financial': 'financial',
        'ml': 'ml',
        'nlp': 'analytics', // NLP agents go in analytics section
        'data': 'data'
      };
      return mapping[type] || 'analytics';
    }
    
    // Create agent card element
    function createAgentCard(agent) {
      const card = document.createElement('div');
      card.className = 'jobs-model-card supervised';
      card.setAttribute('data-function', agent.function_name);
      
      // Get friendly name and enhanced description
      const friendlyName = getAppleFriendlyName(agent.agent_name, agent.agent_id);
      const enhancedDescription = getAppleDescription(agent.agent_name, agent.agent_id);
      
      // Extract blockchain metadata
      const blockchainData = agent.connection_config?.blockchain || {};
      const blockchainEnabled = agent.capabilities?.blockchain?.enabled || false;
      const verificationStatus = blockchainData.identity?.verification_status || 'pending';
      const trustScore = blockchainData.reputation?.trust_score || 0;
      const participationScore = blockchainData.consensus?.participation_score || 0;
      const consensusType = blockchainData.real_time?.database_consensus || 'ACID';
      const uptimePercentage = blockchainData.reputation?.uptime_percentage || 99;
      
      card.innerHTML = `
        <div class="a2a-agent-header">
          <div class="a2a-agent-icon ${agent.agent_type}">${agent.icon}</div>
          <div class="a2a-agent-identity">
            <h3 class="a2a-agent-name">${friendlyName}</h3>
            <div class="a2a-agent-id">${agent.agent_id}</div>
            <div class="a2a-technical-name">${agent.agent_name}</div>
          </div>
          <div class="a2a-agent-status-indicator"></div>
        </div>
        
        <div class="a2a-capabilities">
          <div class="a2a-capability-label">Capabilities</div>
          <div class="a2a-capability-list">
            ${agent.capabilities.domains.map(domain => 
              `<span class="a2a-capability-tag">${domain}</span>`
            ).join('')}
            ${blockchainEnabled ? '<span class="a2a-capability-tag blockchain-enabled">🔗 Blockchain</span>' : ''}
          </div>
        </div>
        
        ${blockchainEnabled ? `
        <div class="a2a-blockchain-metadata">
          <div class="blockchain-status-header">
            <span class="blockchain-icon">⛓️</span>
            <span class="blockchain-consensus">${consensusType} Consensus</span>
            <span class="verification-badge ${verificationStatus}">${verificationStatus.toUpperCase()}</span>
          </div>
          <div class="blockchain-metrics">
            <div class="blockchain-metric">
              <span class="metric-label">Trust Score</span>
              <span class="metric-value trust-score">${Math.round(trustScore)}/100</span>
            </div>
            <div class="blockchain-metric">
              <span class="metric-label">Participation</span>
              <span class="metric-value participation-score">${Math.round(participationScore)}%</span>
            </div>
            <div class="blockchain-metric">
              <span class="metric-label">Uptime</span>
              <span class="metric-value uptime-score">${Math.round(uptimePercentage)}%</span>
            </div>
          </div>
        </div>
        ` : ''}
        
        <div class="a2a-agent-description">
          ${enhancedDescription}
        </div>
        
        <div class="a2a-protocol-info">
          <span class="a2a-protocol-version">${agent.protocol_version || 'A2A Protocol v1.0'}</span>
          <div class="a2a-agent-status">
            <span class="a2a-status-dot"></span>
            <span>${agent.status || 'Active'}</span>
          </div>
        </div>
        
        <div class="jobs-model-actions">
          <button class="jobs-action-button primary" onclick="event.stopPropagation(); connectAgent('${agent.agent_id}')">Connect</button>
          <button class="jobs-action-button" onclick="event.stopPropagation(); showAgentDetailScreen('${agent.agent_id}')">Details</button>
        </div>
      `;
      
      return card;
    }

    // Connect to A2A Agent
    async function connectAgent(agentId) {
      console.log('Connecting to agent:', agentId);
      
      // Show loading state
      const button = event.target;
      const originalText = button.textContent;
      button.textContent = 'Connecting...';
      button.disabled = true;
      
      try {
        // Get agent card from database
        const response = await fetch('/api/supabase-proxy', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: 'get_agent_card',
            parameters: { p_agent_id: agentId }
          })
        });
        
        const data = await response.json();
        if (data.error) {
          throw new Error(data.error);
        }
        
        const agentCard = data.result;
        
        // Show success message with real agent data
        alert(`A2A Agent Connected!\n\nAgent: ${agentCard.agent_name}\nID: ${agentCard.agent_id}\nProtocol: ${agentCard.protocol_version}\nStatus: ${agentCard.status}\n\nCapabilities:\n${agentCard.capabilities.domains.join(', ')}\n\nThe agent is now ready to receive requests and communicate with other agents in the network.`);
        
      } catch (error) {
        alert(`Agent Connection Failed: ${agentId}\n\nError: ${error.message}`);
      } finally {
        button.textContent = originalText;
        button.disabled = false;
      }
    }
    
    // View Agent Card
    async function showAgentDetailScreen(agentId) {
      console.log('Viewing agent card:', agentId);
      
      try {
        // Get full agent card from database
        const response = await fetch('/api/supabase-proxy', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: 'get_agent_card',
            parameters: { p_agent_id: agentId }
          })
        });
        
        const data = await response.json();
        if (data.error) {
          throw new Error(data.error);
        }
        
        const agent = data.result;
        showAgentModal(agent);
        
      } catch (error) {
        alert(`Failed to load agent card: ${error.message}`);
      }
    }

    // Show Agent Modal
    function showAgentModal(agent) {
      // Set agent icon and type
      const modalIcon = document.getElementById('modal-agent-icon');
      modalIcon.textContent = agent.icon || getAgentIcon(agent.agent_type);
      modalIcon.className = `agent-modal-icon ${agent.agent_type}`;
      
      // Get friendly name and enhanced description
      const friendlyName = getAppleFriendlyName(agent.agent_name, agent.agent_id);
      const enhancedDescription = getAppleDescription(agent.agent_name, agent.agent_id);
      
      // Set agent details
      document.getElementById('modal-agent-name').textContent = friendlyName;
      document.getElementById('modal-agent-id').textContent = agent.agent_id;
      document.getElementById('modal-agent-description').textContent = enhancedDescription;
      
      // Set capabilities
      const capabilitiesContainer = document.getElementById('modal-agent-capabilities');
      capabilitiesContainer.innerHTML = '';
      
      if (agent.capabilities && agent.capabilities.domains) {
        agent.capabilities.domains.forEach(domain => {
          const tag = document.createElement('div');
          tag.className = 'agent-modal-capability-tag';
          tag.textContent = domain;
          capabilitiesContainer.appendChild(tag);
        });
        
        // Add blockchain capability if enabled
        const blockchainEnabled = agent.capabilities?.blockchain?.enabled || false;
        if (blockchainEnabled) {
          const blockchainTag = document.createElement('div');
          blockchainTag.className = 'agent-modal-capability-tag blockchain-enabled';
          blockchainTag.innerHTML = '🔗 Blockchain';
          capabilitiesContainer.appendChild(blockchainTag);
        }
      }
      
      // Set standard metrics
      document.getElementById('modal-response-time').textContent = `${agent.metrics?.avg_response_time_ms || '--'}ms`;
      document.getElementById('modal-success-rate').textContent = `${agent.metrics?.success_rate || '--'}%`;
      document.getElementById('modal-requests').textContent = agent.metrics?.total_requests || '--';
      
      // Add blockchain metrics if available
      const blockchainData = agent.connection_config?.blockchain || {};
      const blockchainEnabled = agent.capabilities?.blockchain?.enabled || false;
      
      // Find or create blockchain metrics container
      let blockchainContainer = document.getElementById('modal-blockchain-metrics');
      if (!blockchainContainer && blockchainEnabled) {
        blockchainContainer = document.createElement('div');
        blockchainContainer.id = 'modal-blockchain-metrics';
        blockchainContainer.className = 'modal-blockchain-section';
        blockchainContainer.innerHTML = `
          <h4 class="blockchain-section-title">🔗 Blockchain Identity</h4>
          <div class="blockchain-modal-metrics">
            <div class="blockchain-modal-metric">
              <span class="metric-label">Verification Status</span>
              <span class="metric-value verification-${blockchainData.identity?.verification_status || 'pending'}">${(blockchainData.identity?.verification_status || 'pending').toUpperCase()}</span>
            </div>
            <div class="blockchain-modal-metric">
              <span class="metric-label">Trust Score</span>
              <span class="metric-value trust-score">${Math.round(blockchainData.reputation?.trust_score || 0)}/100</span>
            </div>
            <div class="blockchain-modal-metric">
              <span class="metric-label">Consensus Participation</span>
              <span class="metric-value participation-score">${Math.round(blockchainData.consensus?.participation_score || 0)}%</span>
            </div>
            <div class="blockchain-modal-metric">
              <span class="metric-label">DID</span>
              <span class="metric-value did-value">${blockchainData.identity?.decentralized_id || 'N/A'}</span>
            </div>
          </div>
        `;
        
        // Insert after existing metrics
        const metricsSection = document.querySelector('.agent-modal-metrics');
        if (metricsSection) {
          metricsSection.parentNode.insertBefore(blockchainContainer, metricsSection.nextSibling);
        }
      }
      
      // Set connect button
      const connectBtn = document.getElementById('modal-connect-btn');
      connectBtn.onclick = () => connectAgentFromModal(agent.agent_id);
      
      // Add view process button if not exists
      let processBtn = document.getElementById('modal-process-btn');
      if (!processBtn) {
        const modalActions = document.querySelector('.agent-modal-actions');
        if (modalActions) {
          processBtn = document.createElement('button');
          processBtn.id = 'modal-process-btn';
          processBtn.className = 'agent-modal-action secondary';
          processBtn.textContent = 'View Process';
          modalActions.insertBefore(processBtn, connectBtn);
        }
      }
      if (processBtn) {
        processBtn.onclick = () => {
          closeAgentModal();
          showAgentDetailScreen(agent.agent_id);
        };
      }
      
      // Show modal
      const overlay = document.getElementById('agent-modal-overlay');
      overlay.classList.add('show');
    }

    // Close Agent Modal
    function closeAgentModal() {
      const overlay = document.getElementById('agent-modal-overlay');
      overlay.classList.remove('show');
    }

    // Connect Agent from Modal
    async function connectAgentFromModal(agentId) {
      if (!agentId) {
        const modalAgentId = document.getElementById('modal-agent-id').textContent;
        agentId = modalAgentId;
      }
      
      closeAgentModal();
      await connectAgent(agentId);
    }

    // Get agent icon helper
    function getAgentIcon(agentType) {
      const icons = {
        'analytics': 'AN',
        'financial': 'FN',
        'ml': 'ML', 
        'nlp': 'NL',
        'data': 'DT'
      };
      return icons[agentType] || 'AG';
    }

    // Apple-style user-friendly agent names mapping
    function getAppleFriendlyName(technicalName, agentId) {
      const friendlyNames = {
        // Analytics Agents
        'Pearson Correlation Agent': 'Portfolio Correlation',
        'Value at Risk Agent': 'Risk Calculator',
        'Thompson Sampling Agent': 'Smart Sampling',
        'Sentiment Analysis Agent': 'Market Sentiment',
        'Portfolio Risk Agent': 'Risk Monitor',
        'Trend Detection Agent': 'Trend Spotter',
        'Anomaly Detection Agent': 'Anomaly Finder',
        'LinUCB Bandit Agent': 'Smart Decision',
        'Neural Bandit Agent': 'AI Decision',
        
        // Financial Agents
        'Portfolio Risk Metrics Agent': 'Portfolio Health',
        'Basel III Ratios Agent': 'Compliance Check',
        'Options Greeks Agent': 'Options Analytics',
        'Yield Curve Analysis Agent': 'Yield Analyzer',
        'Credit Risk Scoring Agent': 'Credit Score',
        'Stress Test Scenario Agent': 'Stress Testing',
        
        // Machine Learning Agents
        'Monte Carlo Simulation Agent': 'Monte Carlo',
        'Portfolio Optimization Agent': 'Portfolio Optimizer',
        'Black-Scholes Agent': 'Options Pricing',
        'LinUCB Multi-Armed Bandit Agent': 'Multi-Armed Bandit',
        'Neural Network Decision Agent': 'Neural Networks',
        'Collaborative Learning Agent': 'Smart Recommendations',
        'Model Performance Agent': 'Performance Monitor',
        'Feature Importance Agent': 'Feature Analyzer',
        'Synthetic Data Agent': 'Data Generator',
        'Adaptive Cache Agent': 'Smart Cache',
        'Neural Networks Agent': 'Deep Learning',
        
        // Data Processing Agents
        'Knowledge Graph Agent': 'Knowledge Graph',
        'Entity Materialization Agent': 'Entity Extractor',
        'Temporal Correlations Agent': 'Time Correlations',
        'Swift Query Agent': 'Quick Query',
        'Entity Evolution Agent': 'Entity Tracker',
        'Metric Correlation Agent': 'Metric Insights',
        'News Content Processing Agent': 'News Processor',
        'News Loading Status Agent': 'News Monitor',
        'News Cleanup Archival Agent': 'News Archiver',
        'News Statistics Agent': 'News Analytics',
        'Data Sufficiency Agent': 'Data Quality',
        'Feature Availability Matrix Agent': 'Feature Matrix'
      };
      
      return friendlyNames[technicalName] || technicalName;
    }

    // Get Apple-style description
    function getAppleDescription(technicalName, agentId) {
      const descriptions = {
        // Analytics
        'Pearson Correlation Agent': 'Discover hidden relationships between your investments with intelligent correlation analysis.',
        'Value at Risk Agent': 'Calculate your maximum potential loss with precision and confidence.',
        'Thompson Sampling Agent': 'Make optimal decisions using advanced Bayesian sampling techniques.',
        'Sentiment Analysis Agent': 'Understand market emotions through intelligent news and social media analysis.',
        'Portfolio Risk Agent': 'Monitor your portfolio health with real-time risk assessment.',
        'Trend Detection Agent': 'Identify emerging market trends before they become obvious.',
        'Anomaly Detection Agent': 'Spot unusual patterns that could signal opportunities or risks.',
        'LinUCB Bandit Agent': 'Make confident decisions using contextual multi-armed bandit algorithms.',
        'Neural Bandit Agent': 'Leverage deep learning for sophisticated decision-making processes.',
        
        // Financial
        'Portfolio Risk Metrics Agent': 'Get comprehensive insights into your portfolio\'s risk profile and performance.',
        'Basel III Ratios Agent': 'Ensure regulatory compliance with automated Basel III ratio calculations.',
        'Options Greeks Agent': 'Master options trading with real-time Greeks calculations and analysis.',
        'Yield Curve Analysis Agent': 'Analyze yield curves to understand interest rate environments.',
        'Credit Risk Scoring Agent': 'Assess creditworthiness with advanced scoring algorithms.',
        'Stress Test Scenario Agent': 'Test your portfolio against extreme market conditions.',
        
        // Machine Learning
        'Monte Carlo Simulation Agent': 'Run thousands of scenarios to model potential investment outcomes.',
        'Portfolio Optimization Agent': 'Optimize your portfolio allocation using advanced mathematical models.',
        'Black-Scholes Agent': 'Price options accurately with the classic Black-Scholes model.',
        'LinUCB Multi-Armed Bandit Agent': 'Solve complex allocation problems with contextual bandits.',
        'Neural Network Decision Agent': 'Harness the power of neural networks for complex decision-making.',
        'Collaborative Learning Agent': 'Get personalized recommendations based on collective intelligence.',
        'Model Performance Agent': 'Monitor and optimize your AI models\' performance continuously.',
        'Feature Importance Agent': 'Understand which factors matter most in your predictions.',
        'Synthetic Data Agent': 'Generate high-quality synthetic data for testing and modeling.',
        'Adaptive Cache Agent': 'Optimize system performance with intelligent caching strategies.',
        'Neural Networks Agent': 'Deploy sophisticated deep learning models for complex analysis.',
        
        // Data Processing
        'Knowledge Graph Agent': 'Build and query intelligent knowledge graphs of financial relationships.',
        'Entity Materialization Agent': 'Extract and organize entities from unstructured financial data.',
        'Temporal Correlations Agent': 'Analyze how financial relationships change over time.',
        'Swift Query Agent': 'Get lightning-fast answers to complex financial queries.',
        'Entity Evolution Agent': 'Track how financial entities and relationships evolve.',
        'Metric Correlation Agent': 'Discover hidden connections between different financial metrics.',
        'News Content Processing Agent': 'Transform raw news into actionable financial intelligence.',
        'News Loading Status Agent': 'Monitor the health and status of your news data pipeline.',
        'News Cleanup Archival Agent': 'Maintain clean, organized historical news archives.',
        'News Statistics Agent': 'Generate insights from news volume, sentiment, and trends.',
        'Data Sufficiency Agent': 'Ensure you have enough quality data for reliable analysis.',
        'Feature Availability Matrix Agent': 'Visualize and manage feature availability across your datasets.'
      };
      
      return descriptions[technicalName] || 'Advanced financial intelligence agent for sophisticated analysis.';
    }

    // Show Agent Detail Screen
    async function showAgentDetailScreen(agentId) {
      console.log('Showing agent detail screen:', agentId);
      
      try {
        // Get full agent data from database
        const response = await fetch('/api/supabase-proxy', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: 'get_agent_card',
            parameters: { p_agent_id: agentId }
          })
        });
        
        const data = await response.json();
        if (data.error) {
          throw new Error(data.error);
        }
        
        const agent = data.result;
        populateAgentDetailScreen(agent);
        
        // Show the detail screen
        const detailScreen = document.getElementById('agent-detail-screen');
        detailScreen.classList.add('show');
        
        // Load agent's internal BPMN process
        setTimeout(() => loadAgentBPMN(agent), 500);
        
      } catch (error) {
        alert(`Failed to load agent details: ${error.message}`);
      }
    }

    // Populate Agent Detail Screen
    function populateAgentDetailScreen(agent) {
      // Get friendly name and enhanced descriptions
      const friendlyName = getAppleFriendlyName(agent.agent_name, agent.agent_id);
      const enhancedDescription = getAppleDescription(agent.agent_name, agent.agent_id);
      
      // Set hero section
      const detailIcon = document.getElementById('detail-agent-icon');
      detailIcon.textContent = agent.icon || getAgentIcon(agent.agent_type);
      detailIcon.className = `agent-detail-icon ${agent.agent_type}`;
      
      document.getElementById('detail-agent-name').textContent = friendlyName;
      document.getElementById('detail-agent-tagline').textContent = enhancedDescription;
      document.getElementById('detail-agent-id').textContent = agent.agent_id;
      document.getElementById('detail-screen-title').textContent = friendlyName;
      
      // Set metrics
      document.getElementById('detail-response-time').textContent = `${agent.metrics?.avg_response_time_ms || 45}ms`;
      document.getElementById('detail-success-rate').textContent = `${agent.metrics?.success_rate || 98.7}%`;
      document.getElementById('detail-requests').textContent = agent.metrics?.total_requests || '2,847';
      document.getElementById('detail-uptime').textContent = `${agent.metrics?.uptime || 99.9}%`;
      
      // Set understanding cards
      const understanding = getAgentUnderstanding(agent.agent_name, agent.agent_id);
      document.getElementById('detail-what-it-does').textContent = understanding.whatItDoes;
      document.getElementById('detail-why-it-matters').textContent = understanding.whyItMatters;
      document.getElementById('detail-when-to-use').textContent = understanding.whenToUse;
      
      // Set mathematical formula
      const formula = getAgentFormula(agent.agent_name);
      document.getElementById('detail-formula').innerHTML = formula;
      
      // Set process flow
      const processFlow = getAgentProcessFlow(agent.agent_name);
      populateProcessFlow(processFlow);
      
      // Set integration diagram
      const integration = getAgentIntegration(agent.agent_name);
      populateIntegrationDiagram(integration);
      
      // Set code example
      const codeExample = getAgentCodeExample(agent.agent_name, agent.agent_id);
      document.getElementById('detail-code-example').textContent = codeExample;
      
      // Set connect button
      const connectBtn = document.getElementById('detail-connect-btn');
      connectBtn.onclick = () => connectAgentFromDetail(agent.agent_id);
    }

    // Close Agent Detail Screen
    function closeAgentDetailScreen() {
      const detailScreen = document.getElementById('agent-detail-screen');
      detailScreen.classList.remove('show');
    }

    // Connect Agent from Detail Screen
    async function connectAgentFromDetail(agentId) {
      if (!agentId) {
        const detailAgentId = document.getElementById('detail-agent-id').textContent;
        agentId = detailAgentId;
      }
      
      closeAgentDetailScreen();
      await connectAgent(agentId);
    }

    // Get Agent Understanding
    function getAgentUnderstanding(technicalName, agentId) {
      const understanding = {
        // Analytics Agents
        'Pearson Correlation Agent': {
          whatItDoes: 'Analyzes statistical relationships between different financial instruments, revealing how they move together or independently during market fluctuations.',
          whyItMatters: 'Understanding correlations helps you build diversified portfolios that protect against market volatility and optimize risk-adjusted returns.',
          whenToUse: 'Use when building portfolios, assessing risk exposure, or identifying hedging opportunities across different asset classes.'
        },
        'Value at Risk Agent': {
          whatItDoes: 'Calculates the maximum potential loss your portfolio could face over a specific time period with a given confidence level.',
          whyItMatters: 'VaR provides a clear, quantifiable measure of risk that helps you set appropriate position sizes and risk limits.',
          whenToUse: 'Essential for risk management, regulatory reporting, and setting stop-loss levels for trading strategies.'
        },
        'Thompson Sampling Agent': {
          whatItDoes: 'Uses Bayesian optimization to balance exploration and exploitation in decision-making, continuously learning from outcomes.',
          whyItMatters: 'This approach maximizes long-term returns by intelligently adapting strategies based on new market information.',
          whenToUse: 'Ideal for algorithmic trading, portfolio rebalancing, and any scenario requiring adaptive decision-making.'
        },
        'Sentiment Analysis Agent': {
          whatItDoes: 'Processes news articles, social media, and market commentary to gauge overall market sentiment and investor emotion.',
          whyItMatters: 'Market sentiment often drives short-term price movements and can provide early warning signals for market shifts.',
          whenToUse: 'Use before major market events, earnings announcements, or when building contrarian investment strategies.'
        },
        'Portfolio Risk Agent': {
          whatItDoes: 'Continuously monitors your portfolio for risk concentrations, volatility spikes, and potential stress scenarios.',
          whyItMatters: 'Real-time risk monitoring helps prevent catastrophic losses and ensures your portfolio stays aligned with your risk tolerance.',
          whenToUse: 'Run continuously for active portfolios, especially during volatile market periods or before major position changes.'
        },
        'Trend Detection Agent': {
          whatItDoes: 'Identifies emerging trends in market data using advanced statistical techniques and machine learning algorithms.',
          whyItMatters: 'Early trend detection can provide significant alpha by positioning ahead of major market movements.',
          whenToUse: 'Use for momentum strategies, trend-following systems, and identifying potential breakout opportunities.'
        },
        'Anomaly Detection Agent': {
          whatItDoes: 'Scans market data for unusual patterns, outliers, and deviations from normal behavior that might signal opportunities or risks.',
          whyItMatters: 'Anomalies often precede significant market events and can reveal mispriced assets or systemic risks.',
          whenToUse: 'Deploy during earnings seasons, around major announcements, or for identifying arbitrage opportunities.'
        },
        'LinUCB Bandit Agent': {
          whatItDoes: 'Solves multi-armed bandit problems using contextual information to make optimal decisions under uncertainty.',
          whyItMatters: 'This approach maximizes expected returns while managing the exploration-exploitation tradeoff in complex decision spaces.',
          whenToUse: 'Perfect for asset allocation, strategy selection, and optimizing trading algorithms with multiple parameters.'
        },
        'Neural Bandit Agent': {
          whatItDoes: 'Combines deep neural networks with bandit algorithms to handle high-dimensional decision problems in finance.',
          whyItMatters: 'Neural bandits can capture complex non-linear relationships in market data that traditional methods miss.',
          whenToUse: 'Use for sophisticated trading strategies, complex portfolio optimization, and high-frequency decision-making.'
        }
      };
      
      return understanding[technicalName] || {
        whatItDoes: 'This agent processes financial data using advanced algorithms to provide insights and recommendations.',
        whyItMatters: 'This capability is essential for making informed financial decisions and managing risk effectively.',
        whenToUse: 'Use this agent when you need accurate, real-time analysis of financial data and market conditions.'
      };
    }

    // Get Agent Mathematical Formula
    function getAgentFormula(technicalName) {
      const formulas = {
        'Pearson Correlation Agent': `
          <div style="font-size: 16px; margin: 10px 0;">
            <strong>Pearson Correlation Coefficient:</strong><br><br>
            ρ<sub>X,Y</sub> = <span style="border-top: 1px solid; padding-top: 5px;">
              Σ(X<sub>i</sub> - X̄)(Y<sub>i</sub> - Ȳ)
            </span><br>
            <div style="text-align: center; margin-top: 5px;">
              √[Σ(X<sub>i</sub> - X̄)²] × √[Σ(Y<sub>i</sub> - Ȳ)²]
            </div>
            <br>
            <small>Where: ρ ∈ [-1, 1], X̄ and Ȳ are sample means</small>
          </div>
        `,
        'Value at Risk Agent': `
          <div style="font-size: 16px; margin: 10px 0;">
            <strong>Value at Risk (Parametric Method):</strong><br><br>
            VaR<sub>α</sub> = μ - σ × Φ<sup>-1</sup>(α)<br><br>
            <strong>Historical Simulation:</strong><br>
            VaR<sub>α</sub> = P₀ × percentile(R, α)<br><br>
            <small>Where: μ = expected return, σ = volatility, Φ<sup>-1</sup> = inverse normal CDF</small>
          </div>
        `,
        'Thompson Sampling Agent': `
          <div style="font-size: 16px; margin: 10px 0;">
            <strong>Thompson Sampling for Beta-Bernoulli:</strong><br><br>
            θ<sub>i</sub> ~ Beta(α<sub>i</sub> + S<sub>i</sub>, β<sub>i</sub> + F<sub>i</sub>)<br><br>
            Action = argmax<sub>i</sub> θ<sub>i</sub><br><br>
            <small>Where: S<sub>i</sub> = successes, F<sub>i</sub> = failures for arm i</small>
          </div>
        `,
        'Black-Scholes Agent': `
          <div style="font-size: 16px; margin: 10px 0;">
            <strong>Black-Scholes Option Pricing:</strong><br><br>
            C = S₀N(d₁) - Ke<sup>-rT</sup>N(d₂)<br><br>
            d₁ = <span style="border-top: 1px solid; padding-top: 5px;">
              ln(S₀/K) + (r + σ²/2)T
            </span><br>
            <div style="text-align: center; margin: 5px 0;">σ√T</div>
            d₂ = d₁ - σ√T<br><br>
            <small>Where: S₀ = spot price, K = strike, r = risk-free rate, T = time to expiry</small>
          </div>
        `
      };
      
      return formulas[technicalName] || `
        <div style="font-size: 16px; margin: 10px 0;">
          <strong>Agent Mathematical Foundation:</strong><br><br>
          f(x) = Σ w<sub>i</sub> × φ(x<sub>i</sub>)<br><br>
          <small>Where: w<sub>i</sub> = learned weights, φ = activation function</small>
        </div>
      `;
    }

    // Get Agent Process Flow
    function getAgentProcessFlow(technicalName) {
      const flows = {
        'Pearson Correlation Agent': [
          { title: 'Data Input', desc: 'Receive time series data' },
          { title: 'Preprocessing', desc: 'Clean and normalize data' },
          { title: 'Calculate', desc: 'Compute correlation matrix' },
          { title: 'Analyze', desc: 'Identify relationships' },
          { title: 'Output', desc: 'Return correlation results' }
        ],
        'Value at Risk Agent': [
          { title: 'Portfolio Data', desc: 'Load positions and prices' },
          { title: 'Risk Factors', desc: 'Identify key risk drivers' },
          { title: 'Simulation', desc: 'Run Monte Carlo or historical' },
          { title: 'VaR Calculation', desc: 'Compute risk metrics' },
          { title: 'Report', desc: 'Generate risk report' }
        ],
        'Thompson Sampling Agent': [
          { title: 'Initialize', desc: 'Set prior distributions' },
          { title: 'Sample', desc: 'Draw from posteriors' },
          { title: 'Select', desc: 'Choose best action' },
          { title: 'Observe', desc: 'Record outcome' },
          { title: 'Update', desc: 'Bayesian update' }
        ]
      };
      
      return flows[technicalName] || [
        { title: 'Input', desc: 'Receive data' },
        { title: 'Process', desc: 'Analyze information' },
        { title: 'Compute', desc: 'Run algorithms' },
        { title: 'Validate', desc: 'Check results' },
        { title: 'Output', desc: 'Return insights' }
      ];
    }

    // Populate Process Flow
    function populateProcessFlow(steps) {
      const container = document.getElementById('detail-process-flow');
      container.innerHTML = '';
      
      steps.forEach((step, index) => {
        const stepDiv = document.createElement('div');
        stepDiv.className = 'process-step';
        stepDiv.innerHTML = `
          <div class="process-step-number">${index + 1}</div>
          <div class="process-step-title">${step.title}</div>
          <div class="process-step-desc">${step.desc}</div>
        `;
        container.appendChild(stepDiv);
      });
    }

    // Get Agent Integration
    function getAgentIntegration(technicalName) {
      return [
        'Market Data Feed',
        'Data Preprocessing',
        technicalName,
        'Result Validation',
        'User Dashboard'
      ];
    }

    // Populate Integration Diagram
    function populateIntegrationDiagram(nodes) {
      const container = document.getElementById('detail-integration');
      container.innerHTML = '';
      
      nodes.forEach(node => {
        const nodeDiv = document.createElement('div');
        nodeDiv.className = 'diagram-node';
        nodeDiv.textContent = node;
        container.appendChild(nodeDiv);
      });
    }

    // Get Agent Code Example
    function getAgentCodeExample(technicalName, agentId) {
      const functionName = agentId.split('.').pop();
      
      return `// Connect to ${technicalName}
const response = await fetch('/api/supabase-proxy', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    action: 'rpc',
    function_name: '${functionName}',
    params: {
      // Add your parameters here
      data: yourFinancialData,
      options: { confidence: 0.95 }
    }
  })
});

const result = await response.json();
console.log('${technicalName} result:', result);

// Handle the response
if (result.success) {
  updateDashboard(result.data);
} else {
  handleError(result.error);
}`;
    }

    // Close modal when clicking overlay
    document.addEventListener('DOMContentLoaded', function() {
      const overlay = document.getElementById('agent-modal-overlay');
      overlay.addEventListener('click', function(e) {
        if (e.target === overlay) {
          closeAgentModal();
        }
      });
    });
    
    // REMOVED: simulateAgentConnection function 
    // All agent connections now use real API calls to /api/supabase-proxy
    
    // Get agent capabilities
    function getAgentCapabilities(category, functionName) {
      const capabilityMap = {
        'analytics': [
          '• Real-time data processing',
          '• Statistical analysis',
          '• Risk assessment',
          '• Trend detection',
          '• Correlation analysis'
        ],
        'financial': [
          '• Portfolio analysis',
          '• Risk modeling',
          '• Regulatory compliance',
          '• Options pricing',
          '• Credit assessment'
        ],
        'ml': [
          '• Machine learning models',
          '• Deep learning networks',
          '• Reinforcement learning',
          '• Feature engineering',
          '• Model optimization'
        ],
        'nlp': [
          '• Natural language processing',
          '• Entity extraction',
          '• Sentiment analysis',
          '• Knowledge graphs',
          '• Text classification'
        ],
        'data': [
          '• Data processing',
          '• ETL operations',
          '• Data validation',
          '• Batch processing',
          '• Real-time streaming'
        ]
      };
      
      return capabilityMap[category] || ['• General processing capabilities'];
    }

    // Load real model metrics from database
    async function refreshModelMetrics() {
      try {
        // Get real agent/model statistics from database
        const response = await fetch('/api/supabase-proxy', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'get_agent_statistics'
          })
        });

        if (response.ok) {
          const data = await response.json();
          const stats = data.result || {};
          
          // Update with real data
          const metricElements = {
            'active-models': stats.active_agents ? `${stats.active_agents}/${stats.total_agents || stats.active_agents}` : 'No data',
            'avg-accuracy': stats.avg_performance ? `${stats.avg_performance}%` : 'No data',
            'training-jobs': stats.active_jobs || 'No data',
            'predictions-today': stats.predictions_today || 'No data',
            'inference-time': stats.avg_response_time ? `${stats.avg_response_time}s` : 'No data'
          };
          
          Object.entries(metricElements).forEach(([id, value]) => {
            const element = document.getElementById(id);
            if (element) {
              element.textContent = value;
            }
          });
        } else {
          // Show "No data" when API fails - NO SIMULATION
          ['active-models', 'avg-accuracy', 'training-jobs', 'predictions-today', 'inference-time'].forEach(id => {
            const element = document.getElementById(id);
            if (element) element.textContent = 'No data';
          });
        }
      } catch (error) {
        console.error('Model metrics error:', error);
        // Show error state - NO FAKE DATA
        ['active-models', 'avg-accuracy', 'training-jobs', 'predictions-today', 'inference-time'].forEach(id => {
          const element = document.getElementById(id);
          if (element) element.textContent = 'Error';
        });
      }
    }
    
    // Refresh metrics every 30 seconds
    setInterval(refreshModelMetrics, 30000);
    
    // Load agents from database when page loads
    document.addEventListener('DOMContentLoaded', loadAgentsFromDatabase);
    
    // Add keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.metaKey && e.key === 'k') {
        e.preventDefault();
        showSpotlight();
      }
      if (e.key === 'r' && e.metaKey) {
        e.preventDefault();
        refreshModelMetrics();
      }
    });
    
    // Section navigation
    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.jobs-section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Remove active from all tabs
      document.querySelectorAll('.jobs-section-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected section
      const section = document.getElementById(sectionId);
      if (section) {
        section.classList.add('active');
      }
      
      // Activate tab
      event.target.classList.add('active');
    }
    
    // Initialize tooltips for model cards
    document.querySelectorAll('.jobs-model-card').forEach(card => {
      card.addEventListener('mouseenter', () => {
        // Add subtle animation on hover
        card.style.transform = 'translateY(-2px) scale(1.01)';
      });
      
      card.addEventListener('mouseleave', () => {
        card.style.transform = 'translateY(0) scale(1)';
      });
    });
    
    // A2A Network Visualization Code
    let networkData = { nodes: [], links: [] };
    let simulation, svg, link, node, nodeLabels;
    let selectedNode = null;
    
    // Initialize network visualization when A2A network section is shown
    function initializeNetworkVisualization() {
      if (document.getElementById('network-svg').children.length > 0) {
        return; // Already initialized
      }
      
      const svgElement = document.getElementById('network-svg');
      const width = svgElement.clientWidth;
      const height = 600;
      
      svg = d3.select('#network-svg')
        .attr('width', width)
        .attr('height', height);
      
      // Add zoom behavior
      const zoom = d3.zoom()
        .scaleExtent([0.1, 4])
        .on('zoom', (event) => {
          svg.selectAll('g').attr('transform', event.transform);
        });
      
      svg.call(zoom);
      
      // Create main group for zooming
      const g = svg.append('g');
      
      // Create links group
      link = g.append('g')
        .attr('class', 'links')
        .selectAll('line');
      
      // Create nodes group
      node = g.append('g')
        .attr('class', 'nodes')
        .selectAll('circle');
      
      // Create labels group
      nodeLabels = g.append('g')
        .attr('class', 'labels')
        .selectAll('text');
      
      // Initialize force simulation
      simulation = d3.forceSimulation()
        .force('link', d3.forceLink().id(d => d.id).distance(100))
        .force('charge', d3.forceManyBody().strength(-300))
        .force('center', d3.forceCenter(width / 2, height / 2))
        .force('collision', d3.forceCollide(25));
      
      // Load initial data
      loadNetworkData();
      
      // Handle window resize
      window.addEventListener('resize', () => {
        const newWidth = svgElement.clientWidth;
        svg.attr('width', newWidth);
        simulation.force('center', d3.forceCenter(newWidth / 2, height / 2));
        simulation.alpha(0.3).restart();
      });
    }
    
    // Load network data from API
    async function loadNetworkData() {
      try {
        // Fetch agents
        const agentResponse = await fetch('/api/unified?action=a2a_agents');
        const agentData = await agentResponse.json();
        
        // The API returns { agents: [...], count: n, active: n }
        const agents = agentData.agents || agentData;
        
        // Transform agents to nodes
        networkData.nodes = agents.map(agent => ({
          id: agent.agent_id,
          name: agent.agent_name,
          type: agent.agent_type,
          status: agent.status || 'active',
          capabilities: agent.capabilities || [],
          description: agent.description || 'Advanced AI agent for financial intelligence and real-time decision making.',
          ...agent
        }));
        
        // Fetch real A2A network connections
        try {
          const networkResponse = await fetch('/api/unified?action=a2a_network');
          const networkData_resp = await networkResponse.json();
          
          if (networkData_resp.isReal && networkData_resp.connections) {
            console.log('✅ Using REAL A2A network connections:', networkData_resp.totalConnections);
            
            // Map real connections to network links
            networkData.links = networkData_resp.connections.map(conn => ({
              source: conn.source,
              target: conn.target,
              type: conn.type, // 'message', 'consensus', or 'hybrid'
              count: conn.count,
              lastActivity: conn.lastActivity,
              status: conn.status,
              real: true
            })).filter(link => {
              // Only include links where both source and target nodes exist
              return networkData.nodes.some(n => n.id === link.source) && 
                     networkData.nodes.some(n => n.id === link.target);
            });
            
            // Update overview with real connection data
            updateNetworkOverviewReal(networkData_resp);
          } else {
            console.log('⚠️ No network connection data available');
            networkData.links = []; // No fake data - show empty network
            updateNetworkOverview();
            updateConnectionStatusButton();
          }
        } catch (networkError) {
          console.log('⚠️ Network fetch failed:', networkError.message);
          networkData.links = []; // No synthetic data - show error state
          updateNetworkOverview();
          updateConnectionStatusButton();
        }
        
        // Render the network
        renderNetwork();
      } catch (error) {
        console.error('Error loading network data:', error);
        // Show error state - NO FAKE DATA
        networkData = { nodes: [], links: [] };
        showNetworkError('Unable to load agent network data');
        updateNetworkOverview();
        renderNetwork();
      }
    }
    
    // REMOVED: Synthetic data generation functions
    // All network data now comes from real Supabase A2A connections
    
    function showNetworkError(message) {
      console.error('Network error:', message);
      // Empty network will show no connections which is accurate when APIs fail
    }
    
    // Update network overview cards
    function updateNetworkOverview() {
      const totalAgents = networkData.nodes.length;
      const activeAgents = networkData.nodes.filter(n => n.status === 'active').length;
      const connections = networkData.links.length;
      
      document.getElementById('network-total-agents').textContent = totalAgents;
      document.getElementById('network-active-agents').textContent = activeAgents;
      document.getElementById('network-connections').textContent = connections;
      document.getElementById('network-consensus-rounds').textContent = '3';
    }
    
    // Update network overview cards with real data
    function updateNetworkOverviewReal(networkResp) {
      const totalAgents = networkData.nodes.length;
      const activeAgents = networkData.nodes.filter(n => n.status === 'active').length;
      const connections = networkResp.totalConnections;
      const consensusRounds = networkResp.consensusConnections;
      
      document.getElementById('network-total-agents').textContent = totalAgents;
      document.getElementById('network-active-agents').textContent = activeAgents;
      document.getElementById('network-connections').textContent = `${connections} REAL`;
      document.getElementById('network-consensus-rounds').textContent = consensusRounds;
      
      // Update connection status button
      updateConnectionStatusButton();
      
      console.log('🌐 Network Overview Updated with Real Data:', {
        totalAgents,
        activeAgents,
        totalConnections: connections,
        messageConnections: networkResp.messageConnections,
        consensusConnections: networkResp.consensusConnections
      });
    }
    
    // Update connection status button with real data only
    function updateConnectionStatusButton() {
      const btn = document.getElementById('connection-status-btn');
      const realConnections = networkData.links.filter(link => link.real).length;
      const totalConnections = networkData.links.length;
      
      if (realConnections > 0) {
        btn.innerHTML = `✅ ${realConnections} Active`;
        btn.className = 'jobs-action-button primary';
        btn.title = `${realConnections} real connections from Supabase A2A system`;
      } else {
        btn.innerHTML = `⚠️ No Connections`;
        btn.className = 'jobs-action-button secondary';
        btn.title = 'No real agent connections found - connect agents to see network';
      }
    }
    
    // Render the network visualization
    function renderNetwork() {
      // Update links
      link = link.data(networkData.links);
      link.exit().remove();
      link = link.enter().append('line')
        .attr('class', d => `network-link ${d.real ? 'real-connection' : 'synthetic-connection'} ${d.type || 'message'}-link`)
        .attr('stroke', d => getLinkColor(d))
        .attr('stroke-width', d => getLinkWidth(d))
        .attr('stroke-dasharray', d => d.type === 'consensus' ? '5,5' : null)
        .merge(link);
      
      // Update nodes
      node = node.data(networkData.nodes);
      node.exit().remove();
      node = node.enter().append('circle')
        .attr('class', 'network-node')
        .attr('r', 15)
        .attr('fill', d => getNodeColor(d.type, d.status))
        .attr('stroke', '#fff')
        .attr('stroke-width', 2)
        .call(d3.drag()
          .on('start', dragstarted)
          .on('drag', dragged)
          .on('end', dragended))
        .on('click', handleNodeClick)
        .merge(node);
      
      // Update labels
      nodeLabels = nodeLabels.data(networkData.nodes);
      nodeLabels.exit().remove();
      nodeLabels = nodeLabels.enter().append('text')
        .attr('class', 'network-node-label')
        .text(d => getNodeLabel(d.name))
        .merge(nodeLabels);
      
      // Update simulation
      simulation.nodes(networkData.nodes);
      simulation.force('link').links(networkData.links);
      simulation.alpha(1).restart();
      
      // Update positions on tick
      simulation.on('tick', () => {
        link
          .attr('x1', d => d.source.x)
          .attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x)
          .attr('y2', d => d.target.y);
        
        node
          .attr('cx', d => d.x)
          .attr('cy', d => d.y);
        
        nodeLabels
          .attr('x', d => d.x)
          .attr('y', d => d.y + 4);
      });
    }
    
    // Get node color based on type and status
    function getNodeColor(type, status) {
      if (status === 'inactive') return '#8E8E93';
      
      const colors = {
        'analytics': '#007AFF',
        'financial': '#34C759',
        'ml': '#FF9500',
        'data': '#AF52DE'
      };
      
      return colors[type] || '#007AFF';
    }
    
    // Get node label (initials)
    function getNodeLabel(name) {
      return name.split(' ').map(word => word.charAt(0)).join('').toUpperCase().slice(0, 2);
    }
    
    // Get link color based on connection type
    function getLinkColor(link) {
      if (!link.real) return '#8E8E93'; // Gray for synthetic
      
      switch (link.type) {
        case 'message': return '#007AFF'; // Blue for messages
        case 'consensus': return '#34C759'; // Green for consensus
        case 'hybrid': return '#FF9500'; // Orange for both
        default: return '#007AFF';
      }
    }
    
    // Get link width based on connection activity
    function getLinkWidth(link) {
      if (!link.real) return 1;
      
      // Thicker lines for more active connections
      const baseWidth = 2;
      const count = link.count || 1;
      return Math.min(baseWidth + (count * 0.5), 6);
    }
    
    // Handle node click
    function handleNodeClick(event, d) {
      event.stopPropagation();
      
      // Clear previous selection
      node.classed('selected', false);
      
      // Select clicked node
      d3.select(this).classed('selected', true);
      selectedNode = d;
      
      // Show agent details
      showAgentDetails(d);
    }
    
    // Show agent details in sidebar
    function showAgentDetails(agent) {
      const sidebar = document.getElementById('agent-details-sidebar');
      const content = document.getElementById('agent-details-content');
      
      content.innerHTML = `
        <div class="a2a-agent-header">
          <div class="a2a-agent-icon ${agent.type}">${getNodeLabel(agent.name)}</div>
          <div class="a2a-agent-identity">
            <h3 class="a2a-agent-name">${agent.name}</h3>
            <div class="a2a-agent-id">${agent.id}</div>
          </div>
          <div class="a2a-agent-status-indicator ${agent.status === 'active' ? '' : 'inactive'}"></div>
        </div>
        
        <div class="a2a-capabilities">
          <div class="a2a-capability-label">Agent Capabilities</div>
          <div class="a2a-capability-list">
            ${(agent.capabilities || ['real-time-processing', 'data-analysis', 'decision-making'])
              .map(cap => `<span class="a2a-capability-tag">${cap}</span>`)
              .join('')}
          </div>
        </div>
        
        <div class="a2a-agent-description">
          ${agent.description || 'Advanced AI agent for financial intelligence and real-time decision making.'}
        </div>
        
        <div class="jobs-model-actions">
          <button class="jobs-action-button primary" onclick="sendMessageToAgent('${agent.id}')">Send Message</button>
          <button class="jobs-action-button" onclick="viewAgentLogs('${agent.id}')">View Logs</button>
        </div>
      `;
      
      sidebar.classList.add('open');
    }
    
    // Close agent details sidebar
    function closeAgentDetails() {
      const sidebar = document.getElementById('agent-details-sidebar');
      sidebar.classList.remove('open');
      
      // Clear selection if nodes exist
      if (typeof node !== 'undefined' && node) {
        node.classed('selected', false);
      }
      selectedNode = null;
    }
    
    // Network control functions
    function resetNetworkView() {
      if (svg) {
        svg.transition().duration(750).call(
          d3.zoom().transform,
          d3.zoomIdentity
        );
      }
    }
    
    function refreshNetworkData() {
      console.log('Refreshing network data...');
      loadNetworkVisualization(true);
    }
    
    function showConnectionInfo() {
      const hasRealConnections = networkData.links.some(link => link.real);
      const realConnections = networkData.links.filter(link => link.real).length;
      const totalConnections = networkData.links.length;
      
      if (hasRealConnections) {
        alert(`✅ Network Connections Status\n\nDisplaying REAL agent-to-agent connections from Supabase!\n\nConnection Details:\n• ${realConnections} real connections\n• ${totalConnections - realConnections} synthetic connections\n• Real connections include:\n  - A2A message communications (blue lines)\n  - Consensus voting connections (green dashed lines)\n  - Hybrid connections (orange lines)\n\nData Source: Live Supabase A2A messages and consensus votes`);
      } else {
        alert('⚠️ Network Connections Status\n\nNo real agent-to-agent connections found.\n\nTo create real agent connections:\n• Real connections are tracked in Supabase A2A messages table\n• Use the A2A Visual Trust Builder to create connections\n• Connect agents using the "Connect" buttons above\n• Deploy agents to live network for authentic interactions\n\nClick "Trust" tab to access the Visual Trust Builder.');
      }
    }
    
    // Drag handlers
    function dragstarted(event, d) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }
    
    function dragged(event, d) {
      d.fx = event.x;
      d.fy = event.y;
    }
    
    function dragended(event, d) {
      if (!event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }
    
    // Agent interaction functions
    async function sendMessageToAgent(agentId) {
      const message = prompt(`Send message to ${agentId}:`);
      if (message) {
        try {
          const response = await fetch('/api/a2a-agent-system', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: 'send_message',
              from_agent: 'user',
              to_agent: agentId,
              message: message
            })
          });
          
          if (!response.ok) {
            throw new Error('Failed to send message');
          }
          
          alert(`Message sent to ${agentId} successfully`);
        } catch (error) {
          console.error('Error sending message:', error);
          alert('Failed to send message. Agent communication system may be unavailable.');
        }
      }
    }
    
    async function viewAgentLogs(agentId) {
      try {
        const response = await fetch('/api/supabase-proxy', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'select',
            table: 'agent_activity',
            conditions: { agent_id: agentId },
            limit: 10,
            orderBy: { column: 'created_at', ascending: false }
          })
        });
        
        if (!response.ok) {
          throw new Error('Failed to load agent logs');
        }
        
        const data = await response.json();
        if (data.data && data.data.length > 0) {
          const logs = data.data.map(log => 
            `${new Date(log.created_at).toLocaleString()}: ${log.activity_type} - ${JSON.stringify(log.details || {})}`
          ).join('\n');
          alert(`Logs for ${agentId}:\n\n${logs}`);
        } else {
          alert(`No activity logs found for agent ${agentId}`);
        }
      } catch (error) {
        console.error('Error loading agent logs:', error);
        alert('Failed to load agent logs. Database connection may be unavailable.');
      }
    }
    
    // Initialize network visualization when page loads (since it's in overview)
    let networkInitialized = false;
    let agentsLoaded = false;
    
    document.addEventListener('DOMContentLoaded', function() {
      // Only load once
      if (!agentsLoaded) {
        loadOverviewAgents();
        agentsLoaded = true;
      }
      
      // Initialize network visualization after page loads
      if (!networkInitialized) {
        setTimeout(() => {
          initializeNetworkVisualization();
          networkInitialized = true;
        }, 1000);
      }
    });
    
    // Load agent cards for overview section
    async function loadOverviewAgents() {
      if (agentsLoaded) return; // Prevent duplicate loading
      
      try {
        const response = await fetch('/api/unified?action=a2a_agents');
        const data = await response.json();
        const agents = data.agents || data;
        
        const grid = document.getElementById('overview-agents-grid');
        if (!grid) {
          console.error('Overview agents grid not found');
          return;
        }
        
        grid.innerHTML = ''; // Clear existing content
        
        // Show first 8 agents in overview
        agents.slice(0, 8).forEach(agent => {
          const card = createAgentCard(agent);
          if (card) {
            grid.appendChild(card);
          }
        });
        
        agentsLoaded = true;
      } catch (error) {
        console.error('Error loading overview agents:', error);
      }
    }
    
    // Enhanced showSection function to initialize network when overview is shown
    const originalShowSection = showSection;
    showSection = function(sectionId) {
      originalShowSection(sectionId);
      
      // If showing overview section and not initialized, initialize network
      if (sectionId === 'overview' && !networkInitialized) {
        setTimeout(() => {
          initializeNetworkVisualization();
          networkInitialized = true;
        }, 300);
      }
    };
    
  </script>
  <!-- Agent Modal -->
  <div class="agent-modal-overlay" id="agent-modal-overlay">
    <div class="agent-modal">
      <div class="agent-modal-header">
        <button class="agent-modal-close" onclick="closeAgentModal()">×</button>
        <div class="agent-modal-agent-header">
          <div class="agent-modal-icon" id="modal-agent-icon">AG</div>
          <div class="agent-modal-identity">
            <h2 id="modal-agent-name">Agent Name</h2>
            <div class="agent-modal-agent-id" id="modal-agent-id">agent.id</div>
          </div>
        </div>
      </div>
      
      <div class="agent-modal-content">
        <div class="agent-modal-section">
          <div class="agent-modal-section-title">Description</div>
          <div class="agent-modal-description" id="modal-agent-description">
            Agent description will appear here.
          </div>
        </div>
        
        <div class="agent-modal-section">
          <div class="agent-modal-section-title">Capabilities</div>
          <div class="agent-modal-capability-grid" id="modal-agent-capabilities">
            <!-- Capability tags will be inserted here -->
          </div>
        </div>
        
        <div class="agent-modal-section">
          <div class="agent-modal-section-title">Performance Metrics</div>
          <div class="agent-modal-metrics">
            <div class="agent-modal-metric">
              <div class="agent-modal-metric-value" id="modal-response-time">--</div>
              <div class="agent-modal-metric-label">Avg Response</div>
            </div>
            <div class="agent-modal-metric">
              <div class="agent-modal-metric-value" id="modal-success-rate">--</div>
              <div class="agent-modal-metric-label">Success Rate</div>
            </div>
            <div class="agent-modal-metric">
              <div class="agent-modal-metric-value" id="modal-requests">--</div>
              <div class="agent-modal-metric-label">Total Requests</div>
            </div>
          </div>
        </div>
        
        <div class="agent-modal-actions">
          <button class="agent-modal-button secondary" onclick="closeAgentModal()">Close</button>
          <button class="agent-modal-button primary" id="modal-connect-btn" onclick="connectAgentFromModal()">Connect Agent</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Agent Detail Screen -->
  <div class="agent-detail-screen" id="agent-detail-screen">
    <div class="agent-detail-header">
      <button class="agent-detail-back" onclick="closeAgentDetailScreen()">
        ← Back to Agents
      </button>
      <h1 class="agent-detail-title" id="detail-screen-title">Agent Details</h1>
    </div>

    <div class="agent-detail-content">
      <!-- Hero Section -->
      <div class="agent-detail-hero">
        <div class="agent-detail-icon" id="detail-agent-icon">AG</div>
        <h1 class="agent-detail-name" id="detail-agent-name">Agent Name</h1>
        <p class="agent-detail-tagline" id="detail-agent-tagline">Advanced AI agent for financial intelligence</p>
        <div class="agent-detail-technical-id" id="detail-agent-id">agent.id</div>
      </div>

      <!-- Performance Metrics -->
      <div class="agent-detail-section">
        <h2 class="agent-detail-section-title">Live Performance</h2>
        <div class="agent-detail-metrics">
          <div class="agent-detail-metric">
            <div class="agent-detail-metric-value" id="detail-response-time">--ms</div>
            <div class="agent-detail-metric-label">Avg Response</div>
          </div>
          <div class="agent-detail-metric">
            <div class="agent-detail-metric-value" id="detail-success-rate">--%</div>
            <div class="agent-detail-metric-label">Success Rate</div>
          </div>
          <div class="agent-detail-metric">
            <div class="agent-detail-metric-value" id="detail-requests">--</div>
            <div class="agent-detail-metric-label">Total Requests</div>
          </div>
          <div class="agent-detail-metric">
            <div class="agent-detail-metric-value" id="detail-uptime">--%</div>
            <div class="agent-detail-metric-label">Uptime</div>
          </div>
        </div>
      </div>

      <!-- Understanding Section -->
      <div class="agent-detail-section">
        <h2 class="agent-detail-section-title">Understanding This Agent</h2>
        <div class="agent-detail-cards-grid">
          <div class="agent-detail-card">
            <h3 class="agent-detail-card-title">What It Does</h3>
            <div class="agent-detail-card-content" id="detail-what-it-does">
              This agent processes financial data using advanced algorithms to provide insights and recommendations.
            </div>
          </div>
          
          <div class="agent-detail-card">
            <h3 class="agent-detail-card-title">Why It Matters</h3>
            <div class="agent-detail-card-content" id="detail-why-it-matters">
              This capability is essential for making informed financial decisions and managing risk effectively.
            </div>
          </div>
          
          <div class="agent-detail-card">
            <h3 class="agent-detail-card-title">When To Use</h3>
            <div class="agent-detail-card-content" id="detail-when-to-use">
              Use this agent when you need accurate, real-time analysis of financial data and market conditions.
            </div>
          </div>
        </div>
      </div>

      <!-- Mathematical Foundation -->
      <div class="agent-detail-section" id="mathematical-section">
        <h2 class="agent-detail-section-title">Mathematical Foundation</h2>
        <div class="agent-detail-card">
          <h3 class="agent-detail-card-title">Core Formula</h3>
          <div class="agent-detail-card-content">
            <div class="latex-formula" id="detail-formula">
              Loading mathematical definition...
            </div>
            <p>This formula represents the mathematical foundation that powers the agent's calculations and decision-making process.</p>
          </div>
        </div>
      </div>

      <!-- How It Works -->
      <div class="agent-detail-section">
        <h2 class="agent-detail-section-title">How It Works</h2>
        <div class="agent-detail-card">
          <h3 class="agent-detail-card-title">Process Flow</h3>
          <div class="agent-detail-card-content">
            <div class="process-flow" id="detail-process-flow">
              <!-- Process steps will be inserted here -->
            </div>
          </div>
        </div>
      </div>
      
      <!-- Agent BPMN Process -->
      <div class="agent-detail-section">
        <h2 class="agent-detail-section-title">Internal Process Model</h2>
        <div class="agent-detail-card">
          <h3 class="agent-detail-card-title">BPMN Process Diagram</h3>
          <div class="agent-detail-card-content">
            <div class="agent-bpmn-container" style="height: 400px; position: relative; background: #f8f9fa; border-radius: 8px; overflow: hidden;">
              <canvas id="agent-bpmn-canvas" style="width: 100%; height: 100%;"></canvas>
              <div class="agent-bpmn-loading" id="agent-bpmn-loading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; align-items: center; gap: 12px;">
                <div class="loading-spinner"></div>
                <span>Loading agent process...</span>
              </div>
            </div>
            <div id="agent-data-flow" style="margin-top: 20px;">
              <!-- Data flow details will be inserted here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Integration -->
      <div class="agent-detail-section">
        <h2 class="agent-detail-section-title">System Integration</h2>
        <div class="agent-detail-card">
          <h3 class="agent-detail-card-title">Data Flow</h3>
          <div class="agent-detail-card-content">
            <div class="integration-diagram" id="detail-integration">
              <div class="diagram-node">Market Data</div>
              <div class="diagram-node">This Agent</div>
              <div class="diagram-node">Analysis Results</div>
              <div class="diagram-node">User Interface</div>
            </div>
            <p>This agent seamlessly integrates with our financial data pipeline to provide real-time insights.</p>
          </div>
        </div>
      </div>

      <!-- Code Example -->
      <div class="agent-detail-section">
        <h2 class="agent-detail-section-title">Usage Example</h2>
        <div class="agent-detail-card">
          <h3 class="agent-detail-card-title">API Integration</h3>
          <div class="agent-detail-card-content">
            <div class="code-example" id="detail-code-example">
// Connect to agent
const response = await fetch('/api/supabase-proxy', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    action: 'rpc',
    function_name: 'agent_function_name',
    params: { /* your parameters */ }
  })
});

const result = await response.json();
console.log('Agent result:', result);
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Bar -->
    <div class="agent-detail-actions">
      <button class="agent-detail-action-button secondary" onclick="closeAgentDetailScreen()">Close</button>
      <button class="agent-detail-action-button primary" id="detail-connect-btn" onclick="connectAgentFromDetail()">Connect Agent</button>
    </div>
  </div>
  
  </script>

<!-- A2A Wizard Interface -->
<div id="a2a-wizard-overlay" class="modal-overlay" style="display: none;">
  <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
    <div class="modal-header">
      <h2>A2A Agent Development Wizard</h2>
      <button class="modal-close" onclick="closeA2AWizard()">×</button>
    </div>
    
    <div id="wizard-content" class="wizard-container">
      <div class="wizard-step active" id="step-1">
        <h3>🤖 Describe Your A2A Agent</h3>
        <p>Tell me what you want your A2A agent to do. I'll help you code the blockchain integration.</p>
        <textarea id="agent-description" placeholder="e.g., I want an agent that monitors portfolio risk and automatically executes hedging strategies on-chain..." rows="4"></textarea>
        <button class="jobs-action-button primary" onclick="processWithGrok4()">Generate Code with Grok4</button>
      </div>
      
      <div class="wizard-step" id="step-2" style="display: none;">
        <h3>⚡ Generated A2A Code</h3>
        <div id="generated-code"></div>
        <button class="jobs-action-button primary" onclick="deployAgent()">Deploy Agent</button>
        <button class="jobs-action-button" onclick="modifyAgent()">Modify Code</button>
      </div>
    </div>
  </div>
</div>

<script>
function showA2AWizard() {
  document.getElementById('a2a-wizard-overlay').style.display = 'flex';
}

function closeA2AWizard() {
  document.getElementById('a2a-wizard-overlay').style.display = 'none';
}

async function processWithGrok4() {
  const description = document.getElementById('agent-description').value;
  if (!description.trim()) {
    alert('Please describe your A2A agent first');
    return;
  }
  
  const codeContainer = document.getElementById('generated-code');
  codeContainer.innerHTML = '<div class="loading">🤖 Grok4 is generating your A2A agent code...</div>';
  
  try {
    const response = await fetch('/api/a2a-grok-autonomy', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        action: 'generate_a2a_code',
        description: description
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      codeContainer.innerHTML = `<pre><code>${result.code}</code></pre>`;
      document.getElementById('step-1').style.display = 'none';
      document.getElementById('step-2').style.display = 'block';
    } else {
      codeContainer.innerHTML = `<div class="error">Error: ${result.error}</div>`;
    }
  } catch (error) {
    codeContainer.innerHTML = `<div class="error">Error: ${error.message}</div>`;
  }
}

function deployAgent() {
  alert('Agent deployment initiated! Check the deployment status in the network.');
  closeA2AWizard();
}

function modifyAgent() {
  document.getElementById('step-2').style.display = 'none';
  document.getElementById('step-1').style.display = 'block';
}

// Process Designer Functions
function showProcessDesigner() {
  // Create modal if it doesn't exist
  if (!document.getElementById('processDesignerModal')) {
    createProcessDesignerModal();
  }
  
  document.getElementById('processDesignerModal').style.display = 'flex';
  loadBPMNDiagram();
}

function closeProcessDesigner() {
  document.getElementById('processDesignerModal').style.display = 'none';
}

function createProcessDesignerModal() {
  const modal = document.createElement('div');
  modal.id = 'processDesignerModal';
  modal.className = 'a2a-wizard-overlay';
  modal.style.display = 'none';
  modal.innerHTML = `
    <div class="a2a-wizard" style="max-width: 1200px; width: 90%; height: 90%;">
      <div class="a2a-wizard-header">
        <h2 class="a2a-wizard-title">Process Designer - Financial Workflows</h2>
        <button class="a2a-wizard-close" onclick="closeProcessDesigner()">×</button>
      </div>
      
      <div class="a2a-wizard-body" style="height: calc(100% - 60px); overflow: hidden;">
        <!-- Process Selector -->
        <div class="process-selector" style="display: flex; gap: 12px; margin-bottom: 20px; padding: 0 20px;">
          <button class="process-tab active" onclick="switchProcess('sentiment')">Market Sentiment Analysis</button>
          <button class="process-tab" onclick="switchProcess('portfolio')">Portfolio Rebalancing</button>
          <button class="process-tab" onclick="switchProcess('risk')">Risk Management</button>
          <button class="process-tab" onclick="switchProcess('compliance')">Compliance Check</button>
        </div>
        
        <!-- BPMN Container -->
        <div class="bpmn-container" style="height: 400px; position: relative; background: #f8f9fa; border-radius: 12px; margin: 0 20px; overflow: hidden;">
          <canvas id="bpmn-canvas" style="width: 100%; height: 100%;"></canvas>
          <div class="bpmn-loading" id="bpmn-loading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; align-items: center; gap: 12px;">
            <div class="loading-spinner"></div>
            <span>Loading financial process...</span>
          </div>
        </div>
        
        <!-- Process Info -->
        <div class="process-info" style="padding: 20px; overflow-y: auto; max-height: calc(100% - 500px);">
          <h3 id="process-title" style="font-size: 24px; font-weight: 600; margin-bottom: 12px;">Market Sentiment Analysis Process</h3>
          <p id="process-description" style="color: #636366; margin-bottom: 20px;">Automated process for analyzing market sentiment using real-time news and social media data to inform trading decisions.</p>
          
          <!-- Active Agents -->
          <div style="margin-bottom: 24px;">
            <h4 style="font-size: 18px; font-weight: 600; margin-bottom: 12px;">Active A2A Agents</h4>
            <div id="process-agents" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
          </div>
          
          <!-- Process Steps -->
          <div>
            <h4 style="font-size: 18px; font-weight: 600; margin-bottom: 12px;">Process Steps</h4>
            <div id="process-steps" style="display: grid; gap: 12px;"></div>
          </div>
        </div>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
}

// Load BPMN Diagram
async function loadBPMNDiagram() {
  const loading = document.getElementById('bpmn-loading');
  const canvas = document.getElementById('bpmn-canvas');
  
  // Show loading
  loading.style.display = 'flex';
  
  try {
    // Fetch real agents from database
    const response = await fetch('/api/unified?action=a2a_agents');
    const data = await response.json();
    const agents = data.agents || [];
    
    // Hide loading
    loading.style.display = 'none';
    
    // Store agents globally for process switching
    window.currentAgents = agents;
    
    // Draw the process diagram
    drawFinancialProcess('sentiment', agents);
    
  } catch (error) {
    console.error('Error loading agents:', error);
    loading.innerHTML = '<span style="color: #FF3B30;">Failed to load process</span>';
  }
}

// Draw Financial Process
async function drawFinancialProcess(processType, agents) {
  const canvas = document.getElementById('bpmn-canvas');
  const ctx = canvas.getContext('2d');
  
  // Set canvas size
  canvas.width = canvas.offsetWidth * window.devicePixelRatio;
  canvas.height = canvas.offsetHeight * window.devicePixelRatio;
  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
  
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Fetch CSN schema for data flow
  let csnSchema = null;
  try {
    const csnResponse = await fetch('/api/csn-generator?action=generate');
    const csnData = await csnResponse.json();
    csnSchema = csnData.csn;
  } catch (error) {
    console.error('Failed to fetch CSN schema:', error);
  }
  
  // Define process flows with data integration
  const processes = {
    sentiment: {
      title: 'Market Sentiment Analysis Process',
      description: 'Automated process for analyzing market sentiment using real-time news and social media data to inform trading decisions.',
      lanes: [
        { name: 'News & Sentiment', y: 50, agents: ['News Sentiment Tracker', 'News Content Processing Agent'] },
        { name: 'Risk Assessment', y: 150, agents: ['Risk Calculator', 'Portfolio Risk Agent'] },
        { name: 'Trading', y: 250, agents: ['Trading Strategy', 'Portfolio Optimizer'] },
        { name: 'Compliance', y: 350, agents: ['Compliance Officer', 'Audit Trail Agent'] }
      ],
      steps: [
        { 
          title: 'Collect News Data', 
          lane: 0, 
          x: 100, 
          next: [1],
          dataRead: ['market_data', 'news_articles'],
          dataWrite: ['agent_activity']
        },
        { 
          title: 'Analyze Sentiment', 
          lane: 0, 
          x: 250, 
          next: [2],
          dataRead: ['news_articles'],
          dataWrite: ['news_articles.sentiment', 'agent_activity']
        },
        { 
          title: 'Calculate Risk Impact', 
          lane: 1, 
          x: 400, 
          next: [3],
          dataRead: ['portfolios', 'market_data', 'news_articles.sentiment'],
          dataWrite: ['risk_metrics', 'agent_activity']
        },
        { 
          title: 'Generate Trading Signal', 
          lane: 2, 
          x: 550, 
          next: [4],
          dataRead: ['risk_metrics', 'portfolios', 'market_data'],
          dataWrite: ['trading_signals', 'agent_activity']
        },
        { 
          title: 'Compliance Check', 
          lane: 3, 
          x: 700, 
          next: [5],
          dataRead: ['trading_signals', 'portfolios', 'deployed_contracts'],
          dataWrite: ['compliance_checks', 'blockchain_events']
        },
        { 
          title: 'Execute Trade', 
          lane: 2, 
          x: 850, 
          next: [],
          dataRead: ['trading_signals', 'compliance_checks'],
          dataWrite: ['portfolios', 'blockchain_events', 'a2a_messages']
        }
      ]
    },
    portfolio: {
      title: 'Portfolio Rebalancing Process',
      description: 'Automated portfolio rebalancing based on risk metrics and market conditions.',
      lanes: [
        { name: 'Analysis', y: 50, agents: ['Portfolio Optimizer', 'Risk Calculator'] },
        { name: 'Decision', y: 150, agents: ['Trading Strategy', 'Scenario Analyzer'] },
        { name: 'Execution', y: 250, agents: ['Trading Agent', 'Market Maker'] },
        { name: 'Reporting', y: 350, agents: ['Audit Trail Agent', 'Performance Monitor'] }
      ],
      steps: [
        { 
          title: 'Analyze Portfolio', 
          lane: 0, 
          x: 100, 
          next: [1],
          dataRead: ['portfolios', 'market_data'],
          dataWrite: ['risk_metrics']
        },
        { 
          title: 'Generate Scenarios', 
          lane: 1, 
          x: 250, 
          next: [2],
          dataRead: ['risk_metrics', 'market_data'],
          dataWrite: ['trading_signals']
        },
        { 
          title: 'Execute Rebalancing', 
          lane: 2, 
          x: 400, 
          next: [3],
          dataRead: ['trading_signals'],
          dataWrite: ['portfolios', 'blockchain_events']
        },
        { 
          title: 'Update Reports', 
          lane: 3, 
          x: 550, 
          next: [],
          dataRead: ['portfolios', 'blockchain_events'],
          dataWrite: ['agent_activity', 'a2a_messages']
        }
      ]
    },
    risk: {
      title: 'Risk Management Process',
      description: 'Real-time risk monitoring and automated hedging strategies.',
      lanes: [
        { name: 'Monitoring', y: 50, agents: ['Risk Calculator', 'Anomaly Detection Agent'] },
        { name: 'Analysis', y: 150, agents: ['Scenario Analyzer', 'Stress Test Agent'] },
        { name: 'Hedging', y: 250, agents: ['FX Analyzer', 'Options Pricing Agent'] },
        { name: 'Execution', y: 350, agents: ['Trading Agent', 'Compliance Officer'] }
      ],
      steps: [
        { 
          title: 'Monitor Risk Metrics', 
          lane: 0, 
          x: 100, 
          next: [1],
          dataRead: ['portfolios', 'market_data', 'risk_metrics'],
          dataWrite: ['agent_activity']
        },
        { 
          title: 'Detect Anomalies', 
          lane: 0, 
          x: 250, 
          next: [2],
          dataRead: ['risk_metrics', 'blockchain_events'],
          dataWrite: ['a2a_messages', 'agent_activity']
        },
        { 
          title: 'Run Stress Tests', 
          lane: 1, 
          x: 400, 
          next: [3],
          dataRead: ['portfolios', 'market_data'],
          dataWrite: ['risk_metrics']
        },
        { 
          title: 'Design Hedge', 
          lane: 2, 
          x: 550, 
          next: [4],
          dataRead: ['risk_metrics', 'market_data'],
          dataWrite: ['trading_signals']
        },
        { 
          title: 'Execute Hedge', 
          lane: 3, 
          x: 700, 
          next: [],
          dataRead: ['trading_signals', 'deployed_contracts'],
          dataWrite: ['portfolios', 'blockchain_events']
        }
      ]
    },
    compliance: {
      title: 'Compliance Check Process',
      description: 'Automated regulatory compliance validation and reporting.',
      lanes: [
        { name: 'Data Collection', y: 50, agents: ['Data Collector', 'Market Data Agent'] },
        { name: 'Validation', y: 150, agents: ['Compliance Officer', 'Basel III Agent'] },
        { name: 'Reporting', y: 250, agents: ['Audit Trail Agent', 'Report Generator'] },
        { name: 'Blockchain', y: 350, agents: ['Smart Contract Agent', 'Blockchain Logger'] }
      ],
      steps: [
        { 
          title: 'Collect Data', 
          lane: 0, 
          x: 100, 
          next: [1],
          dataRead: ['portfolios', 'trading_signals', 'blockchain_events'],
          dataWrite: ['agent_activity']
        },
        { 
          title: 'Validate Rules', 
          lane: 1, 
          x: 250, 
          next: [2],
          dataRead: ['portfolios', 'deployed_contracts'],
          dataWrite: ['compliance_checks']
        },
        { 
          title: 'Generate Report', 
          lane: 2, 
          x: 400, 
          next: [3],
          dataRead: ['compliance_checks', 'agent_activity'],
          dataWrite: ['a2a_messages']
        },
        { 
          title: 'Record on Chain', 
          lane: 3, 
          x: 550, 
          next: [],
          dataRead: ['compliance_checks'],
          dataWrite: ['blockchain_events', 'deployed_contracts']
        }
      ]
    }
  };
  
  const process = processes[processType] || processes.sentiment;
  
  // Update process info
  document.getElementById('process-title').textContent = process.title;
  document.getElementById('process-description').textContent = process.description;
  
  // Draw swimlanes
  ctx.strokeStyle = '#E5E5EA';
  ctx.lineWidth = 1;
  ctx.font = '14px -apple-system, BlinkMacSystemFont, sans-serif';
  ctx.fillStyle = '#1D1D1F';
  
  process.lanes.forEach(lane => {
    // Lane header
    ctx.fillStyle = '#F2F2F7';
    ctx.fillRect(0, lane.y - 20, 80, 80);
    
    // Lane label
    ctx.fillStyle = '#1D1D1F';
    ctx.save();
    ctx.translate(40, lane.y + 30);
    ctx.rotate(-Math.PI / 2);
    ctx.textAlign = 'center';
    ctx.fillText(lane.name, 0, 0);
    ctx.restore();
    
    // Lane line
    ctx.beginPath();
    ctx.moveTo(80, lane.y + 60);
    ctx.lineTo(canvas.width, lane.y + 60);
    ctx.stroke();
  });
  
  // Draw process steps
  ctx.fillStyle = '#FFFFFF';
  ctx.strokeStyle = '#007AFF';
  ctx.lineWidth = 2;
  
  process.steps.forEach((step, index) => {
    const lane = process.lanes[step.lane];
    const y = lane.y + 10;
    
    // Draw box
    ctx.fillStyle = '#FFFFFF';
    ctx.fillRect(step.x - 60, y, 120, 40);
    ctx.strokeRect(step.x - 60, y, 120, 40);
    
    // Draw text
    ctx.fillStyle = '#1D1D1F';
    ctx.font = '13px -apple-system, BlinkMacSystemFont, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(step.title, step.x, y + 25);
    
    // Draw connections
    step.next.forEach(nextIndex => {
      const nextStep = process.steps[nextIndex];
      const nextLane = process.lanes[nextStep.lane];
      const nextY = nextLane.y + 30;
      
      ctx.beginPath();
      ctx.moveTo(step.x + 60, y + 20);
      ctx.lineTo(nextStep.x - 60, nextY);
      ctx.stroke();
      
      // Arrow
      ctx.beginPath();
      ctx.moveTo(nextStep.x - 60, nextY);
      ctx.lineTo(nextStep.x - 65, nextY - 5);
      ctx.lineTo(nextStep.x - 65, nextY + 5);
      ctx.closePath();
      ctx.fillStyle = '#007AFF';
      ctx.fill();
    });
  });
  
  // Update agents list
  const agentsContainer = document.getElementById('process-agents');
  agentsContainer.innerHTML = '';
  
  const usedAgents = new Set();
  process.lanes.forEach(lane => {
    lane.agents.forEach(agentName => usedAgents.add(agentName));
  });
  
  // Find matching real agents
  usedAgents.forEach(agentName => {
    const realAgent = agents.find(a => 
      a.agent_name === agentName || 
      a.agent_name.includes(agentName.split(' ')[0])
    );
    
    if (realAgent) {
      const tag = document.createElement('div');
      tag.className = 'a2a-capability-tag';
      tag.style.cursor = 'pointer';
      tag.textContent = getAppleFriendlyName(realAgent.agent_name, realAgent.agent_id);
      tag.onclick = () => showAgentDetailScreen(realAgent.agent_id);
      agentsContainer.appendChild(tag);
    }
  });
  
  // Update process steps with data flow
  const stepsContainer = document.getElementById('process-steps');
  stepsContainer.innerHTML = process.steps.map((step, index) => {
    const dataReadFormatted = step.dataRead ? step.dataRead.map(table => 
      `<span class="data-tag read">${table}</span>`
    ).join(' ') : '';
    
    const dataWriteFormatted = step.dataWrite ? step.dataWrite.map(table => 
      `<span class="data-tag write">${table}</span>`
    ).join(' ') : '';
    
    return `
      <div style="display: flex; gap: 12px; align-items: flex-start; margin-bottom: 16px;">
        <div style="width: 32px; height: 32px; background: #007AFF; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0;">
          ${index + 1}
        </div>
        <div style="flex: 1;">
          <h5 style="font-weight: 600; margin: 0 0 4px;">${step.title}</h5>
          <p style="color: #636366; margin: 0 0 8px; font-size: 14px;">
            Performed by ${process.lanes[step.lane].agents.join(' & ')}
          </p>
          ${dataReadFormatted || dataWriteFormatted ? `
            <div style="margin-top: 8px;">
              ${dataReadFormatted ? `<div style="margin-bottom: 4px;">📖 Reads: ${dataReadFormatted}</div>` : ''}
              ${dataWriteFormatted ? `<div>✍️ Writes: ${dataWriteFormatted}</div>` : ''}
            </div>
          ` : ''}
        </div>
      </div>
    `;
  }).join('');
  
  // Add data flow visualization
  if (csnSchema) {
    addDataFlowPanel(process, csnSchema);
  }
}

// Add data flow panel
function addDataFlowPanel(process, csnSchema) {
  // Create data flow section if it doesn't exist
  let dataFlowSection = document.getElementById('data-flow-section');
  if (!dataFlowSection) {
    dataFlowSection = document.createElement('div');
    dataFlowSection.id = 'data-flow-section';
    dataFlowSection.style.cssText = 'margin-top: 24px; padding-top: 24px; border-top: 1px solid #E5E5EA;';
    document.querySelector('.process-info').appendChild(dataFlowSection);
  }
  
  // Collect all data tables used in the process
  const dataTables = new Set();
  process.steps.forEach(step => {
    if (step.dataRead) step.dataRead.forEach(table => dataTables.add(table.split('.')[0]));
    if (step.dataWrite) step.dataWrite.forEach(table => dataTables.add(table.split('.')[0]));
  });
  
  // Generate CSN visualization
  let csnHtml = '<h4 style="font-size: 18px; font-weight: 600; margin-bottom: 12px;">📊 Data Resources (ORD)</h4>';
  csnHtml += '<div style="display: grid; gap: 12px;">';
  
  dataTables.forEach(tableName => {
    const entityName = `finsight.db.${toPascalCase(tableName)}`;
    const entity = csnSchema?.definitions?.[entityName];
    
    if (entity) {
      csnHtml += `
        <div style="background: #F8F9FA; border: 1px solid #E5E5EA; border-radius: 8px; padding: 12px;">
          <h5 style="font-weight: 600; margin: 0 0 8px; color: #007AFF;">
            ${entity['@ord.title'] || tableName}
          </h5>
          <p style="font-size: 13px; color: #636366; margin: 0 0 8px;">
            ${entity['@ord.description'] || 'Data resource'}
          </p>
          <div style="font-size: 12px; color: #8E8E93;">
            Fields: ${Object.keys(entity.elements || {}).slice(0, 5).join(', ')}${Object.keys(entity.elements || {}).length > 5 ? '...' : ''}
          </div>
        </div>
      `;
    } else {
      csnHtml += `
        <div style="background: #F8F9FA; border: 1px solid #E5E5EA; border-radius: 8px; padding: 12px;">
          <h5 style="font-weight: 600; margin: 0 0 4px;">${tableName}</h5>
          <p style="font-size: 12px; color: #8E8E93; margin: 0;">Data table</p>
        </div>
      `;
    }
  });
  
  csnHtml += '</div>';
  dataFlowSection.innerHTML = csnHtml;
}

// Helper function for Pascal Case
function toPascalCase(str) {
  return str.split('_').map(word => 
    word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
  ).join('');
}

// Switch Process
function switchProcess(processType) {
  // Update tabs
  document.querySelectorAll('.process-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Redraw process with new type
  drawFinancialProcess(processType, window.currentAgents || []);
}

// Show Visual Builder Info
function showVisualBuilderInfo() {
  alert('The A2A Visual Trust Builder allows you to:\n\n• Design financial processes visually\n• Connect real A2A agents\n• Generate smart contracts automatically\n• Deploy to blockchain with one click\n\nClick "Process Designer" to start building!');
}

// Load Agent BPMN - shows the internal process of a single agent
async function loadAgentBPMN(agent) {
  const canvas = document.getElementById('agent-bpmn-canvas');
  const loading = document.getElementById('agent-bpmn-loading');
  
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  
  // Set canvas size
  canvas.width = canvas.offsetWidth * window.devicePixelRatio;
  canvas.height = canvas.offsetHeight * window.devicePixelRatio;
  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
  
  // Show loading
  loading.style.display = 'flex';
  
  try {
    // Fetch CSN schema for data mapping
    const csnResponse = await fetch('/api/csn-generator?action=generate');
    const csnData = await csnResponse.json();
    const csnSchema = csnData.csn;
    
    // Hide loading
    loading.style.display = 'none';
    
    // Draw the agent's internal process
    drawAgentProcess(agent, ctx, canvas, csnSchema);
    
  } catch (error) {
    console.error('Error loading agent BPMN:', error);
    loading.innerHTML = '<span style="color: #FF3B30;">Failed to load process</span>';
  }
}

// Draw Agent Process
function drawAgentProcess(agent, ctx, canvas, csnSchema) {
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Define agent processes based on agent type
  const agentProcesses = getAgentProcessDefinition(agent);
  
  // Draw the process
  const process = agentProcesses[agent.agent_type] || agentProcesses.default;
  
  // Draw title
  ctx.font = '16px -apple-system, BlinkMacSystemFont, sans-serif';
  ctx.fillStyle = '#1D1D1F';
  ctx.fillText(agent.agent_name + ' Process', 20, 30);
  
  // Draw start event
  ctx.beginPath();
  ctx.arc(50, 100, 20, 0, 2 * Math.PI);
  ctx.fillStyle = '#FFFFFF';
  ctx.fill();
  ctx.strokeStyle = '#34C759';
  ctx.lineWidth = 3;
  ctx.stroke();
  
  // Draw process steps
  let x = 120;
  const y = 80;
  const stepWidth = 140;
  const stepHeight = 40;
  
  process.steps.forEach((step, index) => {
    // Draw task box
    ctx.fillStyle = '#FFFFFF';
    ctx.fillRect(x, y, stepWidth, stepHeight);
    ctx.strokeStyle = '#007AFF';
    ctx.lineWidth = 2;
    ctx.strokeRect(x, y, stepWidth, stepHeight);
    
    // Draw task text
    ctx.fillStyle = '#1D1D1F';
    ctx.font = '13px -apple-system, BlinkMacSystemFont, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(step.title, x + stepWidth/2, y + 25);
    
    // Draw connection from previous
    if (index > 0 || x === 120) {
      ctx.beginPath();
      ctx.moveTo(x - 20, y + stepHeight/2);
      ctx.lineTo(x, y + stepHeight/2);
      ctx.strokeStyle = '#8E8E93';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // Arrow
      ctx.beginPath();
      ctx.moveTo(x, y + stepHeight/2);
      ctx.lineTo(x - 5, y + stepHeight/2 - 5);
      ctx.lineTo(x - 5, y + stepHeight/2 + 5);
      ctx.closePath();
      ctx.fillStyle = '#8E8E93';
      ctx.fill();
    }
    
    // Draw data annotations
    ctx.font = '11px -apple-system, BlinkMacSystemFont, sans-serif';
    ctx.textAlign = 'center';
    
    // Input data
    if (step.inputs && step.inputs.length > 0) {
      ctx.fillStyle = '#34C759';
      ctx.fillText('↓ ' + step.inputs.join(', '), x + stepWidth/2, y - 5);
    }
    
    // Output data
    if (step.outputs && step.outputs.length > 0) {
      ctx.fillStyle = '#FF9500';
      ctx.fillText('↑ ' + step.outputs.join(', '), x + stepWidth/2, y + stepHeight + 15);
    }
    
    // Parameters
    if (step.parameters && step.parameters.length > 0) {
      ctx.fillStyle = '#AF52DE';
      ctx.fillText('⚙ ' + step.parameters.join(', '), x + stepWidth/2, y + stepHeight + 30);
    }
    
    x += stepWidth + 40;
  });
  
  // Draw end event
  ctx.beginPath();
  ctx.arc(x + 20, y + stepHeight/2, 20, 0, 2 * Math.PI);
  ctx.fillStyle = '#FFFFFF';
  ctx.fill();
  ctx.strokeStyle = '#FF3B30';
  ctx.lineWidth = 3;
  ctx.stroke();
  
  // Draw connection to end
  ctx.beginPath();
  ctx.moveTo(x - 20, y + stepHeight/2);
  ctx.lineTo(x, y + stepHeight/2);
  ctx.strokeStyle = '#8E8E93';
  ctx.lineWidth = 2;
  ctx.stroke();
  
  // Update data flow panel
  updateAgentDataFlow(agent, process, csnSchema);
}

// Get agent process definition based on type
function getAgentProcessDefinition(agent) {
  return {
    analytics: {
      steps: [
        {
          title: 'Receive Request',
          inputs: ['a2a_messages'],
          outputs: ['agent_activity'],
          parameters: ['request_type', 'urgency']
        },
        {
          title: 'Load Data',
          inputs: ['market_data', 'portfolios'],
          outputs: ['agent_memory'],
          parameters: ['time_range', 'symbols']
        },
        {
          title: 'Calculate Metrics',
          inputs: ['agent_memory'],
          outputs: ['risk_metrics'],
          parameters: ['confidence_level', 'method']
        },
        {
          title: 'Send Response',
          inputs: ['risk_metrics'],
          outputs: ['a2a_messages', 'agent_activity'],
          parameters: ['format', 'recipient']
        }
      ]
    },
    financial: {
      steps: [
        {
          title: 'Monitor Markets',
          inputs: ['market_data', 'news_articles'],
          outputs: ['agent_activity'],
          parameters: ['frequency', 'thresholds']
        },
        {
          title: 'Analyze Portfolio',
          inputs: ['portfolios', 'risk_metrics'],
          outputs: ['agent_memory'],
          parameters: ['risk_tolerance', 'objectives']
        },
        {
          title: 'Generate Signal',
          inputs: ['agent_memory', 'market_data'],
          outputs: ['trading_signals'],
          parameters: ['strategy', 'confidence_threshold']
        },
        {
          title: 'Validate Trade',
          inputs: ['trading_signals', 'compliance_checks'],
          outputs: ['a2a_messages', 'blockchain_events'],
          parameters: ['limits', 'regulations']
        }
      ]
    },
    ml: {
      steps: [
        {
          title: 'Collect Training Data',
          inputs: ['market_data', 'agent_activity'],
          outputs: ['agent_memory'],
          parameters: ['sample_size', 'features']
        },
        {
          title: 'Train Model',
          inputs: ['agent_memory'],
          outputs: ['agent_memory'],
          parameters: ['algorithm', 'hyperparameters']
        },
        {
          title: 'Make Prediction',
          inputs: ['market_data', 'agent_memory'],
          outputs: ['trading_signals'],
          parameters: ['confidence_threshold']
        },
        {
          title: 'Update Model',
          inputs: ['trading_signals', 'market_data'],
          outputs: ['agent_memory', 'agent_activity'],
          parameters: ['learning_rate', 'batch_size']
        }
      ]
    },
    default: {
      steps: [
        {
          title: 'Receive Input',
          inputs: ['a2a_messages'],
          outputs: ['agent_activity'],
          parameters: ['validation_rules']
        },
        {
          title: 'Process Data',
          inputs: ['market_data'],
          outputs: ['agent_memory'],
          parameters: ['processing_rules']
        },
        {
          title: 'Execute Logic',
          inputs: ['agent_memory'],
          outputs: ['agent_memory'],
          parameters: ['business_rules']
        },
        {
          title: 'Return Result',
          inputs: ['agent_memory'],
          outputs: ['a2a_messages'],
          parameters: ['format']
        }
      ]
    }
  };
}

// Update agent data flow panel
function updateAgentDataFlow(agent, process, csnSchema) {
  const dataFlowDiv = document.getElementById('agent-data-flow');
  if (!dataFlowDiv) return;
  
  // Collect all data tables used
  const dataTables = new Set();
  process.steps.forEach(step => {
    if (step.inputs) step.inputs.forEach(table => dataTables.add(table.split('.')[0]));
    if (step.outputs) step.outputs.forEach(table => dataTables.add(table.split('.')[0]));
  });
  
  let html = '<h4 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">📊 Data Resources (ORD)</h4>';
  html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px;">';
  
  dataTables.forEach(tableName => {
    const entityName = `finsight.db.${toPascalCase(tableName)}`;
    const entity = csnSchema?.definitions?.[entityName];
    
    html += `
      <div style="background: #F8F9FA; border: 1px solid #E5E5EA; border-radius: 8px; padding: 12px;">
        <h5 style="font-weight: 600; margin: 0 0 4px; color: #007AFF; font-size: 14px;">
          ${entity?.['@ord.title'] || toTitleCase(tableName)}
        </h5>
        <p style="font-size: 12px; color: #636366; margin: 0;">
          ${entity?.['@ord.description'] || 'Data resource used by this agent'}
        </p>
      </div>
    `;
  });
  
  html += '</div>';
  
  // Add parameters section
  html += '<h4 style="font-size: 16px; font-weight: 600; margin: 24px 0 12px;">⚙️ Configuration Parameters</h4>';
  html += '<div style="background: #F8F9FA; border: 1px solid #E5E5EA; border-radius: 8px; padding: 16px;">';
  
  const allParams = new Set();
  process.steps.forEach(step => {
    if (step.parameters) step.parameters.forEach(param => allParams.add(param));
  });
  
  html += '<div style="display: flex; flex-wrap: wrap; gap: 8px;">';
  allParams.forEach(param => {
    html += `<span style="background: #AF52DE; color: white; padding: 4px 12px; border-radius: 16px; font-size: 13px;">${param}</span>`;
  });
  html += '</div></div>';
  
  dataFlowDiv.innerHTML = html;
}

// Helper function for title case
function toTitleCase(str) {
  return str.split('_').map(word => 
    word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
  ).join(' ');
}
</script>

<style>
.wizard-container {
  padding: 20px;
}

.wizard-step {
  margin-bottom: 20px;
}

.wizard-step h3 {
  margin-bottom: 15px;
  color: var(--jobs-blue);
}

.wizard-step textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-family: inherit;
  font-size: 14px;
  margin-bottom: 15px;
  resize: vertical;
}

.wizard-step textarea:focus {
  outline: none;
  border-color: var(--jobs-blue);
  box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}

#generated-code {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 15px;
  max-height: 400px;
  overflow-y: auto;
}

#generated-code pre {
  margin: 0;
  white-space: pre-wrap;
  font-family: 'Monaco', 'Menlo', monospace;
  font-size: 12px;
}

/* Process Designer Styles */
.process-tab {
  padding: 8px 16px;
  background: transparent;
  border: 1px solid #E5E5EA;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.process-tab:hover {
  background: #F2F2F7;
}

.process-tab.active {
  background: #007AFF;
  color: white;
  border-color: #007AFF;
}

.loading-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid #E5E5EA;
  border-top-color: #007AFF;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Data tags for process designer */
.data-tag {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
  margin-right: 4px;
}

.data-tag.read {
  background: rgba(52, 199, 89, 0.1);
  color: #34C759;
}

.data-tag.write {
  background: rgba(255, 149, 0, 0.1);
  color: #FF9500;
}

.loading {
  text-align: center;
  padding: 40px;
  color: var(--jobs-blue);
}

.error {
  color: var(--jobs-red);
  background: #fff5f5;
  border: 1px solid #fed7d7;
  border-radius: 8px;
  padding: 15px;
}
</style>

<!-- Trust Section Standard - Standard card template with Grok AI integration -->
<script>
// Trust Section Standard - Using app's standard card template with Grok integration
// Natural language code explanations and Q&A functionality

function trustSectionStandard() {
  // Get trust section
  const trustSection = document.getElementById('trust');
  if (!trustSection) return;
  
  // Create standard interface using app's card template
  trustSection.innerHTML = `
    <div class="trust-standard-container">
      <!-- Header -->
      <div class="trust-standard-header">
        <h1 class="trust-standard-title">Secure Automation</h1>
        <p class="trust-standard-subtitle">Smart contract templates with AI-powered explanations</p>
      </div>
      
      <!-- Main Navigation -->
      <div class="trust-standard-tabs">
        <button class="trust-standard-tab active" onclick="switchStandardTab('templates')">
          <span>Template Library</span>
        </button>
        <button class="trust-standard-tab" onclick="switchStandardTab('contracts')">
          <span>My Contracts</span>
        </button>
        <button class="trust-standard-tab" onclick="window.open('/bpmn-professional.html', '_blank')">
          <span>Process Designer</span>
        </button>
      </div>
      
      <!-- Template Library Panel -->
      <div id="templates-standard-panel" class="trust-standard-panel active">
        <div class="jobs-models-grid" id="template-standard-grid">
          <!-- Templates will be loaded here using standard card template -->
        </div>
      </div>
      
      <!-- Contracts Panel -->
      <div id="contracts-standard-panel" class="trust-standard-panel">
        <div class="jobs-models-grid" id="contract-standard-list">
          <!-- Contracts will be loaded here -->
        </div>
      </div>
    </div>
    
    <!-- Code Modal with Grok Integration -->
    <div id="code-standard-modal" class="code-standard-modal">
      <div class="code-standard-content">
        <div class="code-standard-header">
          <h2 class="code-standard-title">
            <span id="code-standard-title-text">Smart Contract Code</span>
          </h2>
          <button class="code-standard-close" onclick="closeCodeStandardModal()">×</button>
        </div>
        
        <div class="code-standard-body">
          <!-- Code and explanation tabs -->
          <div class="code-standard-tabs">
            <button class="code-tab active" onclick="switchCodeTab('code')">Source Code</button>
            <button class="code-tab" onclick="switchCodeTab('explanation')">AI Explanation</button>
            <button class="code-tab" onclick="switchCodeTab('qa')">Ask Questions</button>
          </div>
          
          <!-- Code Panel -->
          <div id="code-panel" class="code-panel active">
            <div class="code-block-container">
              <div class="code-block-header">
                <span class="code-block-title">Main Contract</span>
                <button class="code-copy-button" onclick="copyCodeToClipboard('main-contract-code')">
                  Copy
                </button>
              </div>
              <pre id="main-contract-code" class="code-block"></pre>
            </div>
          </div>
          
          <!-- AI Explanation Panel -->
          <div id="explanation-panel" class="code-panel">
            <div class="ai-explanation-container">
              <div class="ai-explanation-header">
                <div class="ai-avatar">🤖</div>
                <div class="ai-info">
                  <h3>Grok AI Explanation</h3>
                  <p>Natural language breakdown of the smart contract</p>
                </div>
              </div>
              <div id="ai-explanation-content" class="ai-explanation-content">
                <div class="ai-loading">Analyzing contract with Grok AI...</div>
              </div>
            </div>
          </div>
          
          <!-- Q&A Panel -->
          <div id="qa-panel" class="code-panel">
            <div class="qa-container">
              <div class="qa-header">
                <h3>Ask Questions About This Contract</h3>
                <p>Get detailed explanations powered by Grok AI</p>
              </div>
              
              <div class="qa-chat" id="qa-chat">
                <div class="qa-message assistant">
                  <div class="qa-avatar">🤖</div>
                  <div class="qa-bubble">
                    I'll help you build this process using your existing agents. Tell me about your team structure and workflow needs.
                  </div>
                </div>
              </div>
              
              <div class="qa-input-container">
                <input type="text" id="qa-input" placeholder="Ask about this contract..." onkeydown="handleQAEnter(event)" />
                <button onclick="sendQAMessage()">Send</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
  
  // Add styles for the standard interface
  const standardStyles = document.createElement('style');
  standardStyles.textContent = `
    /* Trust Section Standard Styles */
    .trust-standard-container {
      padding: 24px;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* Header */
    .trust-standard-header {
      margin-bottom: 32px;
    }
    
    .trust-standard-title {
      font-size: 34px;
      font-weight: 600;
      margin: 0 0 8px;
    }
    
    .trust-standard-subtitle {
      font-size: 17px;
      color: #8E8E93;
      margin: 0;
    }
    
    /* Main Navigation */
    .trust-standard-tabs {
      display: flex;
      gap: 2px;
      background: rgba(0, 0, 0, 0.04);
      padding: 2px;
      border-radius: 10px;
      margin-bottom: 32px;
    }
    
    body.dark-mode .trust-standard-tabs {
      background: rgba(255, 255, 255, 0.04);
    }
    
    .trust-standard-tab {
      flex: 1;
      padding: 12px 24px;
      background: transparent;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      color: #636366;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .trust-standard-tab:hover {
      color: #007AFF;
    }
    
    .trust-standard-tab.active {
      background: white;
      color: #007AFF;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    body.dark-mode .trust-standard-tab.active {
      background: #2C2C2E;
    }
    
    /* Tab Panels */
    .trust-standard-panel {
      display: none;
    }
    
    .trust-standard-panel.active {
      display: block;
    }
    
    /* Template Cards using standard app style */
    .trust-template-standard-card {
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 16px;
      padding: 24px;
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .trust-template-standard-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #34C759, #007AFF);
    }
    
    body.dark-mode .trust-template-standard-card {
      background: #1C1C1E;
      border-color: #38383A;
    }
    
    .trust-template-standard-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }
    
    .trust-template-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 24px;
    }
    
    .trust-template-info h3 {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 4px;
    }
    
    .trust-template-info p {
      font-size: 15px;
      color: #636366;
      margin: 0;
      line-height: 1.5;
      padding-bottom: 8px;
    }
    
    .trust-template-status {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
    }
    
    .trust-template-status.verified {
      background: rgba(52, 199, 89, 0.1);
      color: #34C759;
    }
    
    .trust-template-status.loading {
      background: rgba(255, 149, 0, 0.1);
      color: #FF9500;
    }
    
    .trust-template-actions {
      display: flex;
      gap: 12px;
    }
    
    .trust-template-action {
      flex: 1;
      padding: 10px 16px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      background: white;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .trust-template-action.primary {
      background: #007AFF;
      color: white;
      border-color: #007AFF;
    }
    
    .trust-template-action:hover {
      transform: translateY(-1px);
    }
    
    body.dark-mode .trust-template-action {
      background: #2C2C2E;
      border-color: #38383A;
      color: white;
    }
    
    /* Code Modal Styles */
    .code-standard-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(20px);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }
    
    .code-standard-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .code-standard-content {
      background: white;
      border-radius: 16px;
      max-width: 1000px;
      width: 100%;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    body.dark-mode .code-standard-content {
      background: #1C1C1E;
    }
    
    .code-standard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    body.dark-mode .code-standard-header {
      border-bottom-color: #38383A;
    }
    
    .code-standard-title {
      font-size: 20px;
      font-weight: 600;
      margin: 0;
    }
    
    .code-standard-close {
      width: 32px;
      height: 32px;
      border: none;
      background: rgba(0, 0, 0, 0.06);
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    body.dark-mode .code-standard-close {
      background: rgba(255, 255, 255, 0.06);
      color: white;
    }
    
    .code-standard-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .code-standard-tabs {
      display: flex;
      background: rgba(0, 0, 0, 0.04);
      margin: 0 24px;
      border-radius: 8px;
      padding: 4px;
    }
    
    body.dark-mode .code-standard-tabs {
      background: rgba(255, 255, 255, 0.04);
    }
    
    .code-tab {
      flex: 1;
      padding: 12px;
      background: transparent;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      color: #636366;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .code-tab.active {
      background: white;
      color: #007AFF;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    body.dark-mode .code-tab.active {
      background: #2C2C2E;
    }
    
    .code-panel {
      display: none;
      flex: 1;
      overflow: auto;
      padding: 24px;
    }
    
    .code-panel.active {
      display: block;
    }
    
    .code-block-container {
      background: #F8F9FA;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 12px;
      overflow: hidden;
    }
    
    body.dark-mode .code-block-container {
      background: #2C2C2E;
      border-color: #38383A;
    }
    
    .code-block-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: rgba(0, 0, 0, 0.02);
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    }
    
    body.dark-mode .code-block-header {
      background: rgba(255, 255, 255, 0.02);
      border-bottom-color: #38383A;
    }
    
    .code-block-title {
      font-size: 14px;
      font-weight: 500;
      color: #636366;
    }
    
    .code-copy-button {
      padding: 6px 12px;
      background: #007AFF;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
    }
    
    .code-block {
      padding: 16px;
      margin: 0;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
      line-height: 1.5;
      background: transparent;
      color: #333;
      overflow-x: auto;
      white-space: pre;
    }
    
    body.dark-mode .code-block {
      color: #E5E5E7;
    }
    
    /* AI Explanation Styles */
    .ai-explanation-container {
      max-width: none;
    }
    
    .ai-explanation-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    body.dark-mode .ai-explanation-header {
      border-bottom-color: #38383A;
    }
    
    .ai-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #007AFF, #34C759);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    
    .ai-info h3 {
      margin: 0 0 4px;
      font-size: 16px;
      font-weight: 600;
    }
    
    .ai-info p {
      margin: 0;
      font-size: 14px;
      color: #8E8E93;
    }
    
    .ai-explanation-content {
      line-height: 1.4;
    }
    
    .ai-explanation-content p {
      margin: 0 0 12px 0;
    }
    
    .ai-explanation-content p:last-child {
      margin-bottom: 0;
    }
    
    .ai-explanation-content h3 {
      color: #007AFF;
      margin-top: 24px;
      margin-bottom: 12px;
    }
    
    .ai-explanation-content h4 {
      color: #34C759;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    
    .ai-explanation-content ul {
      padding-left: 20px;
    }
    
    .ai-explanation-content li {
      margin-bottom: 6px;
    }
    
    .ai-loading {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 20px;
      color: #8E8E93;
      font-style: italic;
    }
    
    .ai-loading::before {
      content: '';
      width: 16px;
      height: 16px;
      border: 2px solid #E5E5EA;
      border-top-color: #007AFF;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Q&A Chat Styles */
    .qa-container {
      display: flex;
      flex-direction: column;
      height: 500px;
    }
    
    .qa-header {
      margin-bottom: 20px;
    }
    
    .qa-header h3 {
      margin: 0 0 8px;
      font-size: 18px;
      font-weight: 600;
    }
    
    .qa-header p {
      margin: 0;
      color: #8E8E93;
      font-size: 14px;
    }
    
    .qa-chat {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      background: rgba(0, 0, 0, 0.02);
      border-radius: 12px;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    body.dark-mode .qa-chat {
      background: rgba(255, 255, 255, 0.02);
    }
    
    .qa-message {
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }
    
    .qa-message.user {
      flex-direction: row-reverse;
    }
    
    .qa-message .qa-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }
    
    .qa-message.assistant .qa-avatar {
      background: linear-gradient(135deg, #007AFF, #34C759);
    }
    
    .qa-message.user .qa-avatar {
      background: linear-gradient(135deg, #FF9500, #FF3B30);
    }
    
    .qa-bubble {
      background: white;
      padding: 12px 16px;
      border-radius: 16px;
      max-width: 70%;
      line-height: 1.4;
      font-size: 14px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .qa-message.user .qa-bubble {
      background: #007AFF;
      color: white;
    }
    
    body.dark-mode .qa-bubble {
      background: #2C2C2E;
    }
    
    body.dark-mode .qa-message.user .qa-bubble {
      background: #007AFF;
    }
    
    .qa-input-container {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .qa-input-container input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 24px;
      font-size: 14px;
      outline: none;
    }
    
    .qa-input-container input:focus {
      border-color: #007AFF;
    }
    
    body.dark-mode .qa-input-container input {
      background: #2C2C2E;
      border-color: #38383A;
      color: white;
    }
    
    .qa-input-container button {
      padding: 12px 20px;
      background: #007AFF;
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    }
  `;
  
  if (!document.getElementById('trust-standard-styles')) {
    standardStyles.id = 'trust-standard-styles';
    document.head.appendChild(standardStyles);
  }
  
  // Load templates
  loadStandardTemplates();
}

// Switch between main tabs
function switchStandardTab(tab) {
  // Update tab buttons
  document.querySelectorAll('.trust-standard-tab').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  // Update panels
  document.querySelectorAll('.trust-standard-panel').forEach(panel => panel.classList.remove('active'));
  document.getElementById(tab + '-standard-panel').classList.add('active');
  
  // Load content based on tab
  if (tab === 'contracts') {
    loadStandardContracts();
  }
}

// Load smart contract templates
async function loadStandardTemplates() {
  const grid = document.getElementById('template-standard-grid');
  grid.innerHTML = '<div style="text-align: center; padding: 40px;">Loading smart contract templates...</div>';
  
  try {
    const response = await fetch('/api/unified?action=smart_contract_templates');
    const data = await response.json();
    const templates = data.templates || [];
    
    if (templates.length > 0) {
      grid.innerHTML = '';
      
      for (const template of templates) {
        const card = document.createElement('div');
        card.className = 'trust-template-standard-card';
        card.innerHTML = `
          <div class="trust-template-header">
            <div class="trust-template-info">
              <h3>${template.name}</h3>
              <p>${template.description}</p>
            </div>
            <div class="trust-template-status ${template.verified ? 'verified' : 'loading'}">
              ${template.verified ? '✓ Verified' : 'Loading...'}
            </div>
          </div>
          
          
          <div class="trust-template-actions">
            <button class="trust-template-action" onclick="viewStandardCode('${template.id}')">
              View Code
            </button>
            <button class="trust-template-action primary" onclick="customizeStandardTemplate('${template.id}')">
              Customize
            </button>
          </div>
        `;
        
        grid.appendChild(card);
      }
    } else {
      grid.innerHTML = '<div style="text-align: center; padding: 40px;">No templates available</div>';
    }
    
  } catch (error) {
    console.error('Error loading templates:', error);
    grid.innerHTML = '<div style="text-align: center; padding: 40px;">Error loading templates</div>';
  }
}


// View code with Grok integration
async function viewStandardCode(templateId) {
  const modal = document.getElementById('code-standard-modal');
  const title = document.getElementById('code-standard-title-text');
  const codeBlock = document.getElementById('main-contract-code');
  const explanationContent = document.getElementById('ai-explanation-content');
  
  // Show modal
  modal.classList.add('active');
  title.textContent = 'Loading contract code...';
  codeBlock.textContent = 'Loading contract source code...';
  
  try {
    // Fetch contract code
    const response = await fetch(`/api/unified?action=contract_code&template_id=${templateId}`);
    const data = await response.json();
    
    title.textContent = `${data.name} - Smart Contract`;
    codeBlock.textContent = data.sourceCode || 'Source code not available';
    
    // Load Grok explanation
    loadGrokExplanation(templateId, data.sourceCode, explanationContent);
    
  } catch (error) {
    console.error('Error loading contract code:', error);
    codeBlock.textContent = 'Error loading contract code';
  }
}

// Load Grok AI explanation
async function loadGrokExplanation(templateId, sourceCode, container) {
  container.innerHTML = '<div class="ai-loading">Analyzing contract with Grok AI...</div>';
  
  try {
    const response = await fetch('/api/unified?action=grok_explanation', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        sourceCode: sourceCode,
        contractName: templateId.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())
      })
    });
    
    const data = await response.json();
    
    if (data.explanation) {
      // Clean up and convert to simple HTML with minimal formatting
      let cleanExplanation = data.explanation
        .replace(/🤖/g, '')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/• /g, '• ')
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>')
        .trim();
      
      cleanExplanation = '<p>' + cleanExplanation + '</p>';
      
      container.innerHTML = `
        <div class="ai-explanation-content">
          ${cleanExplanation}
        </div>
      `;
    } else {
      container.innerHTML = '<p>Unable to generate explanation. Please try again.</p>';
    }
    
  } catch (error) {
    console.error('Error loading Grok explanation:', error);
    container.innerHTML = `
      <div class="ai-explanation-section">
        <h4>Contract Analysis</h4>
        <p>This is a ${templateId.replace('-', ' ')} smart contract template. It provides secure, audited functionality for blockchain automation.</p>
        
        <h4>Key Features</h4>
        <ul>
          <li>Industry-standard security patterns</li>
          <li>Gas-optimized implementations</li>
          <li>Comprehensive event logging</li>
          <li>Modular architecture design</li>
        </ul>
        
        <h4>Security Considerations</h4>
        <ul>
          <li>Access control mechanisms</li>
          <li>Input validation</li>
          <li>Reentrancy protection</li>
          <li>Integer overflow/underflow prevention</li>
        </ul>
      </div>
    `;
  }
}

// Handle Q&A with Grok
async function sendQAMessage() {
  const input = document.getElementById('qa-input');
  const chat = document.getElementById('qa-chat');
  const message = input.value.trim();
  
  if (!message) return;
  
  // Add user message
  chat.innerHTML += `
    <div class="qa-message user">
      <div class="qa-avatar">👤</div>
      <div class="qa-bubble">${message}</div>
    </div>
  `;
  
  input.value = '';
  chat.scrollTop = chat.scrollHeight;
  
  // Add loading message
  chat.innerHTML += `
    <div class="qa-message assistant" id="loading-message">
      <div class="qa-avatar">🤖</div>
      <div class="qa-bubble">
        <div class="ai-loading">Thinking...</div>
      </div>
    </div>
  `;
  
  try {
    const response = await fetch('/api/unified?action=grok_qa', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        question: message,
        sourceCode: getCurrentSourceCode(),
        contractName: getCurrentTemplateId().replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase()),
        conversationHistory: []
      })
    });
    
    const data = await response.json();
    
    // Remove loading message
    document.getElementById('loading-message').remove();
    
    // Clean up the AI response - remove excessive markdown and make it natural
    let cleanAnswer = data.answer || 'I apologize, but I couldn\'t process your question. Please try rephrasing it.';
    
    // Remove excessive emojis and technical formatting
    cleanAnswer = cleanAnswer
      .replace(/🤖 \*\*Grok AI Response\*\*/g, '')
      .replace(/\*\*(.*?)\*\*/g, '$1') // Remove bold markdown
      .replace(/• /g, '• ') // Keep bullet points clean
      .replace(/\n\n\*\*Quick Facts:\*\*/g, '\n\nKey info:')
      .replace(/\n\n\*\*Need More Details\?\*\*/g, '\n\nNeed help with something specific?')
      .replace(/🚀/g, '')
      .replace(/⛽/g, '')
      .replace(/🛡️/g, '')
      .replace(/🔍/g, '')
      .replace(/✅/g, '✓')
      .trim();
    
    // Add AI response
    chat.innerHTML += `
      <div class="qa-message assistant">
        <div class="qa-avatar">🤖</div>
        <div class="qa-bubble">${cleanAnswer}</div>
      </div>
    `;
    
  } catch (error) {
    console.error('Error getting AI response:', error);
    
    // Remove loading message
    document.getElementById('loading-message').remove();
    
    // Add fallback response
    chat.innerHTML += `
      <div class="qa-message assistant">
        <div class="qa-avatar">🤖</div>
        <div class="qa-bubble">I'm having trouble connecting to the AI service right now. Please try again in a moment.</div>
      </div>
    `;
  }
  
  chat.scrollTop = chat.scrollHeight;
}

// Handle Q&A enter key
function handleQAEnter(event) {
  if (event.key === 'Enter') {
    sendQAMessage();
  }
}

// Get current template ID (from modal context)
function getCurrentTemplateId() {
  const title = document.getElementById('code-standard-title-text');
  return title.textContent.split(' - ')[0].toLowerCase().replace(/\s+/g, '-');
}

// Get current source code (from modal context)
function getCurrentSourceCode() {
  const codeBlock = document.getElementById('main-contract-code');
  return codeBlock ? codeBlock.textContent : '';
}

// Switch between code tabs
function switchCodeTab(tab) {
  // Update tab buttons
  document.querySelectorAll('.code-tab').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  // Update panels
  document.querySelectorAll('.code-panel').forEach(panel => panel.classList.remove('active'));
  document.getElementById(tab + '-panel').classList.add('active');
}

// Close code modal
function closeCodeStandardModal() {
  document.getElementById('code-standard-modal').classList.remove('active');
}

// Copy code to clipboard
function copyCodeToClipboard(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    navigator.clipboard.writeText(element.textContent).then(() => {
      // Visual feedback
      const button = event.target;
      const originalText = button.textContent;
      button.textContent = 'Copied!';
      setTimeout(() => {
        button.textContent = originalText;
      }, 2000);
    });
  }
}

// Customize template
function customizeStandardTemplate(templateId) {
  // For now, show a simple alert
  alert(`Customization interface for ${templateId} will open here. This will allow you to:\n\n• Configure contract parameters\n• Select AI agents for automation\n• Set deployment options\n• Preview generated contract`);
}

// Load contracts
async function loadStandardContracts() {
  const list = document.getElementById('contract-standard-list');
  list.innerHTML = '<div style="text-align: center; padding: 40px;">Loading deployed contracts...</div>';
  
  try {
    const response = await fetch('/api/unified?action=deployed_contracts');
    const data = await response.json();
    const contracts = data.contracts || [];
    
    if (contracts.length > 0) {
      list.innerHTML = contracts.map(contract => `
        <div class="trust-template-standard-card">
          <div class="trust-template-header">
            <div class="trust-template-info">
              <h3>${contract.contract_name}</h3>
              <p>${contract.description || 'No description'}</p>
            </div>
            <div class="trust-template-status ${contract.status === 'deployed' ? 'verified' : 'loading'}">
              ${contract.status === 'deployed' ? '✓ Deployed' : contract.status}
            </div>
          </div>
          
          <div class="trust-template-metrics">
            <div class="trust-template-metric">
              <span class="trust-template-metric-value">${contract.contract_address ? contract.contract_address.slice(0, 8) + '...' : 'Pending'}</span>
              <span class="trust-template-metric-label">Address</span>
            </div>
            <div class="trust-template-metric">
              <span class="trust-template-metric-value">${contract.network || 'Ethereum'}</span>
              <span class="trust-template-metric-label">Network</span>
            </div>
            <div class="trust-template-metric">
              <span class="trust-template-metric-value">${contract.selected_agents?.length || 0}</span>
              <span class="trust-template-metric-label">Agents</span>
            </div>
          </div>
          
          <div class="trust-template-actions">
            <button class="trust-template-action" onclick="viewContractDetails('${contract.id}')">
              View Details
            </button>
            <button class="trust-template-action primary" onclick="manageContract('${contract.id}')">
              Manage
            </button>
          </div>
        </div>
      `).join('');
    } else {
      list.innerHTML = '<div style="text-align: center; padding: 40px;">No deployed contracts yet</div>';
    }
    
  } catch (error) {
    console.error('Error loading contracts:', error);
    list.innerHTML = '<div style="text-align: center; padding: 40px;">Error loading contracts</div>';
  }
}

// View contract details
function viewContractDetails(contractId) {
  alert(`Contract details for ${contractId} will be displayed here.`);
}

// Manage contract
function manageContract(contractId) {
  alert(`Contract management interface for ${contractId} will open here.`);
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  trustSectionStandard();
  
  // Update tab name
  const trustTab = document.querySelector('.jobs-section-tab[onclick*="trust"]');
  if (trustTab) {
    trustTab.innerHTML = 'Secure Automation';
  }
  
  // Close modals on outside click
  document.addEventListener('click', (e) => {
    if (e.target.classList.contains('code-standard-modal')) {
      e.target.classList.remove('active');
    }
  });
});
</script>

</body>
</html>