/* 
 * Performance & Accessibility Optimizations
 * Modern CSS features for enhanced performance and inclusive design
 */

/* ========================================
   Performance Optimizations
   ======================================== */

/* CSS Containment for layout isolation */
.perf-layout-contain {
  contain: layout;
}

.perf-style-contain {
  contain: style;
}

.perf-paint-contain {
  contain: paint;
}

.perf-strict-contain {
  contain: strict;
}

/* GPU Acceleration */
.perf-gpu-accelerated {
  transform: translate3d(0, 0, 0);
  -webkit-transform: translate3d(0, 0, 0);
  backface-visibility: hidden;
  perspective: 1000;
}

/* will-change management */
.perf-will-change-transform {
  will-change: transform;
}

.perf-will-change-opacity {
  will-change: opacity;
}

.perf-will-change-scroll {
  will-change: scroll-position;
}

.perf-will-change-auto {
  will-change: auto;
}

/* Remove will-change after animation */
.perf-animation-complete {
  will-change: auto !important;
}

/* Layer promotion for expensive operations */
.perf-promote-layer {
  transform: translateZ(0);
  isolation: isolate;
}

/* Optimize repaints with CSS containment */
.perf-chart-container {
  contain: layout style paint;
  transform: translate3d(0, 0, 0);
}

.perf-table-container {
  contain: layout style;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}

.perf-table-row {
  contain: layout style;
}

/* Virtual scrolling optimizations */
.perf-virtual-item {
  contain: strict;
  content-visibility: auto;
  contain-intrinsic-size: 50px;
}

/* Intersection Observer targets */
.perf-lazy-load {
  content-visibility: auto;
  contain-intrinsic-size: 200px;
}

/* Critical CSS indicators */
.perf-above-fold {
  content-visibility: visible;
}

.perf-below-fold {
  content-visibility: auto;
}

/* ========================================
   Memory Management
   ======================================== */

/* Limit expensive filters to specific contexts */
.perf-blur-light {
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

.perf-blur-medium {
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
}

.perf-blur-heavy {
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
}

/* Remove blur effects on low-end devices */
@media (max-resolution: 150dpi) {
  .perf-blur-light,
  .perf-blur-medium,
  .perf-blur-heavy {
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    background: var(--color-background-glass) !important;
  }
}

/* ========================================
   Smooth Scrolling & Interaction
   ======================================== */

.perf-smooth-scroll {
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

.perf-momentum-scroll {
  -webkit-overflow-scrolling: touch;
  overflow-scrolling: touch;
}

/* Scroll snap for better UX */
.perf-scroll-snap-x {
  scroll-snap-type: x mandatory;
  -webkit-scroll-snap-type: x mandatory;
}

.perf-scroll-snap-y {
  scroll-snap-type: y mandatory;
  -webkit-scroll-snap-type: y mandatory;
}

.perf-scroll-snap-item {
  scroll-snap-align: start;
  -webkit-scroll-snap-align: start;
}

/* ========================================
   Accessibility Foundations
   ======================================== */

/* Focus management */
.a11y-focus-visible:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

.a11y-focus-visible:focus:not(:focus-visible) {
  outline: none;
}

/* High contrast focus for critical elements */
.a11y-focus-high-contrast:focus-visible {
  outline: 3px solid var(--color-primary);
  outline-offset: 3px;
  box-shadow: 0 0 0 5px rgba(0, 122, 255, 0.2);
}

/* Skip links for keyboard navigation */
.a11y-skip-link {
  position: absolute;
  top: -9999px;
  left: -9999px;
  z-index: 999999;
  padding: var(--space-3) var(--space-4);
  background: var(--color-primary);
  color: white;
  text-decoration: none;
  border-radius: var(--radius-md);
  font-weight: var(--font-weight-medium);
}

.a11y-skip-link:focus {
  top: var(--space-4);
  left: var(--space-4);
}

/* Screen reader only content */
.a11y-sr-only {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

/* Make content visible to screen readers when focused */
.a11y-sr-only-focusable:focus,
.a11y-sr-only-focusable:active {
  position: static !important;
  width: auto !important;
  height: auto !important;
  margin: 0 !important;
  overflow: visible !important;
  clip: auto !important;
  white-space: normal !important;
}

/* ========================================
   Keyboard Navigation
   ======================================== */

/* Tab order management */
.a11y-tab-order-1 { order: 1; }
.a11y-tab-order-2 { order: 2; }
.a11y-tab-order-3 { order: 3; }
.a11y-tab-order-4 { order: 4; }
.a11y-tab-order-5 { order: 5; }

/* Focus trap for modals */
.a11y-focus-trap {
  isolation: isolate;
}

.a11y-focus-trap:focus-within {
  /* Additional styling when focus is within */
}

/* Keyboard-only interactions */
.a11y-keyboard-only:focus {
  background: var(--color-background-secondary);
  outline: 2px solid var(--color-primary);
}

/* ========================================
   Motion & Animation Preferences
   ======================================== */

/* Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  .a11y-respect-motion,
  .a11y-respect-motion * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  .perf-smooth-scroll {
    scroll-behavior: auto;
  }
  
  /* Remove parallax and transform animations */
  .a11y-respect-motion {
    transform: none !important;
  }
}

/* Safe animations that can remain even with reduced motion */
.a11y-safe-animation {
  /* Only opacity and color changes */
  transition: opacity var(--duration-150) ease, 
              color var(--duration-150) ease,
              background-color var(--duration-150) ease;
}

@media (prefers-reduced-motion: reduce) {
  .a11y-safe-animation {
    transition-duration: 0.01ms;
  }
}

/* ========================================
   Color & Contrast
   ======================================== */

/* High contrast mode support */
@media (prefers-contrast: high) {
  .a11y-high-contrast {
    border: 2px solid currentColor !important;
    background: var(--color-background) !important;
    color: var(--color-text-primary) !important;
  }
  
  .a11y-high-contrast-button {
    background: var(--color-primary) !important;
    color: white !important;
    border: 2px solid var(--color-primary) !important;
  }
  
  .a11y-high-contrast-button:hover {
    background: var(--color-primary-hover) !important;
  }
  
  /* Remove subtle effects in high contrast */
  .a11y-high-contrast-remove-effects {
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    opacity: 1 !important;
  }
}

/* Color vision deficiency support */
.a11y-colorblind-safe {
  /* Use patterns/shapes in addition to color */
  position: relative;
}

.a11y-colorblind-safe.success::before {
  content: '✓';
  margin-right: var(--space-1);
}

.a11y-colorblind-safe.error::before {
  content: '✗';
  margin-right: var(--space-1);
}

.a11y-colorblind-safe.warning::before {
  content: '⚠';
  margin-right: var(--space-1);
}

/* ========================================
   Touch & Mobile Accessibility
   ======================================== */

/* Minimum touch target sizes (44px recommended) */
.a11y-touch-target {
  min-height: 44px;
  min-width: 44px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.a11y-touch-target-large {
  min-height: 48px;
  min-width: 48px;
}

/* Safe touch areas */
.a11y-touch-safe {
  margin: var(--space-2);
  padding: var(--space-3);
}

/* Prevent zoom on input focus (iOS) */
.a11y-input-no-zoom {
  font-size: 16px; /* Prevents zoom on iOS */
}

/* ========================================
   Loading States & Progressive Enhancement
   ======================================== */

/* Loading skeletons */
.perf-skeleton {
  background: linear-gradient(
    90deg,
    var(--color-background-secondary) 0%,
    var(--color-background-tertiary) 50%,
    var(--color-background-secondary) 100%
  );
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
  border-radius: var(--radius-sm);
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

@media (prefers-reduced-motion: reduce) {
  .perf-skeleton {
    animation: none;
    background: var(--color-background-secondary);
  }
}

/* Progressive enhancement */
.perf-enhanced {
  /* Base styles for non-JS environment */
}

.js .perf-enhanced {
  /* Enhanced styles when JavaScript is available */
}

.no-js .perf-enhanced {
  /* Fallback styles when JavaScript is not available */
}

/* ========================================
   Error States & Resilience
   ======================================== */

.perf-error-boundary {
  background: var(--color-background);
  border: 1px solid var(--color-error);
  border-radius: var(--radius-md);
  padding: var(--space-4);
  color: var(--color-error);
}

.perf-fallback-image {
  background: var(--color-background-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-text-secondary);
  min-height: 100px;
}

/* ========================================
   Print Optimizations
   ======================================== */

@media print {
  .perf-no-print {
    display: none !important;
  }
  
  .perf-print-only {
    display: block !important;
  }
  
  .perf-print-break-before {
    break-before: page;
  }
  
  .perf-print-break-after {
    break-after: page;
  }
  
  .perf-print-break-inside-avoid {
    break-inside: avoid;
  }
  
  /* Remove animations and effects for print */
  .perf-print-static * {
    animation: none !important;
    transition: none !important;
    transform: none !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
}

/* ========================================
   Feature Detection & Fallbacks
   ======================================== */

/* Container queries fallback */
@supports not (container-type: inline-size) {
  .perf-container-fallback {
    /* Fallback for browsers without container query support */
  }
}

/* Backdrop filter fallback */
@supports not (backdrop-filter: blur(10px)) {
  .perf-backdrop-fallback {
    background: var(--color-background-glass) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
}

/* CSS Grid fallback */
@supports not (display: grid) {
  .perf-grid-fallback {
    display: flex;
    flex-wrap: wrap;
  }
  
  .perf-grid-fallback > * {
    flex: 1 1 300px;
    margin: var(--space-2);
  }
}

/* ========================================
   Low-End Device Optimizations
   ======================================== */

/* Reduce effects on low-end devices */
@media (max-resolution: 150dpi) and (max-width: 768px) {
  .perf-low-end-optimize {
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    background: var(--color-background) !important;
    border: 1px solid var(--color-border) !important;
  }
  
  .perf-low-end-optimize * {
    animation: none !important;
    transition: none !important;
  }
}

/* ========================================
   Utility Classes
   ======================================== */

/* Content visibility utilities */
.perf-content-visible { content-visibility: visible; }
.perf-content-hidden { content-visibility: hidden; }
.perf-content-auto { content-visibility: auto; }

/* Intersection observer utilities */
.perf-observe {
  content-visibility: auto;
  contain-intrinsic-size: 100px;
}

/* Force hardware acceleration */
.perf-force-gpu {
  transform: translate3d(0, 0, 0);
  backface-visibility: hidden;
  perspective: 1000;
}

/* Disable pointer events for performance */
.perf-no-pointer {
  pointer-events: none;
}

.perf-auto-pointer {
  pointer-events: auto;
}

/* Optimize text rendering */
.perf-text-optimize {
  text-rendering: optimizeSpeed;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.perf-text-quality {
  text-rendering: optimizeLegibility;
}

/* ========================================
   Debug Utilities (Development Only)
   ======================================== */

.perf-debug-outline * {
  outline: 1px solid red !important;
}

.perf-debug-layout {
  background: rgba(255, 0, 0, 0.1) !important;
  border: 1px solid red !important;
}

.perf-debug-paint {
  background: rgba(0, 255, 0, 0.1) !important;
  border: 1px solid green !important;
}

.perf-debug-composite {
  background: rgba(0, 0, 255, 0.1) !important;
  border: 1px solid blue !important;
}

/* Remove debug styles in production */
.production .perf-debug-outline *,
.production .perf-debug-layout,
.production .perf-debug-paint,
.production .perf-debug-composite {
  outline: none !important;
  background: inherit !important;
  border: inherit !important;
}