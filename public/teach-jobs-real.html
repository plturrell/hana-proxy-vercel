<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teaching Management - FinSight Intelligence</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/@blueprintjs/core@4.20.2/lib/css/blueprint.css" rel="stylesheet">
  <link href="teach-jobs-excellence.css" rel="stylesheet">
  <link href="teach-jobs-harmony.css" rel="stylesheet">
  <script src="curriculum-learning-client.js"></script>
  <script src="teach-jobs-excellence.js" defer></script>
  <style>
    /* Jobs/Ive Minimalist Design System */
    :root {
      --jobs-black: #000000;
      --jobs-white: #FFFFFF;
      --jobs-gray: #8E8E93;
      --jobs-light-gray: #F2F2F7;
      --jobs-blue: #007AFF;
      --jobs-green: #34C759;
      --jobs-red: #FF3B30;
      --jobs-orange: #FF9500;
      --jobs-purple: #AF52DE;
      --jobs-font: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Helvetica Neue", sans-serif;
    }
    
    body {
      margin: 0;
      font-family: var(--jobs-font);
      color: var(--jobs-black);
      background: var(--jobs-white);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .metric-card {
      background: var(--jobs-light-gray);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    
    .metric-value {
      font-size: 32px;
      font-weight: 600;
      color: var(--jobs-blue);
    }
    
    .metric-label {
      font-size: 14px;
      color: var(--jobs-gray);
      margin-top: 5px;
    }
    
    .section {
      margin-bottom: 40px;
    }
    
    .section-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 20px;
    }
    
    .agent-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .agent-card {
      background: white;
      border: 1px solid var(--jobs-light-gray);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
    }
    
    .agent-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .agent-name {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .agent-type {
      display: inline-block;
      padding: 4px 12px;
      background: var(--jobs-light-gray);
      border-radius: 20px;
      font-size: 12px;
      color: var(--jobs-gray);
      margin-bottom: 12px;
    }
    
    .agent-score {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }
    
    .score-bar {
      flex: 1;
      height: 8px;
      background: var(--jobs-light-gray);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .score-fill {
      height: 100%;
      background: var(--jobs-green);
      transition: width 0.3s ease;
    }
    
    .score-value {
      font-size: 14px;
      font-weight: 500;
    }
    
    .actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn-primary {
      background: var(--jobs-blue);
      color: white;
    }
    
    .btn-primary:hover {
      background: #0056CC;
    }
    
    .btn-secondary {
      background: var(--jobs-light-gray);
      color: var(--jobs-black);
    }
    
    .btn-secondary:hover {
      background: #E5E5EA;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 40px;
      color: var(--jobs-gray);
    }
    
    .error {
      display: none;
      background: #FEE;
      border: 1px solid #FCC;
      border-radius: 8px;
      padding: 15px;
      color: var(--jobs-red);
      margin-bottom: 20px;
    }
    
    .success {
      display: none;
      background: #EFE;
      border: 1px solid #CFC;
      border-radius: 8px;
      padding: 15px;
      color: var(--jobs-green);
      margin-bottom: 20px;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--jobs-light-gray);
      border-radius: 8px;
      font-size: 14px;
      font-family: var(--jobs-font);
    }
    
    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .tabs {
      display: flex;
      gap: 20px;
      border-bottom: 1px solid var(--jobs-light-gray);
      margin-bottom: 30px;
    }
    
    .tab {
      padding: 10px 0;
      font-size: 16px;
      font-weight: 500;
      color: var(--jobs-gray);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
    }
    
    .tab.active {
      color: var(--jobs-blue);
      border-bottom-color: var(--jobs-blue);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Curriculum Learning System</h1>
      <button class="btn btn-primary" onclick="refreshData()">Refresh</button>
    </div>
    
    <div id="error-message" class="error"></div>
    <div id="success-message" class="success"></div>
    
    <!-- Metrics Dashboard -->
    <div class="metrics-grid" id="metrics-container">
      <div class="metric-card">
        <div class="metric-value" id="total-agents">-</div>
        <div class="metric-label">Active Agents</div>
      </div>
      <div class="metric-card">
        <div class="metric-value" id="avg-compliance">-</div>
        <div class="metric-label">Avg Compliance</div>
      </div>
      <div class="metric-card">
        <div class="metric-value" id="total-curricula">-</div>
        <div class="metric-label">Active Curricula</div>
      </div>
      <div class="metric-card">
        <div class="metric-value" id="total-validations">-</div>
        <div class="metric-label">Validations Today</div>
      </div>
    </div>
    
    <!-- Navigation Tabs -->
    <div class="tabs">
      <div class="tab active" onclick="switchTab('agents')">Agent Management</div>
      <div class="tab" onclick="switchTab('curricula')">Curricula</div>
      <div class="tab" onclick="switchTab('domains')">Knowledge Domains</div>
      <div class="tab" onclick="switchTab('validations')">Validation History</div>
    </div>
    
    <!-- Tab Content -->
    <div id="agents-tab" class="tab-content active">
      <div class="section">
        <div class="section-title">Agent Performance & Training</div>
        <div class="agent-grid" id="agents-container">
          <div class="loading">Loading agents...</div>
        </div>
      </div>
    </div>
    
    <div id="curricula-tab" class="tab-content">
      <div class="section">
        <div class="section-title">
          Active Curricula
          <button class="btn btn-primary" style="float: right;" onclick="showCreateCurriculumModal()">Create Curriculum</button>
        </div>
        <div class="agent-grid" id="curricula-container">
          <div class="loading">Loading curricula...</div>
        </div>
      </div>
    </div>
    
    <div id="domains-tab" class="tab-content">
      <div class="section">
        <div class="section-title">Knowledge Domains</div>
        <div id="domains-container">
          <div class="loading">Loading domains...</div>
        </div>
      </div>
    </div>
    
    <div id="validations-tab" class="tab-content">
      <div class="section">
        <div class="section-title">Recent Validations</div>
        <div id="validations-container">
          <div class="loading">Loading validations...</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modals -->
  <div id="teach-modal" class="modal">
    <div class="modal-content">
      <h2 class="modal-title">Teach Concept</h2>
      <form onsubmit="teachConcept(event)">
        <div class="form-group">
          <label class="form-label">Agent ID</label>
          <input type="text" class="form-input" id="teach-agent-id" required>
        </div>
        <div class="form-group">
          <label class="form-label">Concept</label>
          <select class="form-select" id="teach-concept" required>
            <option value="">Select concept...</option>
            <option value="portfolio_optimization">Portfolio Optimization</option>
            <option value="risk_management">Risk Management</option>
            <option value="option_pricing">Option Pricing</option>
            <option value="market_microstructure">Market Microstructure</option>
            <option value="treasury_management">Treasury Management</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Current Knowledge (optional)</label>
          <textarea class="form-textarea" id="teach-knowledge" placeholder="Describe agent's current knowledge..."></textarea>
        </div>
        <div class="actions">
          <button type="submit" class="btn btn-primary">Start Teaching</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('teach-modal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  
  <div id="assess-modal" class="modal">
    <div class="modal-content">
      <h2 class="modal-title">Assess Knowledge</h2>
      <form onsubmit="assessKnowledge(event)">
        <div class="form-group">
          <label class="form-label">Agent ID</label>
          <input type="text" class="form-input" id="assess-agent-id" required>
        </div>
        <div class="form-group">
          <label class="form-label">Concept to Assess</label>
          <select class="form-select" id="assess-concept" required>
            <option value="">Select concept...</option>
            <option value="portfolio_optimization">Portfolio Optimization</option>
            <option value="risk_management">Risk Management</option>
            <option value="option_pricing">Option Pricing</option>
            <option value="market_microstructure">Market Microstructure</option>
            <option value="treasury_management">Treasury Management</option>
          </select>
        </div>
        <div class="actions">
          <button type="submit" class="btn btn-primary">Run Assessment</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('assess-modal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  
  <div id="create-curriculum-modal" class="modal">
    <div class="modal-content">
      <h2 class="modal-title">Create Curriculum</h2>
      <form onsubmit="createCurriculum(event)">
        <div class="form-group">
          <label class="form-label">Agent ID</label>
          <input type="text" class="form-input" id="curriculum-agent-id" required>
        </div>
        <div class="form-group">
          <label class="form-label">Agent Type</label>
          <select class="form-select" id="curriculum-agent-type" required>
            <option value="">Select type...</option>
            <option value="analytics">Analytics</option>
            <option value="trading">Trading</option>
            <option value="risk">Risk Management</option>
            <option value="portfolio">Portfolio Management</option>
            <option value="market_data">Market Data</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Current Level</label>
          <select class="form-select" id="curriculum-level" required>
            <option value="beginner">Beginner</option>
            <option value="intermediate">Intermediate</option>
            <option value="advanced">Advanced</option>
          </select>
        </div>
        <div class="actions">
          <button type="submit" class="btn btn-primary">Create Curriculum</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('create-curriculum-modal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  
  <script>
    // Initialize the curriculum learning client
    const curriculumClient = new CurriculumLearningClient();
    
    // Subscribe to real-time updates
    curriculumClient.subscribe('status', updateStatus);
    curriculumClient.subscribe('statistics', updateStatistics);
    curriculumClient.subscribe('agent_scores', updateAgentScores);
    curriculumClient.subscribe('curricula', updateCurricula);
    curriculumClient.subscribe('domains', updateDomains);
    curriculumClient.subscribe('validations', updateValidations);
    
    // Start auto-refresh
    curriculumClient.startAutoRefresh(10000); // Every 10 seconds
    
    // Initial load
    window.addEventListener('DOMContentLoaded', () => {
      refreshData();
    });
    
    async function refreshData() {
      showLoading();
      
      try {
        // Fetch all data
        await Promise.all([
          curriculumClient.getStatus(),
          curriculumClient.getStatistics(),
          curriculumClient.getAgentScores(),
          curriculumClient.getCurricula(),
          curriculumClient.getDomains(),
          curriculumClient.getValidations()
        ]);
        
        hideLoading();
      } catch (error) {
        showError('Failed to load data: ' + error.message);
        hideLoading();
      }
    }
    
    function updateStatus(data) {
      if (!data.success) return;
      
      // Update agent count
      const agentCount = data.knowledge_domains?.length || 0;
      document.getElementById('total-agents').textContent = agentCount;
    }
    
    function updateStatistics(data) {
      if (!data.success || !data.statistics) return;
      
      const stats = data.statistics;
      
      // Update metrics
      document.getElementById('total-curricula').textContent = stats.total_curricula || 0;
      document.getElementById('total-validations').textContent = stats.validations_today || 0;
      document.getElementById('avg-compliance').textContent = 
        stats.average_compliance ? (stats.average_compliance * 100).toFixed(1) + '%' : 'N/A';
    }
    
    function updateAgentScores(data) {
      if (!data.success || !data.agent_scores) return;
      
      const container = document.getElementById('agents-container');
      container.innerHTML = '';
      
      if (data.agent_scores.length === 0) {
        container.innerHTML = '<p>No agents found. Create agents to start teaching.</p>';
        return;
      }
      
      data.agent_scores.forEach(agent => {
        const scorePercent = (agent.compliance_score * 100).toFixed(1);
        const scoreColor = agent.status === 'compliant' ? 'var(--jobs-green)' : 
                          agent.status === 'needs_improvement' ? 'var(--jobs-orange)' : 'var(--jobs-red)';
        
        const card = document.createElement('div');
        card.className = 'agent-card';
        card.innerHTML = `
          <div class="agent-name">${agent.agent_id}</div>
          <div class="agent-type">${agent.status}</div>
          <div class="agent-score">
            <div class="score-bar">
              <div class="score-fill" style="width: ${scorePercent}%; background: ${scoreColor}"></div>
            </div>
            <div class="score-value">${scorePercent}%</div>
          </div>
          <div class="actions">
            <button class="btn btn-primary" onclick="showTeachModal('${agent.agent_id}')">Teach</button>
            <button class="btn btn-secondary" onclick="showAssessModal('${agent.agent_id}')">Assess</button>
          </div>
        `;
        container.appendChild(card);
      });
    }
    
    function updateCurricula(data) {
      if (!data.success || !data.curricula) return;
      
      const container = document.getElementById('curricula-container');
      container.innerHTML = '';
      
      if (data.curricula.length === 0) {
        container.innerHTML = '<p>No active curricula. Create a curriculum to get started.</p>';
        return;
      }
      
      data.curricula.forEach(curriculum => {
        const card = document.createElement('div');
        card.className = 'agent-card';
        card.innerHTML = `
          <div class="agent-name">${curriculum.agent_id}</div>
          <div class="agent-type">${curriculum.status || 'active'}</div>
          <p>Modules: ${curriculum.modules?.length || 0}</p>
          <p>Current: ${curriculum.current_module || 'Not started'}</p>
          <div class="agent-score">
            <div class="score-bar">
              <div class="score-fill" style="width: ${curriculum.progress || 0}%; background: var(--jobs-blue)"></div>
            </div>
            <div class="score-value">${curriculum.progress || 0}%</div>
          </div>
          <div class="actions">
            <button class="btn btn-primary" onclick="continueCurriculum('${curriculum.agent_id}')">Continue</button>
            <button class="btn btn-secondary" onclick="viewCurriculum('${curriculum.agent_id}')">View</button>
          </div>
        `;
        container.appendChild(card);
      });
    }
    
    function updateDomains(data) {
      if (!data.success || !data.domains) return;
      
      const container = document.getElementById('domains-container');
      container.innerHTML = '';
      
      // Display CFA topics
      if (data.cfa_topics) {
        const cfaSection = document.createElement('div');
        cfaSection.innerHTML = '<h3>CFA Level 1 Topics</h3>';
        const cfaList = document.createElement('ul');
        
        Object.entries(data.cfa_topics).forEach(([key, topic]) => {
          const li = document.createElement('li');
          li.textContent = `${topic.name} - ${topic.description}`;
          cfaList.appendChild(li);
        });
        
        cfaSection.appendChild(cfaList);
        container.appendChild(cfaSection);
      }
      
      // Display Treasury topics
      if (data.treasury_topics) {
        const treasurySection = document.createElement('div');
        treasurySection.innerHTML = '<h3>Treasury Management Topics</h3>';
        const treasuryList = document.createElement('ul');
        
        Object.entries(data.treasury_topics).forEach(([key, topic]) => {
          const li = document.createElement('li');
          li.textContent = `${topic.name} - ${topic.description}`;
          treasuryList.appendChild(li);
        });
        
        treasurySection.appendChild(treasuryList);
        container.appendChild(treasurySection);
      }
    }
    
    function updateValidations(data) {
      if (!data.success || !data.validations) return;
      
      const container = document.getElementById('validations-container');
      container.innerHTML = '';
      
      if (data.validations.length === 0) {
        container.innerHTML = '<p>No recent validations.</p>';
        return;
      }
      
      const table = document.createElement('table');
      table.style.width = '100%';
      table.innerHTML = `
        <thead>
          <tr>
            <th>Agent ID</th>
            <th>Compliance Score</th>
            <th>Errors</th>
            <th>Warnings</th>
            <th>Timestamp</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      `;
      
      const tbody = table.querySelector('tbody');
      
      data.validations.forEach(validation => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${validation.agent_id}</td>
          <td>${((validation.validation_result?.compliance_score || 0) * 100).toFixed(1)}%</td>
          <td>${validation.validation_result?.errors?.length || 0}</td>
          <td>${validation.validation_result?.warnings?.length || 0}</td>
          <td>${new Date(validation.timestamp).toLocaleString()}</td>
        `;
        tbody.appendChild(row);
      });
      
      container.appendChild(table);
    }
    
    function switchTab(tabName) {
      // Update tab states
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Update content visibility
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`${tabName}-tab`).classList.add('active');
    }
    
    function showTeachModal(agentId) {
      document.getElementById('teach-agent-id').value = agentId;
      document.getElementById('teach-modal').style.display = 'flex';
    }
    
    function showAssessModal(agentId) {
      document.getElementById('assess-agent-id').value = agentId;
      document.getElementById('assess-modal').style.display = 'flex';
    }
    
    function showCreateCurriculumModal() {
      document.getElementById('create-curriculum-modal').style.display = 'flex';
    }
    
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }
    
    async function teachConcept(event) {
      event.preventDefault();
      
      const agentId = document.getElementById('teach-agent-id').value;
      const concept = document.getElementById('teach-concept').value;
      const knowledge = document.getElementById('teach-knowledge').value;
      
      showLoading();
      
      try {
        const result = await curriculumClient.teachConcept(
          agentId, 
          concept, 
          knowledge ? { description: knowledge } : {}
        );
        
        if (result.success) {
          showSuccess(`Successfully taught ${concept} to ${agentId}. Improvement: ${result.improvement || 'N/A'}`);
          closeModal('teach-modal');
          refreshData();
        } else {
          showError('Failed to teach concept: ' + result.error);
        }
      } catch (error) {
        showError('Error teaching concept: ' + error.message);
      }
      
      hideLoading();
    }
    
    async function assessKnowledge(event) {
      event.preventDefault();
      
      const agentId = document.getElementById('assess-agent-id').value;
      const concept = document.getElementById('assess-concept').value;
      
      showLoading();
      
      try {
        const result = await curriculumClient.assessKnowledge(agentId, concept);
        
        if (result.success) {
          const assessment = result.assessment;
          showSuccess(`Assessment complete for ${agentId}:\n
            Score: ${(assessment.score * 100).toFixed(1)}%\n
            Status: ${result.passed ? 'PASSED' : 'NEEDS IMPROVEMENT'}\n
            Strengths: ${assessment.strengths.join(', ')}\n
            Areas to improve: ${assessment.weaknesses.join(', ')}`);
          closeModal('assess-modal');
          refreshData();
        } else {
          showError('Failed to assess knowledge: ' + result.error);
        }
      } catch (error) {
        showError('Error assessing knowledge: ' + error.message);
      }
      
      hideLoading();
    }
    
    async function createCurriculum(event) {
      event.preventDefault();
      
      const agentId = document.getElementById('curriculum-agent-id').value;
      const agentType = document.getElementById('curriculum-agent-type').value;
      const level = document.getElementById('curriculum-level').value;
      
      showLoading();
      
      try {
        const result = await curriculumClient.createCurriculum(agentId, agentType, level);
        
        if (result.success) {
          showSuccess(`Curriculum created for ${agentId} with ${result.total_modules} modules. Estimated duration: ${result.estimated_duration} hours.`);
          closeModal('create-curriculum-modal');
          refreshData();
        } else {
          showError('Failed to create curriculum: ' + result.error);
        }
      } catch (error) {
        showError('Error creating curriculum: ' + error.message);
      }
      
      hideLoading();
    }
    
    function continueCurriculum(agentId) {
      showSuccess(`Continuing curriculum for ${agentId}...`);
      // In a real implementation, this would navigate to the curriculum learning interface
    }
    
    function viewCurriculum(agentId) {
      showSuccess(`Viewing curriculum details for ${agentId}...`);
      // In a real implementation, this would show curriculum details
    }
    
    function showLoading() {
      document.querySelectorAll('.loading').forEach(el => el.style.display = 'block');
    }
    
    function hideLoading() {
      document.querySelectorAll('.loading').forEach(el => el.style.display = 'none');
    }
    
    function showError(message) {
      const errorEl = document.getElementById('error-message');
      errorEl.textContent = message;
      errorEl.style.display = 'block';
      setTimeout(() => errorEl.style.display = 'none', 5000);
    }
    
    function showSuccess(message) {
      const successEl = document.getElementById('success-message');
      successEl.textContent = message;
      successEl.style.display = 'block';
      setTimeout(() => successEl.style.display = 'none', 5000);
    }
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      curriculumClient.stopAutoRefresh();
    });
  </script>
</body>
</html>